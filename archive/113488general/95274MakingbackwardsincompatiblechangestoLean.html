---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html">Making backwards-incompatible changes to Lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="188621342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188621342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188621342">Gabriel Ebner (Feb 20 2020 at 09:20)</a>:</h4>
<p>(I'm positing this here for higher visibility because I get the feeling that not everybody is watching the community fork repository.)  We've been talking about it for a long time and I believe we should finally start making some long-due backwards-incompatible changes to Lean.  These are the concrete changes that I'd like to merge soon:</p>
<ul>
<li>Remove the simp attribute from <code>add_comm</code> and <code>add_assoc</code> (<span class="user-mention" data-user-id="121918">@Edward Ayers</span> made a PR: <a href="https://github.com/leanprover-community/lean/pull/65" target="_blank" title="https://github.com/leanprover-community/lean/pull/65">https://github.com/leanprover-community/lean/pull/65</a>)</li>
<li>Remove the simp attribute from <code>sub_eq_add_neg</code> (<span class="user-mention" data-user-id="110049">@Mario Carneiro</span> aspires to be a pyromaniac: <a href="https://github.com/leanprover-community/mathlib/pull/2017#issuecomment-588417505" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/2017#issuecomment-588417505">https://github.com/leanprover-community/mathlib/pull/2017#issuecomment-588417505</a>)</li>
<li>Replace the <code>insert</code> definition with <code>export has_insert (insert)</code> (my proposal: <a href="https://github.com/leanprover-community/lean/pull/115" target="_blank" title="https://github.com/leanprover-community/lean/pull/115">https://github.com/leanprover-community/lean/pull/115</a>)</li>
</ul>
<p>Any thoughts?</p>

<a name="188622748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188622748" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188622748">Patrick Massot (Feb 20 2020 at 09:41)</a>:</h4>
<p>Can I vote twice for removing the simp attribute on <code>subeq_add_neg</code>?</p>

<a name="188622836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188622836" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188622836">Patrick Massot (Feb 20 2020 at 09:42)</a>:</h4>
<p>I guess most thing that simplify using <code>add_comm</code> and <code>add_assoc</code> should be using <code>ring</code> or <code>abel</code> anyway. So I vote yes to all those changes.</p>

<a name="188624584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188624584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188624584">Rob Lewis (Feb 20 2020 at 10:06)</a>:</h4>
<p>I'm on board, it's time to fix the things we've spent years complaining about.</p>

<a name="188624997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188624997" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188624997">Gabriel Ebner (Feb 20 2020 at 10:12)</a>:</h4>
<p>PR for <code>sub_eq_add_neg</code>: <a href="https://github.com/leanprover-community/lean/pull/117" target="_blank" title="https://github.com/leanprover-community/lean/pull/117">https://github.com/leanprover-community/lean/pull/117</a></p>

<a name="188626049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188626049" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188626049">Sebastien Gouezel (Feb 20 2020 at 10:28)</a>:</h4>
<p>How does this interact with updating mathlib? I mean, when we do such a change to Lean, then mathlib will break, and we will need to fix it. But once it is fixed, it will become incompatible with previous versions of Lean. So, things should be coordinated in a way.</p>

<a name="188626140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188626140" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188626140">Rob Lewis (Feb 20 2020 at 10:30)</a>:</h4>
<p>mathlib specifies which Lean version it uses in the toml file. Right now it's 3.5.1.</p>

<a name="188626147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188626147" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188626147">Rob Lewis (Feb 20 2020 at 10:30)</a>:</h4>
<p>It won't know about any changes to Lean until we update the toml.</p>

<a name="188626167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188626167" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188626167">Rob Lewis (Feb 20 2020 at 10:31)</a>:</h4>
<p>The PR that makes that change should also fix any breakage.</p>

<a name="188626181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188626181" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188626181">Rob Lewis (Feb 20 2020 at 10:31)</a>:</h4>
<p>It's probably a good idea to keep a branch of mathlib updated to Lean nightlies, so we don't have to make these fixes all at once.</p>

<a name="188627497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188627497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188627497">Gabriel Ebner (Feb 20 2020 at 10:53)</a>:</h4>
<p>I vaguely recall that somebody complained about <code>∘</code> being reducible.  Do we want to change this as well?<br>
(Occasion: I'm currently debugging a simp loop with <code>[simplify.rewrite] [equiv.conj_comp]: ⇑(equiv.conj e) f ==&gt; ⇑(equiv.conj e) f ∘ ⇑(equiv.conj e) (λ (x : α), x)</code>)</p>

<a name="188631052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188631052" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188631052">Anne Baanen (Feb 20 2020 at 12:00)</a>:</h4>
<p>Could we also fix the built-in well-foundedness tactic so that we can get rid of <code>using_well_founded wf_tacs</code>?</p>

<a name="188631274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188631274" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188631274">Gabriel Ebner (Feb 20 2020 at 12:05)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> Of course.  Please submit a PR to our glorious fork!</p>

<a name="188659283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188659283" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188659283">Yury G. Kudryashov (Feb 20 2020 at 17:37)</a>:</h4>
<p>What about changing <code>{a, b}</code> from <code>insert b {a}</code> to <code>insert a {b}</code>?</p>

<a name="188663978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188663978" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188663978">Floris van Doorn (Feb 20 2020 at 18:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/Making.20backwards-incompatible.20changes.20to.20Lean/near/188626181" title="#narrow/stream/113488-general/topic/Making.20backwards-incompatible.20changes.20to.20Lean/near/188626181">said</a>:</p>
<blockquote>
<p>It's probably a good idea to keep a branch of mathlib updated to Lean nightlies, so we don't have to make these fixes all at once.</p>
</blockquote>
<p>I think we don't want to keep two versions of mathlib up to date. That will result in a headache of merge conflicts, especially if some of these "Lean-compatibility" changes touch 100+ files.</p>
<p>I think we should bump the Lean version frequently for mathlib.</p>

<a name="188664767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Making%20backwards-incompatible%20changes%20to%20Lean/near/188664767" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/95274MakingbackwardsincompatiblechangestoLean.html#188664767">Yury G. Kudryashov (Feb 20 2020 at 18:36)</a>:</h4>
<p>If someone will rewrite <code>notation</code> for <code>{a, b, ...}</code>, then I'm ready to fix compile failures.</p>


{% endraw %}

{% include archive_update.html %}