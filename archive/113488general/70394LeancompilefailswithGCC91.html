---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/70394LeancompilefailswithGCC91.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html">Lean compile fails with GCC 9.1</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="170801039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170801039" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170801039">Yury G. Kudryashov (Jul 13 2019 at 18:51)</a>:</h4>
<p>Hi,<br>
I failed to build lean 3 from source on Fedora 30. It seems that the reason is GCC 9.1.<br>
More precisely, the code compiles with many warnings, then crashes every time.</p>

<a name="170801557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170801557" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170801557">Wojciech Nawrocki (Jul 13 2019 at 19:05)</a>:</h4>
<p>That's strange, it works for me with GCC 9.1.0 on Arch Linux. Is it the community version (<a href="https://github.com/leanprover-community/lean" target="_blank" title="https://github.com/leanprover-community/lean">https://github.com/leanprover-community/lean</a>)?</p>

<a name="170802356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170802356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170802356">Yury G. Kudryashov (Jul 13 2019 at 19:28)</a>:</h4>
<p>I tried both 3.4.2 and community version. I'll try <code>git clean</code>, then recompile.</p>

<a name="170802449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170802449" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170802449">Yury G. Kudryashov (Jul 13 2019 at 19:31)</a>:</h4>
<p><span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> Do you get a lot of warnings?</p>

<a name="170802514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170802514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170802514">Wojciech Nawrocki (Jul 13 2019 at 19:33)</a>:</h4>
<p>I get a lot of <code>-Wdeprecated-copy</code>, but the built binary works fine. Possibly Fedora has a different set of libraries that break something.</p>

<a name="170802564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170802564" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170802564">Yury G. Kudryashov (Jul 13 2019 at 19:35)</a>:</h4>
<p>I also get -Wpessimizing-move</p>

<a name="170802569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170802569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170802569">Yury G. Kudryashov (Jul 13 2019 at 19:35)</a>:</h4>
<p>(still compiles)</p>

<a name="170802609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170802609" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170802609">Wojciech Nawrocki (Jul 13 2019 at 19:36)</a>:</h4>
<p>Yeah, I also get a few of <code>-Wpessimizing-move</code>.</p>

<a name="170803431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170803431" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170803431">Yury G. Kudryashov (Jul 13 2019 at 20:03)</a>:</h4>
<p>Here is the error:</p>
<div class="codehilite"><pre><span></span>/home/urkud/projects/lean3/library/init/meta/tactic.lean: parsing at line 1399terminate called after throwing an instance of &#39;lean::exception&#39;
  what():  vm check failed: is_composite(o) (possibly due to incorrect axioms, or sorry)
</pre></div>

<a name="170803478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170803478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170803478">Wojciech Nawrocki (Jul 13 2019 at 20:05)</a>:</h4>
<p>I've seen that one before. I'm not sure exactly why it happens. For me removing the Lean folder, downloading from git again and rebuilding fixed it. Sorry I don't have a cleaner possible solution!</p>

<a name="170803539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170803539" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170803539">Wojciech Nawrocki (Jul 13 2019 at 20:07)</a>:</h4>
<p>(It seemed to have something to do with the built .olean files under lean/library/ being corrupted, but don't quote me on it).</p>

<a name="170803989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170803989" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170803989">Yury G. Kudryashov (Jul 13 2019 at 20:22)</a>:</h4>
<p><code>git clean -fdx</code> removed all <code>.olean</code> files</p>

<a name="170804042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170804042" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170804042">Yury G. Kudryashov (Jul 13 2019 at 20:24)</a>:</h4>
<p>Actually, I fixed this somehow a few months ago (or just got lucky after one more recompile), and use this lean binary since then. Probably I'll try to fix (most of) the warning and see if it fixes compilation.</p>

<a name="170804055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170804055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170804055">Yury G. Kudryashov (Jul 13 2019 at 20:25)</a>:</h4>
<p>BTW, writing outside of the build directory is supposed to be a bad idea, and lean cmake script does it (instead of, e.g., copying <code>lean/library</code> to the build directory).</p>

<a name="170804104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/170804104" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#170804104">Yury G. Kudryashov (Jul 13 2019 at 20:26)</a>:</h4>
<p>This is a bad idea because different build directories are no longer independent. E.g., I can't try different compilers/flags in different build directories and be sure that they do not interfere with each other.</p>

<a name="174351336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174351336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174351336">Wojciech Nawrocki (Aug 28 2019 at 10:58)</a>:</h4>
<p>I've made an issue for this in <a href="https://github.com/leanprover-community/lean/issues/62" target="_blank" title="https://github.com/leanprover-community/lean/issues/62">https://github.com/leanprover-community/lean/issues/62</a> .</p>

<a name="174354617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174354617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174354617">Simon Hudon (Aug 28 2019 at 11:58)</a>:</h4>
<p>Can you guys setup a travis build that will reproduce the problem? Is it specific to Linux or will it crash also on Mac and Windows?</p>

<a name="174362662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174362662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174362662">Wojciech Nawrocki (Aug 28 2019 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> It already fails in the AppVeyor MinGW build, for example <a href="https://ci.appveyor.com/project/cipher1024/lean-e5aoi/builds/27002887/job/pkp6cl1q3t4wf5xk" target="_blank" title="https://ci.appveyor.com/project/cipher1024/lean-e5aoi/builds/27002887/job/pkp6cl1q3t4wf5xk">https://ci.appveyor.com/project/cipher1024/lean-e5aoi/builds/27002887/job/pkp6cl1q3t4wf5xk</a></p>

<a name="174363031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174363031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174363031">Simon Hudon (Aug 28 2019 at 13:40)</a>:</h4>
<p>Ok but there are changes in that branch. Without the changes, I think it's still working</p>

<a name="174363438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174363438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174363438">Wojciech Nawrocki (Aug 28 2019 at 13:45)</a>:</h4>
<p>There are changes, but your own PR from 24 days ago <a href="https://ci.appveyor.com/project/cipher1024/lean-e5aoi/builds/26836597/job/a0p7ulnskt0e1arb" target="_blank" title="https://ci.appveyor.com/project/cipher1024/lean-e5aoi/builds/26836597/job/a0p7ulnskt0e1arb">fails with the same error</a> despite changing completely different things. In the bug report I also mention that I get this error on a fresh <code>master</code>.  This makes me semi-confident that new GCC (which MinGW also uses) started doing something Lean doesn't like. Either it's UB in Lean, or an incorrect optimization in GCC. I will also try clang++ on my laptop and see if it works</p>

<a name="174363645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174363645" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174363645">Simon Hudon (Aug 28 2019 at 13:47)</a>:</h4>
<p>what's UB?</p>

<a name="174363774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174363774" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174363774">Bryan Gin-ge Chen (Aug 28 2019 at 13:48)</a>:</h4>
<p>undefined behavior</p>

<a name="174363955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174363955" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174363955">Simon Hudon (Aug 28 2019 at 13:50)</a>:</h4>
<p>Ok, I'll see what happens when I revert my changes and then we can start looking at removing the warnings</p>

<a name="174364087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174364087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174364087">Wojciech Nawrocki (Aug 28 2019 at 13:51)</a>:</h4>
<p>Note this is probably a bug in Lean proper, and not the community fork, because I also reliably see it when building <a href="http://github.com/leanprover/lean" target="_blank" title="http://github.com/leanprover/lean">github.com/leanprover/lean</a> . (See <a href="https://ci.appveyor.com/project/leodemoura/lean/build/job/jmxe5g5ywklbaofr" target="_blank" title="https://ci.appveyor.com/project/leodemoura/lean/build/job/jmxe5g5ywklbaofr">https://ci.appveyor.com/project/leodemoura/lean/build/job/jmxe5g5ywklbaofr</a> )</p>

<a name="174364942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174364942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174364942">Wojciech Nawrocki (Aug 28 2019 at 14:00)</a>:</h4>
<p><code>lean --make</code> just segfaults for me on <code>library/</code> when built by Clang 8.0.1. I'll stick to GCC for now</p>

<a name="174365305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174365305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174365305">Bryan Gin-ge Chen (Aug 28 2019 at 14:04)</a>:</h4>
<p><a href="https://ci.appveyor.com/project/leodemoura/lean/history" target="_blank" title="https://ci.appveyor.com/project/leodemoura/lean/history">The appveyor build history</a> (for <code>leanprover/lean</code>) shows that the nightly builds started failing Aug 1. It looks like that's when GCC was changed <a href="https://ci.appveyor.com/project/leodemoura/lean/builds/26389340/job/hdj3e9hge6tg3y05?fullLog=true#L44" target="_blank" title="https://ci.appveyor.com/project/leodemoura/lean/builds/26389340/job/hdj3e9hge6tg3y05?fullLog=true#L44">from 8.2.0</a> to <a href="https://ci.appveyor.com/project/leodemoura/lean/builds/26417837/job/5r3twj6en27xru3d?fullLog=true#L44" target="_blank" title="https://ci.appveyor.com/project/leodemoura/lean/builds/26417837/job/5r3twj6en27xru3d?fullLog=true#L44">9.1.0</a> . And that's presumably due to the update to MSYS2 <a href="https://www.appveyor.com/updates/2019/08/01/" target="_blank" title="https://www.appveyor.com/updates/2019/08/01/">here</a>.</p>

<a name="174381777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174381777" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174381777">Mario Carneiro (Aug 28 2019 at 17:01)</a>:</h4>
<p>If there is UB in lean, I wonder if we can tame the nasal demons to prove false in paranoid mode</p>

<a name="174382100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20compile%20fails%20with%20GCC%209.1/near/174382100" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/70394LeancompilefailswithGCC91.html#174382100">Sebastian Ullrich (Aug 28 2019 at 17:04)</a>:</h4>
<p>I don't know about GCC, but LLVM 8 is known to miscompile Lean due to <a href="https://bugs.llvm.org/show_bug.cgi?id=40044" target="_blank" title="https://bugs.llvm.org/show_bug.cgi?id=40044">https://bugs.llvm.org/show_bug.cgi?id=40044</a></p>


{% endraw %}

{% include archive_update.html %}