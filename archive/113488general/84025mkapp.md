---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/84025mkapp.html
---

## Stream: [general](index.html)
### Topic: [`mk_app`](84025mkapp.html)

---


{% raw %}
#### [ Edward Ayers (Aug 10 2018 at 13:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231220):
How does the `mk_app` tactic work?

#### [ Edward Ayers (Aug 10 2018 at 13:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231293):
What does it apply to what? What name does it return?

#### [ Mario Carneiro (Aug 10 2018 at 13:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231495):
It constructs an application of a theorem given by name, to a list of arguments

#### [ Mario Carneiro (Aug 10 2018 at 13:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231506):
i.e. `mk_app ``eq [a, b]` will construct the term `%%a = %%b`

#### [ Mario Carneiro (Aug 10 2018 at 13:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231508):
where `a b : expr`

#### [ Edward Ayers (Aug 10 2018 at 13:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231513):
What does %% mean?

#### [ Mario Carneiro (Aug 10 2018 at 13:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231522):
I mean that it's not `a` itself that is equal to `b`, it is the expression `a` represents

#### [ Mario Carneiro (Aug 10 2018 at 13:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231565):
it's antiquotation but I'm using it schematically there

#### [ Edward Ayers (Aug 10 2018 at 13:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231570):
ok

#### [ Edward Ayers (Aug 10 2018 at 13:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231576):
whats the difference between `pexpr` and `expr`?

#### [ Edward Ayers (Aug 10 2018 at 13:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231587):
What do I type to get the expr representing `ℕ`?

#### [ Mario Carneiro (Aug 10 2018 at 13:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231601):
`` `(ℕ)`` is the easy way

#### [ Edward Ayers (Aug 10 2018 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231642):
are the braces necessary?

#### [ Mario Carneiro (Aug 10 2018 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231647):
yes, without parens the backquote quotes `name`s

#### [ Mario Carneiro (Aug 10 2018 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231649):
the parens signal an `expr` quotation

#### [ Edward Ayers (Aug 10 2018 at 13:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231670):
ok so
- `` `(X) `` means `expr` of
- `` `X `` means the name of
- ``` ``X  ``` means the `name`of with automatic namespace resolution
- ``````X``` means ?

#### [ Mario Carneiro (Aug 10 2018 at 13:30)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231717):
Another way to get the expr for N is ``mk_const `nat``

#### [ Edward Ayers (Aug 10 2018 at 13:30)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231729):
I can't get the backticks to work but the 3rd item in the list is supposed to have 2 backticks

#### [ Mario Carneiro (Aug 10 2018 at 13:30)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231739):
you have to put more quotes around the code block than are in it

#### [ Mario Carneiro (Aug 10 2018 at 13:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231749):
like ``` ``x `n `` ```

#### [ Mario Carneiro (Aug 10 2018 at 13:33)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231831):
see an earlier cheat sheet: https://leanprover.zulipchat.com/#narrow/stream/113488-general/subject/Programming.20in.20Lean/near/129467739

#### [ Edward Ayers (Aug 10 2018 at 13:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231900):
what is a `pexpr`?

#### [ Mario Carneiro (Aug 10 2018 at 13:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231910):
a pre-expression, which is the output of the parser

#### [ Mario Carneiro (Aug 10 2018 at 13:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231921):
the difference between it and `expr` is the implicit arguments and other well typed data

#### [ Edward Ayers (Aug 10 2018 at 13:36)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231924):
ok.

#### [ Edward Ayers (Aug 10 2018 at 13:36)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231967):
can I make an `expr` with an invalid type?

#### [ Mario Carneiro (Aug 10 2018 at 13:36)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231969):
yes

#### [ Edward Ayers (Aug 10 2018 at 13:36)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231974):
so its just a syntax tree with implicit args etc

#### [ Mario Carneiro (Aug 10 2018 at 13:36)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231989):
the tactics try to check stuff as they build exprs, for efficiency

#### [ Edward Ayers (Aug 10 2018 at 13:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131231997):
is there a fast way of writing `unit.star`?

#### [ Mario Carneiro (Aug 10 2018 at 13:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232003):
`()`

#### [ Mario Carneiro (Aug 10 2018 at 13:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232018):
for example, `mk_app` will tell you if the application you build is not well typed, but `expr.app` will not

#### [ Edward Ayers (Aug 10 2018 at 13:38)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232068):
ah ok that makes sense.

#### [ Mario Carneiro (Aug 10 2018 at 13:38)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232085):
an `expr` is a bit more than a syntax tree, it is more like a full proof term, but it is not guaranteed to be correct

#### [ Mario Carneiro (Aug 10 2018 at 13:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232091):
`pexpr` is more like a syntax tree

#### [ Edward Ayers (Aug 10 2018 at 13:40)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232176):
is a `name` just the `namespace1.namespace2.foo` string stack?

#### [ Edward Ayers (Aug 10 2018 at 13:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232241):
If I am inside a lambda expression with variable `x` and running a tactic, what would it's name be? `anonymous`?

#### [ Edward Ayers (Aug 10 2018 at 13:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232535):
Also please could you help me untangle my misconceptions about how metavariables work in the following example:
```lean
meta def scratch_tac : tactic unit :=
do
    v <- mk_meta_var `(ℕ),
    e <- mk_app ``eq [v, v],
    set_goals [e],
    return ()

variables a b c : Prop
example : a -> (a -> b) -> c -> b :=
begin
  intros h1 h2 h3,
  scratch_tac,
  sorry
end
```

Which errors on `scratch_tac` with `invalid set_goals tactic, expressions must be meta-variables that have been declared in the current tactic_state`

#### [ Edward Ayers (Aug 10 2018 at 13:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232558):
I want to add a new goal which is `?x = ?x` where I don't know what `?x` is yet. If that makes sense

#### [ Edward Ayers (Aug 10 2018 at 13:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232741):
Are there any docs which tell me what is in `tactic_state`?

#### [ Mario Carneiro (Aug 10 2018 at 13:57)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131232857):
> is a name just the namespace1.namespace2.foo string stack?

yes

> If I am inside a lambda expression with variable x and running a tactic, what would it's name be? anonymous?

It depends on whether the lambda has been abstracted or not. If the variable `x` is currently in the local context (i.e. left of the turnstile) then `x` will be represented in expressions as a `expr.local_const`. If `x` is bound in an expression, then it is nameless, `var 0` or such

#### [ Mario Carneiro (Aug 10 2018 at 14:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131233720):
I think this is what you want:
```lean
meta def scratch_tac : tactic unit :=
do v ← mk_meta_var `(ℕ),
   e ← mk_app ``eq [v, v],
   h ← tactic.assert `h e,
   skip
```

#### [ Edward Ayers (Aug 10 2018 at 17:05)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243121):
so re: names, I have `local_const : name → name → binder_info → expr → expr`, What do these entries correspond to?

#### [ Mario Carneiro (Aug 10 2018 at 17:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243187):
pretty name, unique name, binder info, type (sometimes)

#### [ Mario Carneiro (Aug 10 2018 at 17:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243208):
binder info means explicit, implicit, typeclass implicit, etc

#### [ Mario Carneiro (Aug 10 2018 at 17:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243243):
you shouldn't trust the type, it is sometimes a dummy value

#### [ Mario Carneiro (Aug 10 2018 at 17:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243254):
use `infer_type` on the variable instead

#### [ Edward Ayers (Aug 10 2018 at 17:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243351):
`binder_info` implies something is being bound? Is it bound in the type?

#### [ Mario Carneiro (Aug 10 2018 at 17:09)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243381):
every variable was bound at some point, but you have opened it to look inside the binder and now the variable is in the context

#### [ Edward Ayers (Aug 10 2018 at 17:09)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243404):
So it's the binder info for the original `lam` or `pi` that it was bound by?

#### [ Mario Carneiro (Aug 10 2018 at 17:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243582):
yes
```
example {α : Type} (x : α) : α :=
by do
  expr.local_const pp_α uα bi_α t ← tactic.get_local `α,
  guard (bi_α = binder_info.implicit),
  expr.local_const pp_x ux bi_x t ← tactic.get_local `x,
  guard (bi_x = binder_info.default),
  `[exact x]
```

#### [ Kevin Buzzard (Aug 10 2018 at 17:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131243863):
If this conversation were going about ten times more slowly I feel like I could learn something from it. I know that @**Chris Hughes** had plans to learn something about tactics this summer, but my impression was that when he realised he had 100 questions he decided that it was unreasonable to spam the chat with them all, and of course I was no help. Chris and I between us can deal with essentially all the questions the other undergrads are throwing at us because we both now have a robust understanding of how to do mathematics in Lean, but we are still lacking a tactic guru and I don't quite know what to do about it.

#### [ Edward Ayers (Aug 10 2018 at 17:21)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131244150):
I have no spam shame.

#### [ Kevin Buzzard (Aug 10 2018 at 17:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131244386):
I was just the same last August/Sept/Oct when I was learning dependent type theory. I don't regret it for one instant. Now when I see a newbie question that I can answer I try to answer it quickly to save Mario the bother.

#### [ Kevin Buzzard (Aug 10 2018 at 17:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131244571):
It's really important that the knowledge base expands quickly.

#### [ Edward Ayers (Aug 10 2018 at 17:34)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245099):
Ok more tactics questions:
This is the code for `abstract` from the core library:
``` lean
meta def abstract (tac : tactic unit) (suffix : option name := none) (zeta_reduce := tt) : tactic unit :=
do fail_if_no_goals,
   gs ← get_goals,
   type ← if zeta_reduce then target >>= zeta else target,
   is_lemma ← is_prop type,
   m ← mk_meta_var type,
   set_goals [m],
   tac,
   n ← num_goals,
   when (n ≠ 0) (fail "abstract tactic failed, there are unsolved goals"),
   set_goals gs,
   val ← instantiate_mvars m,
   val ← if zeta_reduce then zeta val else return val,
   c   ← mk_aux_decl_name suffix,
   e   ← add_aux_decl c type val is_lemma,
   exact e
```
- `set_goals` seems to completely clobber the existing goals. It seems like it is just changing the field on `tactic_state` structure.  But if you can do this, what stops you from doing ``m <- mk_meta_var `(true), set_goals [m]`` (or code to that effect) and just solving that?
- What is keeping track of the metavariables? Are these kept in `tactic_state`? 
- Once I set a metavariable to be a goal and then solve it with a tactic, where is the proof term stored? How can I find out the status of a metavariable eg (fresh, partially instantiated etc)
- What stops me from making infinite-descent terms using metavariables? Eg I could solve `?m` with `f(?n)` and vice versa.

#### [ Edward Ayers (Aug 10 2018 at 17:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245191):
- What does `instantiate_mvars` do? Is the metavariable eliminated from the state when I do this? What does it return?

#### [ Edward Ayers (Aug 10 2018 at 17:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245493):
- Is `zeta` the one for reducing `let` bindings? I can't find it on google. Where can I find a list of the reductions in Lean?

#### [ Mario Carneiro (Aug 10 2018 at 17:40)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245627):
> set_goals seems to completely clobber the existing goals. It seems like it is just changing the field on tactic_state structure. But if you can do this, what stops you from doing m <- mk_meta_var `(true), set_goals [m] (or code to that effect) and just solving that?

Nothing. If you do, you will get a strange error message saying there are no goals left but metavariables remain, and your users will be confused

#### [ Edward Ayers (Aug 10 2018 at 17:41)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245649):
- If the `zeta_reduce` option isn't set, it looks like this `abstract` tactic doesn't do anything. It just sets the goal to be the same as the original goal and runs `tac`.

#### [ Mario Carneiro (Aug 10 2018 at 17:41)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245669):
> What is keeping track of the metavariables? Are these kept in tactic_state? 

Yes. The `tactic_state` is essentially just a list of metavariables (the goals) plus a partial proof term (the result)

#### [ Edward Ayers (Aug 10 2018 at 17:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245734):
```quote
Nothing. If you do, you will get a strange error message saying there are no goals left but metavariables remain, and your users will be confused
```
Ah so the task is to get rid of the metavars. The goal state doesn't matter. nice.

#### [ Mario Carneiro (Aug 10 2018 at 17:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245763):
> Once I set a metavariable to be a goal and then solve it with a tactic, where is the proof term stored? How can I find out the status of a metavariable eg (fresh, partially instantiated etc)

The goals should be a subset of the metavariables in the result, so when they are assigned the result proof term is increased

#### [ Mario Carneiro (Aug 10 2018 at 17:44)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245859):
Metavariables that you deal with in tactics are usually uninstantiated. There is no "partially instantiated", they are just instantiated to a term that contains more metavariables

#### [ Mario Carneiro (Aug 10 2018 at 17:44)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245883):
`get_assignment` returns the assignment to a metavar

#### [ Mario Carneiro (Aug 10 2018 at 17:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131245949):
> What stops me from making infinite-descent terms using metavariables? Eg I could solve ?m with f(?n) and vice versa.

I believe there is an occurs-check in `unify`, which is responsible for most metavariable assignment

#### [ Mario Carneiro (Aug 10 2018 at 17:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131246063):
> What does instantiate_mvars do? Is the metavariable eliminated from the state when I do this? What does it return?

`instantiate_mvars` takes an expr with embedded `mvar` constructors and replaces them with their assignments

#### [ Mario Carneiro (Aug 10 2018 at 17:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131246098):
The state is manually maintained, so metavars go away when you say so. However, `set_goals` automatically prunes assigned mvars

#### [ Edward Ayers (Aug 10 2018 at 17:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131319264):
- what happens if I try to use `exact e` where the expression depends on mvars that have already been assigned? will they be automatically assigned?

#### [ Mario Carneiro (Aug 10 2018 at 17:49)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131319278):
> Is zeta the one for reducing let bindings? I can't find it on google. Where can I find a list of the reductions in Lean?

Yes. The zeta rule says that if `x : t := e` is in the context, then `x` reduces to `e`

#### [ Mario Carneiro (Aug 10 2018 at 17:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131392498):
The reduction rules in lean are beta, zeta, delta, and iota, with additionally alpha and eta conversions (these are not reductions, just equalities)

#### [ Mario Carneiro (Aug 10 2018 at 17:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131392549):
> If the zeta_reduce option isn't set, it looks like this abstract tactic doesn't do anything. It just sets the goal to be the same as the original goal and runs tac.

The purpose of the `abstract` tactic is to take the result of the enclosed tactic script and save the result to a new auxiliary definition

#### [ Mario Carneiro (Aug 10 2018 at 17:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131465729):
`return` is not an early abort in lean!

#### [ Edward Ayers (Aug 10 2018 at 17:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131538857):
what is an auxillary definition?

#### [ Mario Carneiro (Aug 10 2018 at 17:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131538860):
It basically just means produce a value with no side effects

#### [ Mario Carneiro (Aug 10 2018 at 17:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131538882):
it's just a definition with an obscure derived name

#### [ Mario Carneiro (Aug 10 2018 at 17:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131539010):
This line
```
   val ← if zeta_reduce then zeta val else return val,
```
is equivalent to the following imperative code:
```
if (zeta_reduce) {val = zeta(val)}
```

#### [ Edward Ayers (Aug 10 2018 at 17:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131539031):
yeah I'm ok with `return`

#### [ Edward Ayers (Aug 10 2018 at 17:56)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131539087):
The original question was spawned from a lack of understanding of goals vs metavars

#### [ Mario Carneiro (Aug 10 2018 at 17:57)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131612227):
goals are metavariables, but there are metavars in the result that are not goals, and there are also metavars that are not in the result

#### [ Edward Ayers (Aug 10 2018 at 17:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131612294):
Right, and when you `set_goal m` and solve it. `m` is now assigned, but the actual proof term hasn't advanced

#### [ Mario Carneiro (Aug 10 2018 at 17:59)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131685438):
I'm not actually sure when the advancing happens. Lean is very good at making assigned metavars act as though they weren't there at all

#### [ Mario Carneiro (Aug 10 2018 at 17:59)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131758568):
for most purposes you can just say that the proof term is advanced once you assign the metavar

#### [ Edward Ayers (Aug 10 2018 at 17:59)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131758569):
```quote
I'm not actually sure when the advancing happens. Lean is very good at making assigned metavars act as though they weren't there at all
```
yes this is what is throwing me

#### [ Mario Carneiro (Aug 10 2018 at 18:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131758649):
there are a few gotchas to do with "old" metavars that are assigned but not purged, but these are fairly rare

#### [ Mario Carneiro (Aug 10 2018 at 18:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131758686):
If you ask for the `result`, I'm pretty sure you will see the result of all assignments

#### [ Mario Carneiro (Aug 10 2018 at 18:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131831823):
Note that you can't just assign a metavar - there is no direct function for this that I could see on a quick perusal

#### [ Edward Ayers (Aug 10 2018 at 18:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131831825):
- How does one purge a metavar?
- If I make a new metavar `m` trying to prove `false`, and then assign all metavars except `m`, can I still finish the proof?

#### [ Mario Carneiro (Aug 10 2018 at 18:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131831879):
when you assign a metavar indirectly through `unify`, these details are taken care of for you

#### [ Mario Carneiro (Aug 10 2018 at 18:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131831937):
> How does one purge a metavar?

How does one not? Once a metavar is assigned it isn't eligible to be a goal anymore, `set_goals` will remove it

#### [ Edward Ayers (Aug 10 2018 at 18:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131831942):
Would doing `set_goal [m]` and then `exact x` assign the metavar?

#### [ Mario Carneiro (Aug 10 2018 at 18:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131831985):
yes, and it would also clear the goal

#### [ Mario Carneiro (Aug 10 2018 at 18:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832011):
`exact x` is basically just `unify m x`

#### [ Mario Carneiro (Aug 10 2018 at 18:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832021):
with some goal management, I think

#### [ Mario Carneiro (Aug 10 2018 at 18:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832083):
> If I make a new metavar m trying to prove false, and then assign all metavars except m, can I still finish the proof?

Creating a metavar does not tie it to your proof. These "dangling" metavars are not tracked, and give that error you saw before if you try to set them as goals

#### [ Mario Carneiro (Aug 10 2018 at 18:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832146):
so yes, this metavar would not affect anything

#### [ Edward Ayers (Aug 10 2018 at 18:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832149):
ah ok so you can't even set a dangler as a goal

#### [ Edward Ayers (Aug 10 2018 at 18:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832484):
ah I see `assert T` is changing the target to `T -> target`. But `setgoal` doesn't do that stuff.

#### [ Edward Ayers (Aug 10 2018 at 18:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832712):
So just let me reask two questions that I am still unsure about;

#### [ Edward Ayers (Aug 10 2018 at 18:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832729):
- How can I find the metavars that are currently in play?

#### [ Edward Ayers (Aug 10 2018 at 18:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832759):
- what happens if I try to use `exact e` where the expression depends on mvars that have already been assigned? will they be automatically assigned?

#### [ Kevin Buzzard (Aug 10 2018 at 18:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832765):
```quote
The original question was spawned from a lack of understanding of goals vs metavars
```
You've obviously not read the docs. See setion 8.5 of "Programming in Lean":

"8.5 Metavariables and Unification
[This section is still under construction. It will discuss the notion of a metavariable and
its local context, with the interesting bit of information that goals in the tactic state are
nothing more than metavariables."

#### [ Kevin Buzzard (Aug 10 2018 at 18:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832818):
As you can see, this is all very clearly documented :-)

#### [ Edward Ayers (Aug 10 2018 at 18:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832870):
yes I found that doc earlier and thought "finally, one document that I can just read so I don't have to bother people by asking potentially silly questions"

#### [ Kevin Buzzard (Aug 10 2018 at 18:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832876):
I've read it twice!

#### [ Kevin Buzzard (Aug 10 2018 at 18:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832882):
What there is of it, anyway.

#### [ Edward Ayers (Aug 10 2018 at 18:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832928):
The parts that are there are high-qual. I hasten to add

#### [ Kevin Buzzard (Aug 10 2018 at 18:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832940):
Yes absolutely. The docs are excellent. There's just not enough of them.

#### [ Kevin Buzzard (Aug 10 2018 at 18:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832954):
Avigad writes very well.

#### [ Kevin Buzzard (Aug 10 2018 at 18:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131832960):
And knows his stuff.

#### [ Johan Commelin (Aug 10 2018 at 18:20)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833085):
I wonder whether we could write "The Lean book" in a similar fashion as "The HoTT book" was written, somewhere in the near future.

#### [ Kevin Buzzard (Aug 10 2018 at 18:21)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833095):
I learnt a lot about the basics of dependent type theory from doing all the exercises in Theorem Proving In Lean. What I need is a whole bunch of high quality basic exercises about exprs etc. Unfortunately learning meta mode is not high priority for me right now so it never happens. I feel my time is currently better spent telling other mathematicians about what I've managed to assimilate about doing mathematics in Lean. I will get to tactics in the end, but secretly hope some more docs will appear before I get there.

#### [ Mario Carneiro (Aug 10 2018 at 18:21)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833119):
> How can I find the metavars that are currently in play?

Lean doesn't make it particularly easy to get the full list. You are supposed to be responsible with your goal management so you don't "drop" any goals you will need later. But it is possible, while expensive, to just crawl the `result` looking for metavars. The `metavariables` tactic in mathlib does this

#### [ Johan Commelin (Aug 10 2018 at 18:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833167):
Right, so we have to lock Mario and Simon into a room for a day, and then that chapter will be a lot better!

#### [ Mario Carneiro (Aug 10 2018 at 18:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833194):
> what happens if I try to use exact e where the expression depends on mvars that have already been assigned? will they be automatically assigned?

yes

#### [ Kevin Buzzard (Aug 10 2018 at 18:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833287):
As you know I am trying to write "Lean for mathematicians", but my plans have gone awry -- I had thought that my students would be completely unable to make any progress without my writing it, but they have somehow taught each other how to use Lean without my helping. Different people brought different skills to the table, and they just all talked to each other. So the book languished because I wasn't needed and I spent a lot of time getting some kind of overview of what exactly was already in mathlib.

#### [ Johan Commelin (Aug 10 2018 at 18:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833428):
Would it make sense to start a book project in `leanprover-community`?

#### [ Mario Carneiro (Aug 10 2018 at 18:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833481):
Maybe you should ask jeremy to go open source?

#### [ Johan Commelin (Aug 10 2018 at 18:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833499):
I don't know Jeremy, and he doesn't know me. You know him a lot better... [hint hint]

#### [ Johan Commelin (Aug 10 2018 at 18:30)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833589):
Technically, it is already open source. We could just fork the existing book. But it is nice to ask for permission. :smile:

#### [ Johan Commelin (Aug 10 2018 at 18:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131833625):
Maybe a PR on the existing project would be ok.

#### [ Edward Ayers (Aug 10 2018 at 18:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834197):
```quote
 But it is possible, while expensive, to just crawl the `result` looking for metavars. The `metavariables` tactic in mathlib does this
```
How do I get `result`?

#### [ Edward Ayers (Aug 10 2018 at 18:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834219):
is it the same as `interaction_monad.result`

#### [ Edward Ayers (Aug 10 2018 at 18:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834225):
In which case the relevant object is `tactic_result`

#### [ Edward Ayers (Aug 10 2018 at 18:44)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834298):
But there don't seem to be any consts in lean lib for inspecting `tactic_result`

#### [ Mario Carneiro (Aug 10 2018 at 18:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834314):
I am talking about `tactic.result`

#### [ Edward Ayers (Aug 10 2018 at 18:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834319):
oops yes

#### [ Mario Carneiro (Aug 10 2018 at 18:46)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834370):
`interaction_monad.result` is a simple inductive type containing the result of a tactic execution, which you can destruct with `match`

#### [ Edward Ayers (Aug 10 2018 at 18:46)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834376):
I got confused between `tactic_result` and `tactic_state`. `tactic_result  := interaction_monad.result tactic_state`

#### [ Edward Ayers (Aug 10 2018 at 18:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834539):
Sorry I just completely misread the source code. `tactic.result` is totally unrelated to `tactic_result`. Sorry

#### [ Mario Carneiro (Aug 10 2018 at 18:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834547):
when you put it that way...

#### [ Edward Ayers (Aug 10 2018 at 18:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834650):
How would one write `assert` using only `mk_metavar` and  `set_goal` moves? is it possible?

#### [ Edward Ayers (Aug 10 2018 at 19:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834962):
something like:
```lean
assert (T : expr) := 
do {
  m <- result,
  t <- target,
  a <- mk_metavar `(T -> t),
  b <- mk_metavar T,
  unify m  `(%%a $ %%b),
  set_goals [a, b],
  return ()
}
```

#### [ Edward Ayers (Aug 10 2018 at 19:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131834983):
modulo any obvious errors

#### [ Edward Ayers (Aug 10 2018 at 19:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835112):
- If I use `get_goals`, I get a list of expressions. Is `target` just getting the first of these?

#### [ Mario Carneiro (Aug 10 2018 at 19:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835195):
Here's a decent approximation:
```
meta def assert' (h : name) (t : expr) : tactic unit := do
  g :: gs ← get_goals,
  m₂ ← mk_meta_var t,
  t' ← infer_type g,
  m₁ ← mk_meta_var (expr.pi h binder_info.default t t'),
  unify g (m₁ m₂),
  set_goals (m₁ :: m₂ :: gs),
  intro h >> skip
```
I don't know if there is a way to avoid the `intro` - you need a way to change the local context

#### [ Edward Ayers (Aug 10 2018 at 19:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835255):
It would be interesting to find a minimal list of fundamental tactics

#### [ Mario Carneiro (Aug 10 2018 at 19:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835276):
lean wasn't really designed for a small API

#### [ Mario Carneiro (Aug 10 2018 at 19:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835286):
there are a lot of features which are still not quite available

#### [ Edward Ayers (Aug 10 2018 at 19:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835344):
I know but it helps with learning, because if I find `meta constant ...` in `tactics.lean` I don't know whether I need to care about it to understand how lean works

#### [ Edward Ayers (Aug 10 2018 at 19:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835444):
Then I could just read the wordy explanation for the minimum fundamental tactics and read the code for the derived ones. I only have to grasp the fundamental ones

#### [ Edward Ayers (Aug 10 2018 at 19:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835472):
```quote
there are a lot of features which are still not quite available
```
please could you give some examples?

#### [ Mario Carneiro (Aug 10 2018 at 19:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835503):
lean 4 is planning to roll out quite a bit more API surface area

#### [ Mario Carneiro (Aug 10 2018 at 19:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835514):
right now you can't do much with the parser or elaborator

#### [ Mario Carneiro (Aug 10 2018 at 19:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835567):
there is `lean.parser` but it's not nearly enough to do everything you should be able to

#### [ Mario Carneiro (Aug 10 2018 at 19:13)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835580):
you can't access the AST for the source or your place in it

#### [ Mario Carneiro (Aug 10 2018 at 19:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835648):
of course I have a mile long wishlist but I don't know how helpful that is

#### [ Mario Carneiro (Aug 10 2018 at 19:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131835743):
there will also be a `type_context` monad for statefully dealing with the type context. Right now it gets reinitialized a lot which makes doing custom expr traversals really expensive in lean

#### [ Patrick Massot (Aug 10 2018 at 22:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131843910):
```quote
Now when I see a newbie question that I can answer I try to answer it quickly to save Mario the bother.
```
I try to do the same, I think it's important. Mario, I think you should wait at least a couple of hours before answering a question almost anyone here could answer, this would be a better resource allocation policy.

#### [ Patrick Massot (Aug 10 2018 at 22:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131844058):
```quote
I spent a lot of time getting some kind of overview of what exactly was already in mathlib.
```
Did you write anything about this recently? I need a break from uniform spaces so yesterday I started a new doc branch in my local fork. Maybe I should push it to the community fork immediately.

#### [ Patrick Massot (Aug 10 2018 at 22:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60mk_app%60/near/131844234):
```quote
Maybe you should ask jeremy to go open source?
```
I'm not sure this is good idea. Those books, especially TPIL, have a unity of vision and style. It makes reading them feel like reading a book and not a technical reference. You can suggest improvements and additional topics, I did that and Jeremy used some. But otherwise I think we should rather write other sources of documentation.


{% endraw %}
