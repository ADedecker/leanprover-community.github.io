---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/57599errorexpectedtypeequalsgiventype.html
---

## Stream: [general](index.html)
### Topic: [error: expected type equals given type](57599errorexpectedtypeequalsgiventype.html)

---


{% raw %}
#### [ Johan Commelin (Jan 15 2019 at 11:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155160367):
<p>A mystery:</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">functor</span><span class="bp">.</span><span class="n">on_iso</span> <span class="o">(</span><span class="n">yoneda</span><span class="bp">.</span><span class="n">obj</span> <span class="n">F</span><span class="o">)</span>
<span class="n">term</span>
  <span class="n">yoneda</span><span class="bp">.</span><span class="n">obj</span> <span class="n">F</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
</pre></div>


<p>Last week <span class="user-mention" data-user-id="110032">@Reid Barton</span> and I encountered a similar error when working on over categories. Back then we could fix it by specifying a universe variable. But that still felt like a hack around a bug. This time universe annotations don't seem to help.</p>
<p>Anyway, I'm more interested in fact that Lean thinks two types are the same, but isn't happy to move on.<br>
Here is the <code>pp.all</code> version:</p>
<div class="codehilite"><pre><span></span><span class="n">has</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">functor</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span>
    <span class="o">(</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">op</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))}</span> <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="err">ùí≥</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))}</span> <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="err">ùí≥</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="err">ùí≥</span><span class="o">))</span>
    <span class="o">(</span><span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">))</span>
    <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">functor</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span>
    <span class="o">(</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">op</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))}</span> <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="err">ùí≥</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))}</span> <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="err">ùí≥</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="err">ùí≥</span><span class="o">))</span>
    <span class="o">(</span><span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">))</span>
    <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span>
</pre></div>

#### [ Sebastian Ullrich (Jan 15 2019 at 12:32)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155162452):
<p>If you have too much time and want to take a closer look, you could try turning on the various defeq traces. Not sure if the output will be of any help.</p>

#### [ Johan Commelin (Jan 15 2019 at 13:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155163901):
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I have a bit of time. Do you have a guess about what's going on? Are you interested in those traces? How do I turn them on?</p>

#### [ Sebastian Ullrich (Jan 15 2019 at 13:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164151):
<p>It should be <code>trace.type_context.is_def_eq</code> and <code>trace.type_context.is_def_eq_detail</code>. I can take a look, though I won't promise anything :) .</p>

#### [ Johan Commelin (Jan 15 2019 at 13:09)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164241):
<p>Output of <code>trace.type_context.is_def_eq</code>:</p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">m_1</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_1</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_3</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_5</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">m_1</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_3</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_5</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">F</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_4</span> <span class="bp">...</span> <span class="n">failed</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="n">functor</span><span class="bp">.</span><span class="n">category</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="o">(</span><span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">))</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">functor</span><span class="bp">.</span><span class="n">category</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="o">(</span><span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">))</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span><span class="o">]</span> <span class="err">?</span><span class="n">x_0</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="bp">...</span> <span class="n">success</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
</pre></div>

#### [ Johan Commelin (Jan 15 2019 at 13:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164317):
<p>Output of <code>trace.type_context.is_def_eq_detail</code>:</p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="err">?</span><span class="n">m_1</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_1</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_3</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_5</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">functor</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">functor</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_2</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">category</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">functor</span><span class="bp">.</span><span class="n">category</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span> <span class="o">(</span><span class="kt">Type</span> <span class="err">?</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="o">(</span><span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">category</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">functor</span><span class="bp">.</span><span class="n">category</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span> <span class="o">(</span><span class="kt">Type</span> <span class="err">?</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="err">?</span><span class="n">m_1</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_3</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_5</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">functor</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">functor</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_2</span><span class="err">·µí·µñ</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">category</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="kt">Type</span> <span class="err">?</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="kt">Type</span> <span class="err">?</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">large_category</span> <span class="o">(</span><span class="kt">Type</span> <span class="err">?</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">unfold</span> <span class="n">right</span><span class="o">:</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">large_category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="o">(</span><span class="kt">Type</span> <span class="err">?</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="n">category</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="n">X</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="n">X</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">F</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">F</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_4</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">functor</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">functor</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="err">?</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">‚•§</span> <span class="err">?</span><span class="n">m_4</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="n">category</span> <span class="err">?</span><span class="n">m_1</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span> <span class="o">(</span><span class="n">presheaf</span> <span class="n">X</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">category</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">types</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">opposite</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">x_1</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">x_1</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="n">X</span><span class="err">·µí·µñ</span> <span class="err">‚•§</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
</pre></div>

#### [ Mario Carneiro (Jan 15 2019 at 13:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164531):
<p>what does <code>convert yoneda F</code> give?</p>

#### [ Johan Commelin (Jan 15 2019 at 13:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164556):
<p>The error is in a <code>have</code> statement...</p>
<div class="codehilite"><pre><span></span><span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">functor</span><span class="bp">.</span><span class="n">on_iso</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">yoneda</span><span class="bp">.</span><span class="n">obj</span> <span class="n">F</span><span class="o">),</span>
</pre></div>

#### [ Mario Carneiro (Jan 15 2019 at 13:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164575):
<p>can you fill in the underscores?</p>

#### [ Johan Commelin (Jan 15 2019 at 13:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164579):
<p>I'll try. Give me a second.</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164640):
<p>also your <code>op</code> has a really confusing precedence</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164651):
<p>there is no way lean can parse <code>presheaf X·µí·µñ</code> means <code>(presheaf X)·µí·µñ</code> but the printer seems to think so</p>

#### [ Johan Commelin (Jan 15 2019 at 13:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155164673):
<div class="codehilite"><pre><span></span><span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">functor</span><span class="bp">.</span><span class="n">on_iso</span> <span class="o">((</span><span class="n">presheaf</span> <span class="n">X</span><span class="o">)</span><span class="err">·µí·µñ</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">yoneda</span><span class="bp">.</span><span class="n">obj</span> <span class="n">F</span><span class="o">),</span>
</pre></div>


<p>Wow... this works...</p>

#### [ Reid Barton (Jan 15 2019 at 13:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165054):
<blockquote>
<p>there is no way lean can parse <code>presheaf X·µí·µñ</code> means <code>(presheaf X)·µí·µñ</code> but the printer seems to think so</p>
</blockquote>
<p>I thought this was actually possible by using a precedence above 1000?</p>

#### [ Reid Barton (Jan 15 2019 at 13:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165061):
<p>I was wondering whether we should do that</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165111):
<p>I think you want high precedence (above <code>max = 1024</code>) to get <code>presheaf X·µí·µñ</code> = <code>presheaf (X·µí·µñ)</code></p>

#### [ Reid Barton (Jan 15 2019 at 13:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165174):
<p>Oh, I misread</p>

#### [ Reid Barton (Jan 15 2019 at 13:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165181):
<p>What you just wrote is what I want</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165245):
<p>most postfix notations are at precedence <code>:max+1</code> for this reason</p>

#### [ Kevin Buzzard (Jan 15 2019 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165251):
<p>Has this fixed the error Johan?</p>

#### [ Reid Barton (Jan 15 2019 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165253):
<p>I'm not really sure how it works now actually. But I know there are a lot of parentheses in <code>category_theory</code> that look like they ought to be unnecessary</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165266):
<p>I doubt it addresses the error though, I'm still perplexed</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165294):
<p>it seems like it's an elaboration order issue</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165388):
<p>what's up with this name? <code>category_theory.presheaf.category_theory.category</code></p>

#### [ Mario Carneiro (Jan 15 2019 at 13:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165394):
<p>just in case you forgot it's about categories</p>

#### [ Reid Barton (Jan 15 2019 at 13:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165589):
<p>Just wait until we have the category of categories</p>

#### [ Reid Barton (Jan 15 2019 at 13:36)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165640):
<p>or the category of theories</p>

#### [ Chris Hughes (Jan 15 2019 at 13:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165686):
<blockquote>
<p>or the category of theories</p>
</blockquote>
<p>Is that a thing?</p>

#### [ Johan Commelin (Jan 15 2019 at 13:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165751):
<p>I still don't understand the error.<br>
But I no longer need a solution, because I proved it differently.</p>

#### [ Johan Commelin (Jan 15 2019 at 13:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165758):
<p>It's just weird that this shows up. And like I said: Reid and I had a similar thing last week when we worked with over categories.</p>

#### [ Mario Carneiro (Jan 15 2019 at 13:41)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155165860):
<blockquote>
<p>is that a thing?</p>
</blockquote>
<p>Sure, you can use interpretations as morphisms between theories even with different languages</p>

#### [ Reid Barton (Jan 16 2019 at 12:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155247432):
<blockquote>
<p>I think you want high precedence (above <code>max = 1024</code>) to get <code>presheaf X·µí·µñ</code> = <code>presheaf (X·µí·µñ)</code></p>
</blockquote>
<p>Implemented at <a href="https://github.com/leanprover/mathlib/pull/600" target="_blank" title="https://github.com/leanprover/mathlib/pull/600">https://github.com/leanprover/mathlib/pull/600</a> (<span class="user-mention" data-user-id="112680">@Johan Commelin</span> FYI)</p>

#### [ Johan Commelin (Jan 16 2019 at 13:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/error%3A%20expected%20type%20equals%20given%20type/near/155248248):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Thanks!</p>


{% endraw %}
