---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html">Specify `apply` and other tactics inside a tactic</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="187216567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187216567" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187216567">Jason Rute (Feb 02 2020 at 19:24)</a>:</h4>
<p>I have a question about calling tactics in meta programming.  I'm making an AI* which will control certain common tactics (like apply, simp, rw, ...).  How within my own custom tactic (say within a <code>do ... return ()</code> block), do I say to run the apply tactic?  The issue is the parameter.  Here are three use cases.  How do I do them?</p>
<ol>
<li><code>apply h</code> where <code>h</code> is from the local context.  I know how to access and look at the (the expressions of the) local context.  So let's assume I know which hypothesis <code>h</code> I want to use in apply.  How do I specify that inside a tactic?</li>
<li><code>apply true.intro</code> where <code>true.intro</code> is just an example of a theorem in the environment.  Let's say I already know the name of that theorem, e.g. <code>true.intro</code>.  How do I apply it?</li>
<li><code>apply (f h)</code> where <code>f h</code> is an example of a compound term.  Again, let's say I know how to find <code>f</code> and <code>h</code> and they are either in the local context or the environment.</li>
</ol>
<p>If (3) is much harder, I am happy with solutions to (1) or (2).  Do the same basic ideas apply for tactics which takes lists of terms like <code>rw</code> or <code>simp</code>?</p>
<p>*When I say "I am making an AI", what I really mean is that I am making a prototype of a tool which lets one control tactics from outside of Lean.  I'm trying to do it through Lean's IO and not the Lean server, hence the questions.  (See more <a href="#narrow/stream/219941-Machine-Learning.20for.20Theorem.20Proving/topic/ML.20for.20Lean.3A.20How.20to.20do.20it.3F" title="#narrow/stream/219941-Machine-Learning.20for.20Theorem.20Proving/topic/ML.20for.20Lean.3A.20How.20to.20do.20it.3F">here</a> about this project.)</p>

<a name="187218455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187218455" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187218455">Reid Barton (Feb 02 2020 at 20:20)</a>:</h4>
<p>For 2, if I understand correctly, you could use <code> `[apply true.intro] </code></p>

<a name="187218541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187218541" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187218541">Reid Barton (Feb 02 2020 at 20:22)</a>:</h4>
<p>For 1, or more generally, you can just apply <code>tactic.apply</code> or even <code>tactic.interactive.apply</code> directly</p>

<a name="187221084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187221084" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187221084">Jason Rute (Feb 02 2020 at 21:35)</a>:</h4>
<p>Let me be more clear.  This will be done entirely programmatically and dynamically.  I assume I can't enter  <code> `[apply n] </code>, where <code>n</code> is a <code>name</code>/<code>expr</code>/other?</p>

<a name="187221089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187221089" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187221089">Jason Rute (Feb 02 2020 at 21:35)</a>:</h4>
<p>Anyway, I'm looking at this set of notes: <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md">https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md</a></p>

<a name="187221213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187221213" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187221213">Mario Carneiro (Feb 02 2020 at 21:38)</a>:</h4>
<p>You should use <code>tactic.apply</code></p>

<a name="187221217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187221217" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187221217">Mario Carneiro (Feb 02 2020 at 21:38)</a>:</h4>
<p>it takes an argument of type <code>expr</code>, which you can construct from any of the mentioned sources</p>

<a name="187221295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187221295" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187221295">Mario Carneiro (Feb 02 2020 at 21:40)</a>:</h4>
<p>the interactive <code>apply</code> tactic is just a shim over <code>tactic.apply</code> that parses the input pre-expression first</p>

<a name="187221305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Specify%20%60apply%60%20and%20other%20tactics%20inside%20a%20tactic/near/187221305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/53839Specifyapplyandothertacticsinsideatactic.html#187221305">Jesse Michael Han (Feb 02 2020 at 21:41)</a>:</h4>
<p>assuming "I know which hypothesis <code>h</code>" means a predicate <code>pred : expr -&gt; tactic bool</code>, you can try something like this:</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">try_apply_pred</span> <span class="o">(</span><span class="n">pred</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">bool</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">try_trace_apply</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
    <span class="bp">λ</span> <span class="n">e</span><span class="o">,</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">apply</span> <span class="n">e</span> <span class="bp">*&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;applied {e.to_string}&quot;</span> <span class="bp">&lt;|&gt;</span>
         <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;failed to apply {e.to_string}&quot;</span> <span class="k">in</span>
  <span class="n">local_context</span> <span class="bp">&gt;&gt;=</span> <span class="n">list</span><span class="bp">.</span><span class="n">mfilter</span> <span class="n">pred</span> <span class="bp">&gt;&gt;=</span> <span class="n">list</span><span class="bp">.</span><span class="n">mfoldl</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="n">e</span><span class="o">,</span> <span class="n">try_trace_apply</span> <span class="n">e</span><span class="o">)</span> <span class="o">()</span>

<span class="kn">end</span> <span class="n">interactive</span>
<span class="kn">end</span> <span class="n">tactic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">H₁</span> <span class="o">:</span> <span class="n">false</span> <span class="bp">→</span> <span class="n">true</span><span class="o">)</span> <span class="o">(</span><span class="n">H₂</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">→</span> <span class="n">true</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="c1">-- H : false → true</span>
<span class="c1">-- ⊢ true</span>
  <span class="n">try_apply_pred</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">return</span> <span class="n">true</span><span class="o">),</span>
<span class="c1">-- H : false → true</span>
<span class="c1">-- ⊢ false</span>
<span class="kn">end</span>
</pre></div>


{% endraw %}

{% include archive_update.html %}