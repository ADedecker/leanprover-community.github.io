---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/54462crec.html
---

## Stream: [general](index.html)
### Topic: [crec](54462crec.html)

---


{% raw %}
#### [ Reid Barton (Nov 27 2018 at 17:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651094):
<p>I wrote a version of well-founded recursion which allows you to maintain a "consistency" condition in the recursion.<br>
<a href="https://gist.github.com/rwbarton/7bd5b3b19d930f577355a596a5ed8b4d" target="_blank" title="https://gist.github.com/rwbarton/7bd5b3b19d930f577355a596a5ed8b4d">https://gist.github.com/rwbarton/7bd5b3b19d930f577355a596a5ed8b4d</a></p>

#### [ Reid Barton (Nov 27 2018 at 17:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651153):
<p>Compared to <code>well_founded.fix</code>, the difference is that you get to specify a condition <code>q : Π ⦃i j⦄ (h : i &lt; j), C i → C j → Prop</code>. In the induction step you can assume that all the previous choices are consistent according to <code>q</code>, and you need to produce a new value which is consistent with all the previous choices.</p>

#### [ Reid Barton (Nov 27 2018 at 17:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651171):
<p>In the end, you get a function whose values are all consistent according to <code>q</code></p>

#### [ Reid Barton (Nov 27 2018 at 17:57)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651327):
<p>Mostly it's useful when you need to have the consistency condition in hand in order to perform the next step of the recursive construction.</p>

#### [ Reid Barton (Nov 27 2018 at 17:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651402):
<p>For example, you could take <code>C n</code> to be sequences defined up to <code>n</code>, and <code>q</code> to say that the first sequence is a prefix of the second</p>

#### [ Reid Barton (Nov 27 2018 at 18:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651842):
<p>For example, suppose you want to construct an order-preserving map from <code>nat</code> to an order <code>P</code> without a greatest element. It's easy to prove by induction on <code>n</code> that there is an order-preserving map from <code>fin n</code> to <code>P</code>, but this is not good enough if these maps are all unrelated!</p>

#### [ Mario Carneiro (Nov 27 2018 at 18:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148654463):
<p>I think this could be stated as a "dependent choice" problem</p>

#### [ Mario Carneiro (Nov 27 2018 at 18:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148654486):
<p>you want the definition of <code>F a</code> to depend on <code>F b</code> for all <code>b &lt; a</code></p>

#### [ Mario Carneiro (Nov 27 2018 at 19:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148656204):
<p>ah, nevermind, I don't think I can simplify it past what you've already done. You want to define the type and value together in the recursion, but that's what <code>crec_core</code> accomplishes</p>

#### [ Mario Carneiro (Nov 27 2018 at 19:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148656406):
<p>You can probably remove the <code>i &lt; j</code> from <code>q</code>, since it's defining a prop</p>

#### [ Mario Carneiro (Nov 27 2018 at 19:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148656641):
<p>the <code>f</code> parameter of <code>H</code> can be uncurried, I don't know whether it is better or worse to also split it up into two parameters for the subtype in the target</p>

#### [ Reid Barton (Nov 27 2018 at 22:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148670810):
<p>Thanks for the suggestions. I haven't tried actually using this for anything yet, so I'll have to see what seems more natural at the use site.</p>

#### [ Johannes Hölzl (Jan 17 2019 at 10:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/155322663):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> can I add <code>crec</code> to mathlib?</p>

#### [ Reid Barton (Jan 18 2019 at 00:57)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/156330667):
<p>Yes, absolutely.<br>
<a href="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/logic/crec.lean" target="_blank" title="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/logic/crec.lean">https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/logic/crec.lean</a> is the version I actually use at the moment.<br>
I think the usability could still be improved; in particular it's not very convenient to use <code>crec</code> and <code>crec_consistent</code> separately because you typically have to repeat <code>q</code>, which could be rather complicated.</p>

#### [ Reid Barton (Jan 18 2019 at 01:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/156330879):
<p><code>crec'</code> was an attempt to improve on that, but I still haven't found the best way to use it, for example <a href="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/top_small.lean#L110-L137" target="_blank" title="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/top_small.lean#L110-L137">https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/top_small.lean#L110-L137</a> is a bit awkward.</p>


{% endraw %}
