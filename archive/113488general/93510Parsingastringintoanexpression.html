---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/93510Parsingastringintoanexpression.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html">Parsing a string into an expression</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="186852595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186852595" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186852595">Jason Rute (Jan 29 2020 at 03:15)</a>:</h4>
<p>I recently discovered that Lean can read from <code>stdin</code>.  So now I'm curious if it is possible to do the following in Lean:</p>
<ol>
<li>read in a string (representing a Lean term)</li>
<li>parse that string into an expression</li>
<li>evaluate (the term given by) that expression</li>
<li>print the output</li>
</ol>
<p>(1) and (4) are easy, but what about (2) and (3)?  I assume (3) is possible with the meta stuff, but (2), I have no idea.</p>

<a name="186852672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186852672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186852672">Jason Rute (Jan 29 2020 at 03:17)</a>:</h4>
<p>I'm actually more interested in this scenario so feel free to comment on that one also:</p>
<ol>
<li>read in a string (representing a Lean Prop)</li>
<li>parse that string into an expression</li>
<li>set that expression as a goal</li>
<li>apply a tactic to that goal</li>
<li>print the result</li>
</ol>

<a name="186852857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186852857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186852857">Jason Rute (Jan 29 2020 at 03:21)</a>:</h4>
<p>To be clear, I'm thinking about parsing Lean's syntax.  (Of course, since expressions are algebraic data structures, one can could pass in say an s-expression for that expression and write a custom parser for those s-expressions.)</p>

<a name="186853158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186853158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186853158">Jason Rute (Jan 29 2020 at 03:29)</a>:</h4>
<p>Actually, as I think about it, even if there was no Lean syntax parser, I'd still be interested in the other steps (evaluating an expression and setting an expression as a goal).</p>

<a name="186853824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186853824" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186853824">Simon Hudon (Jan 29 2020 at 03:45)</a>:</h4>
<p>For  parsing an expression: <code>lean.parser.with_input interactive.types.texpr my_string</code></p>

<a name="186853881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186853881" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186853881">Simon Hudon (Jan 29 2020 at 03:46)</a>:</h4>
<p>it will give you a <code>pexpr</code> (plus a string) which you can feed into <code>to_expr</code> to elaborate the term into something that you can evaluate or create a goal from</p>

<a name="186854030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186854030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186854030">Simon Hudon (Jan 29 2020 at 03:50)</a>:</h4>
<p>To evaluate it, you have to write a routine by hand creating a value of type you're interested in from an <code>expr</code>. It can probably be automated with some meta programming</p>

<a name="186854043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186854043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186854043">Simon Hudon (Jan 29 2020 at 03:51)</a>:</h4>
<p>To set a goal with your expression:</p>
<div class="codehilite"><pre><span></span><span class="n">v</span> <span class="bp">&lt;-</span> <span class="n">mk_meta_var</span> <span class="n">e</span><span class="o">,</span>
<span class="n">gs</span> <span class="bp">&lt;-</span> <span class="n">get_goals</span><span class="o">,</span>
<span class="n">set_goals</span> <span class="err">$</span> <span class="n">v</span> <span class="bp">::</span> <span class="n">gs</span>
</pre></div>

<a name="186854191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186854191" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186854191">Jason Rute (Jan 29 2020 at 03:55)</a>:</h4>
<p>Thanks!  I will have to try this out.</p>

<a name="186855279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186855279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186855279">Tim Daly (Jan 29 2020 at 04:22)</a>:</h4>
<p><span class="user-mention" data-user-id="115715">@Jason Rute</span> I'm very interested in any code you write for this (obviously). Please make it available either publicly or email me.</p>

<a name="186855612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186855612" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186855612">Jason Rute (Jan 29 2020 at 04:32)</a>:</h4>
<p>Sure, but I will warn you <span class="user-mention" data-user-id="223495">@Tim Daly</span> that I am a hobbist, so I might not get around to it too quickly (or I might wake up tomorrow and want to give it a try :) ).</p>

<a name="186858153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186858153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186858153">Jason Rute (Jan 29 2020 at 05:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> I got this far, but I think I am mixing the <code>parser</code> and <code>tactic</code> monads.  Do you know what I need to do here?</p>
<div class="codehilite"><pre><span></span>def experiment (s : string) : lean.parser unit :=
do
   pe &lt;- lean.parser.with_input interactive.types.texpr s,  -- parser monad
   e &lt;- to_expr pe.1,  -- tactic monad
   v &lt;- mk_meta_var e,
   gs &lt;- get_goals,
   set_goals $ v :: gs,
   t &lt;- target,
   trace t,  -- should output the goal given by the string s
   return ()
</pre></div>

<a name="186858223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186858223" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186858223">Jason Rute (Jan 29 2020 at 05:51)</a>:</h4>
<p><span class="user-mention" data-user-id="223495">@Tim Daly</span> You might be interested also in <a href="#narrow/stream/219941-Machine-Learning.20for.20Theorem.20Proving/topic/ML.20for.20Lean.3A.20How.20to.20do.20it.3F" title="#narrow/stream/219941-Machine-Learning.20for.20Theorem.20Proving/topic/ML.20for.20Lean.3A.20How.20to.20do.20it.3F">this thread</a>.  For example, I made <a href="https://github.com/jasonrute/communicating-with-lean/blob/master/communicate_with_lean.ipynb" target="_blank" title="https://github.com/jasonrute/communicating-with-lean/blob/master/communicate_with_lean.ipynb">a python prototype</a> of communicating with Lean using the Lean server.</p>

<a name="186858352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186858352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186858352">Simon Hudon (Jan 29 2020 at 05:55)</a>:</h4>
<p>Yes, that's a very annoying separation when you need to invoke the parser. You can invoke tactic from parser but not the other way around. Figuring out how to get the user to call your automation can be tricky. If you only want to call tactic from parser, you can use <code>lean.parser.of_tactic</code></p>

<a name="186858516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186858516" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186858516">Simon Hudon (Jan 29 2020 at 06:00)</a>:</h4>
<p>For the other way around, it depends on how you want to invoke the script. If you want to call it from a normal proof script (in a <code>begin</code> <code>end</code> block), then we use the <code>parse</code> syntax. Otherwise, you can define a <code>user_command</code> using the attribute <code>user_command</code> and then you just write <code>my_command .</code> at the top level and it will call your script</p>

<a name="186860041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Parsing%20a%20string%20into%20an%20expression/near/186860041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/93510Parsingastringintoanexpression.html#186860041">Mario Carneiro (Jan 29 2020 at 06:41)</a>:</h4>
<p>I don't think it is possible to use <code>with_input</code> when using <code>lean --run</code></p>


{% endraw %}

{% include archive_update.html %}