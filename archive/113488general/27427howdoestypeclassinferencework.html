---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/27427howdoestypeclassinferencework.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html">how does type class inference work?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="151259224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151259224" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151259224">Kevin Buzzard (Dec 10 2018 at 09:09)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">foo</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">blah</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="n">class</span> <span class="n">bar</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">foo</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">blah2</span> <span class="o">:</span> <span class="n">bool</span><span class="o">)</span>

<span class="n">class</span> <span class="n">baz</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">foo</span> <span class="n">A</span> <span class="bp">.</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">bar</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{</span><span class="n">blah</span> <span class="o">:=</span> <span class="mi">4</span><span class="o">,</span> <span class="n">blah2</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">}</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">bar</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- works</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">baz</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails</span>
</pre></div>


<p>Why doesn't this work?</p>

<a name="151259885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151259885" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151259885">Mario Carneiro (Dec 10 2018 at 09:25)</a>:</h4>
<p>why would it work? You declared an instance of <code>bar</code> but not <code>baz</code></p>

<a name="151260147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260147" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260147">Kevin Buzzard (Dec 10 2018 at 09:30)</a>:</h4>
<p>I can figure out how to make an instance of <code>baz</code>, that's why I can believe it would work. All the fields are there. This is my problem -- I don't know what the type class inference system is _doing_.</p>

<a name="151260186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260186">Kevin Buzzard (Dec 10 2018 at 09:31)</a>:</h4>
<p>Oh sorry there's a typo -- I meant to write</p>
<p><code>example : foo ℤ := by apply_instance -- works</code></p>
<p>I didn't declare an instance of <code>foo</code> but it found it anyway.</p>

<a name="151260244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260244" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260244">Kevin Buzzard (Dec 10 2018 at 09:32)</a>:</h4>
<p>I literally do not know what it can and cannot do.</p>

<a name="151260256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260256">Kevin Buzzard (Dec 10 2018 at 09:32)</a>:</h4>
<p>All I know is that it can do less than me, because I can solve <code>baz</code>.</p>

<a name="151260277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260277" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260277">Kenny Lau (Dec 10 2018 at 09:33)</a>:</h4>
<p><code>class baz (A : Type) extends foo A .</code><br>
this creates an instance <code>baz.to_foo</code></p>

<a name="151260291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260291" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260291">Kenny Lau (Dec 10 2018 at 09:33)</a>:</h4>
<p>if you want to make <code>baz</code> from <code>foo</code> then you would need to use <code>{ .. infer_instance }</code></p>

<a name="151260308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260308">Kevin Buzzard (Dec 10 2018 at 09:33)</a>:</h4>
<p>Well, maybe I should just create an instance <code>baz.from_foo</code></p>

<a name="151260369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260369" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260369">Kevin Buzzard (Dec 10 2018 at 09:34)</a>:</h4>
<p>or maybe <code>foo.to_baz</code> would be more appropriate.</p>

<a name="151260399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260399">Kenny Lau (Dec 10 2018 at 09:35)</a>:</h4>
<p>congratulations, you've thrown yourself into a loop</p>

<a name="151260514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260514">Kevin Buzzard (Dec 10 2018 at 09:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">foo</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">blah</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="n">class</span> <span class="n">bar</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">foo</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">blah2</span> <span class="o">:</span> <span class="n">bool</span><span class="o">)</span>

<span class="n">class</span> <span class="n">baz</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">foo</span> <span class="n">A</span> <span class="bp">.</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">bar</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{</span><span class="n">blah</span> <span class="o">:=</span> <span class="mi">4</span><span class="o">,</span> <span class="n">blah2</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">}</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- works</span>

<span class="c1">-- type class inference is so stupid, why doesn&#39;t it just guess this.</span>
<span class="kn">instance</span> <span class="n">foo</span><span class="bp">.</span><span class="n">to_baz</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">foo</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">baz</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails? WTF?</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">baz</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- still fails</span>
</pre></div>


<p>I broke everything.</p>

<a name="151260535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260535" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260535">Kevin Buzzard (Dec 10 2018 at 09:37)</a>:</h4>
<p>I don't understand why everything is broken. Everything is defeq, right?</p>

<a name="151260617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260617">Kenny Lau (Dec 10 2018 at 09:38)</a>:</h4>
<p>you now have <code>foo.to_baz</code> and <code>baz.to_foo</code></p>

<a name="151260621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260621" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260621">Kenny Lau (Dec 10 2018 at 09:38)</a>:</h4>
<p>so the machine gets stuck forever</p>

<a name="151260645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260645" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260645">Kevin Buzzard (Dec 10 2018 at 09:39)</a>:</h4>
<p><code>example (A : Type) (H : foo A) : H = baz.to_foo A := rfl</code></p>

<a name="151260716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260716" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260716">Kevin Buzzard (Dec 10 2018 at 09:40)</a>:</h4>
<p>I don't understand why it gets stuck forever. What is it doing? I am pretty convinced it's not playing the "let's see how many instances I can make from this instance, for no reason whatsoever" game. I ask the type class inference system to produce me a term of a typeclass, it should just try and try until it finds one and then stop.</p>

<a name="151260728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260728">Kevin Buzzard (Dec 10 2018 at 09:40)</a>:</h4>
<p>Of course I completely understand that I have made a loop. What I don't understand is why this even matters.</p>

<a name="151260734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260734">Kenny Lau (Dec 10 2018 at 09:40)</a>:</h4>
<p>oh it <em>is</em> playing that game</p>

<a name="151260737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260737">Kevin Buzzard (Dec 10 2018 at 09:40)</a>:</h4>
<p>It is??</p>

<a name="151260742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260742" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260742">Kenny Lau (Dec 10 2018 at 09:40)</a>:</h4>
<p>wait no it isn't</p>

<a name="151260756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260756" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260756">Kevin Buzzard (Dec 10 2018 at 09:41)</a>:</h4>
<p>But your response makes me think that you can write some simple thing which will make it play this game.</p>

<a name="151260772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260772">Kenny Lau (Dec 10 2018 at 09:41)</a>:</h4>
<p>well you want it to figure out <code>baz</code>. then it goes like "hey I can make this from <code>foo</code>". then it goes like "hey I can make this from <code>baz</code>". ad nauseam</p>

<a name="151260775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260775">Kenny Lau (Dec 10 2018 at 09:41)</a>:</h4>
<p>so maybe priority is the answer</p>

<a name="151260823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260823">Kevin Buzzard (Dec 10 2018 at 09:42)</a>:</h4>
<p>Do you know where it starts? At the top or the bottom?</p>

<a name="151260859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260859">Kevin Buzzard (Dec 10 2018 at 09:42)</a>:</h4>
<p>It says "Hmm, I want to make  an instance of <code>baz A</code>". Now does it say "OK so how do we make instances of <code>baz A</code>? or does it say "OK what other typeclasses can I make with <code>A</code>"? Hmm, I guess it must be the former.</p>

<a name="151260883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260883">Kenny Lau (Dec 10 2018 at 09:43)</a>:</h4>
<p>it is the former</p>

<a name="151260925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260925" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260925">Kevin Buzzard (Dec 10 2018 at 09:43)</a>:</h4>
<p>So the type class system looks through <em>all instances</em> and tries to find one whose head term is <code>baz</code>?</p>

<a name="151260929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260929" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260929">Kevin Buzzard (Dec 10 2018 at 09:44)</a>:</h4>
<p>Say it finds ten such things. What does it do now?</p>

<a name="151260970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260970" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260970">Kenny Lau (Dec 10 2018 at 09:44)</a>:</h4>
<p>apply each one</p>

<a name="151260973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260973">Kenny Lau (Dec 10 2018 at 09:44)</a>:</h4>
<p>(but mind you, it uses depth-first search)</p>

<a name="151260979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260979">Kevin Buzzard (Dec 10 2018 at 09:44)</a>:</h4>
<p>"Head term" -- is that the right phrase? I mean "a term which is a function <code>baz [something]</code></p>

<a name="151260983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151260983" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151260983">Kevin Buzzard (Dec 10 2018 at 09:44)</a>:</h4>
<p>What is depth-first search?</p>

<a name="151261002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261002">Kenny Lau (Dec 10 2018 at 09:45)</a>:</h4>
<p>depth-first search = dig this hole as deep as possible until you find gold or you are blocked by a stone, and then move on to the next hole</p>

<a name="151261014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261014">Kevin Buzzard (Dec 10 2018 at 09:45)</a>:</h4>
<p>Is this the one where it finds the first instance of <code>baz A</code> and finds that it needs <code>moo A</code> and it checks for a term of type <code>moo A</code> and temporarily forgets all about the other nine ideas about <code>baz</code> and just looks for <code>moo</code> stuff?</p>

<a name="151261087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261087">Kenny Lau (Dec 10 2018 at 09:46)</a>:</h4>
<p>breadth-first search = dig this hole 1 cm, go to next hole and dig 1cm, and so on until you run out of holes, and then go back to the first hole and dig 1cm, etc</p>

<a name="151261114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261114" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261114">Kenny Lau (Dec 10 2018 at 09:46)</a>:</h4>
<blockquote>
<p>Is this the one where it finds the first instance of <code>baz A</code> and finds that it needs <code>moo A</code> and it checks for a term of type <code>moo A</code> and if it can't find that it forgets all about the other nine ideas about <code>baz</code> and just looks for <code>moo</code> stuff?</p>
</blockquote>
<p>precisely</p>

<a name="151261125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261125" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261125">Kevin Buzzard (Dec 10 2018 at 09:46)</a>:</h4>
<p>How does it conclude that it is blocked by a stone?</p>

<a name="151261151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261151">Kevin Buzzard (Dec 10 2018 at 09:47)</a>:</h4>
<p>Can this only happen when there are literally no instances which have the right head term or whatever the phrase is?</p>

<a name="151261160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261160">Kenny Lau (Dec 10 2018 at 09:47)</a>:</h4>
<p>yes</p>

<a name="151261214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261214" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261214">Kenny Lau (Dec 10 2018 at 09:48)</a>:</h4>
<p>so for example there is no instance that produces <code>ordered_canonical_discrete_ordered_field</code> or whatever the flying that is</p>

<a name="151261221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261221" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261221">Kenny Lau (Dec 10 2018 at 09:48)</a>:</h4>
<p>because it's the highest structure</p>

<a name="151261260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261260" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261260">Kevin Buzzard (Dec 10 2018 at 09:49)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">H1</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H11</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H1</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H12</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H1</span> <span class="n">A</span> <span class="bp">.</span>
</pre></div>


<p>Does this segfault for you?</p>

<a name="151261317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261317">Kevin Buzzard (Dec 10 2018 at 09:50)</a>:</h4>
<p>I am trying to do some simple experiments.</p>

<a name="151261336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261336">Kenny Lau (Dec 10 2018 at 09:50)</a>:</h4>
<p>no it doesn't</p>

<a name="151261421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261421">Sebastian Ullrich (Dec 10 2018 at 09:52)</a>:</h4>
<blockquote>
<p>Can this only happen when there are literally no instances which have the right head term or whatever the phrase is?</p>
</blockquote>
<p>No, it's sufficient that no instance of the target class can be unified with the target</p>

<a name="151261476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261476">Kevin Buzzard (Dec 10 2018 at 09:53)</a>:</h4>
<p>Hmm, thanks, I'll restart VS Code.</p>

<a name="151261537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261537">Kenny Lau (Dec 10 2018 at 09:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> what's the difference?</p>

<a name="151261551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261551" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261551">Patrick Massot (Dec 10 2018 at 09:54)</a>:</h4>
<p>The head symbol could match but not the rest</p>

<a name="151261571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261571" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261571">Kevin Buzzard (Dec 10 2018 at 09:55)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">H1</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H11</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H1</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H12</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H1</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H111</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H11</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H121</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H12</span> <span class="n">A</span> <span class="bp">.</span>

<span class="kn">instance</span> <span class="n">H1</span><span class="bp">.</span><span class="n">to_H11</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">H1</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">H11</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="n">H11</span><span class="bp">.</span><span class="n">to_H111</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">H11</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">H111</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">H121</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">H111</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>


<p>That seems to have gone really well.</p>

<a name="151261646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261646">Kevin Buzzard (Dec 10 2018 at 09:56)</a>:</h4>
<p>I am trying to get into trouble. I am trying to get max class inference thingy error</p>

<a name="151261672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261672">Kenny Lau (Dec 10 2018 at 09:57)</a>:</h4>
<p>but you didn't create any loop...</p>

<a name="151261675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261675" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261675">Kenny Lau (Dec 10 2018 at 09:57)</a>:</h4>
<p>oh wait you did</p>

<a name="151261679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261679" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261679">Kevin Buzzard (Dec 10 2018 at 09:57)</a>:</h4>
<p>Right, H1 and H11 loop</p>

<a name="151261682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151261682" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151261682">Kevin Buzzard (Dec 10 2018 at 09:57)</a>:</h4>
<p>but I managed to get past the loop and up to H111</p>

<a name="151262058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151262058" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151262058">Patrick Massot (Dec 10 2018 at 10:06)</a>:</h4>
<p>Kevin, in your case there exactly one instance to try at each step, and it clearly succeeds without ever risking a loop:</p>
<div class="codehilite"><pre><span></span>[class_instances]  class-instance resolution trace
[class_instances] (0) ?x_0 : H111 unit := @H11.to_H111 ?x_1 ?x_2
[class_instances] (1) ?x_2 : H11 unit := @H1.to_H11 ?x_3 ?x_4
[class_instances] (2) ?x_4 : H1 unit := @H12.to_H1 ?x_5 ?x_6
[class_instances] (3) ?x_6 : H12 unit := @H121.to_H12 ?x_7 ?x_8
[class_instances] (4) ?x_8 : H121 unit := unit.H121
</pre></div>


<p>You can simply draw the instance graph and see it</p>

<a name="151262747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151262747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151262747">Kevin Buzzard (Dec 10 2018 at 10:24)</a>:</h4>
<p>I want to make it get stuck in a loop</p>

<a name="151262764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151262764" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151262764">Kevin Buzzard (Dec 10 2018 at 10:25)</a>:</h4>
<p>To find <code>H111</code> it suffices to find <code>H1</code>. Can I make it look for <code>H1</code> by going back to <code>H12</code>?</p>

<a name="151262817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151262817" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151262817">Kevin Buzzard (Dec 10 2018 at 10:26)</a>:</h4>
<p>Oh I see, that instance is not even there.</p>

<a name="151262875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151262875" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151262875">Kevin Buzzard (Dec 10 2018 at 10:27)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">H1</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H11</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H1</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H12</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H1</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H111</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H11</span> <span class="n">A</span> <span class="bp">.</span>

<span class="n">class</span> <span class="n">H121</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">H12</span> <span class="n">A</span> <span class="bp">.</span>

<span class="kn">instance</span> <span class="n">H1</span><span class="bp">.</span><span class="n">to_H11</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">H1</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">H11</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="n">H11</span><span class="bp">.</span><span class="n">to_H111</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">H11</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">H111</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="n">H1</span><span class="bp">.</span><span class="n">to_H12</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">H1</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">H12</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="n">H12</span><span class="bp">.</span><span class="n">to_H121</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">H12</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">H121</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">H121</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refine</span> <span class="o">{}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">H111</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- max depth reached</span>
</pre></div>


<p>Bingo.</p>

<a name="151262890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151262890" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151262890">Kevin Buzzard (Dec 10 2018 at 10:27)</a>:</h4>
<p>So whatever is type class inference thinking here? Why go back to <code>H12</code> when we have been there already?</p>

<a name="151263019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263019" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263019">Kevin Buzzard (Dec 10 2018 at 10:30)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">H111</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- max depth reached</span>
</pre></div>


<p>gives random stuff such as</p>
<div class="codehilite"><pre><span></span>[class_instances] (0) ?x_0 : has_one ℕ := unsigned.has_one
</pre></div>


<p>Who said anything about nat?</p>

<a name="151263079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263079" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263079">Kevin Buzzard (Dec 10 2018 at 10:31)</a>:</h4>
<p>I'm glad the type class inference system's job isn't finding its way out of mazes.</p>

<a name="151263165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263165" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263165">Mario Carneiro (Dec 10 2018 at 10:33)</a>:</h4>
<p>usually one writes a depth first search with a search stack to prevent loops like this</p>

<a name="151263180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263180">Patrick Massot (Dec 10 2018 at 10:33)</a>:</h4>
<p>The nat thing is related to my question to Sebastian about shortcut. It has nothing to do with your problem, it's something Lean solves for itself in its meta-work</p>

<a name="151263184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263184" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263184">Mario Carneiro (Dec 10 2018 at 10:33)</a>:</h4>
<p>I'm not sure why typeclass inference doesn't have one</p>

<a name="151263234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263234">Mario Carneiro (Dec 10 2018 at 10:34)</a>:</h4>
<p>then again, this wouldn't prevent problems with loops that look different the second time around</p>

<a name="151263243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151263243" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151263243">Mario Carneiro (Dec 10 2018 at 10:34)</a>:</h4>
<p>i.e. the same instances are being used but the instantiations are different</p>

<a name="151264966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151264966" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151264966">Kevin Buzzard (Dec 10 2018 at 11:07)</a>:</h4>
<p>OK this is great. I have to interview a bunch of people now but I will probably be back later on with more dumb questions. This has been a great start. Thanks to all.</p>

<a name="151390897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20type%20class%20inference%20work%3F/near/151390897" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/27427howdoestypeclassinferencework.html#151390897">Joe Hendrix (Dec 10 2018 at 19:20)</a>:</h4>
<p>Conceptually, Lean could require one to prove instance backchaining is well-founded.  Haskell has static checks to ensure this, but those can be bypassed via language pragma.</p>


{% endraw %}
