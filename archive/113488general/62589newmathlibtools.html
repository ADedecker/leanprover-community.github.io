---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/62589newmathlibtools.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html">new mathlib tools</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="188884880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188884880" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188884880">Patrick Massot (Feb 23 2020 at 21:19)</a>:</h4>
<p>I need infrastructure testers again. This thread is for you if you want to help users, especially beginners, and you have a working elan+python3+pip installation (and are not afraid of temporarily screwing up your mathlib tools). The install procedure is:</p>
<ul>
<li><code>git clone https://github.com/leanprover-community/mathlib-tools.git</code> if you don't already have it</li>
<li><code>cd mathlib-tools</code></li>
<li><code>git checkout refactor</code></li>
<li>
<p><code>sudo pip3 install .</code><br>
Then you should have a brand new <code>leancli</code> toy (whose name is up for discussion). It is meant to replace <code>leanpkg</code>+<code>update-mathlib</code>+<code>cache_olean</code> except that one task corresponds to one command. Things to try out:</p>
</li>
<li>
<p><code>leancli new myprojet</code> should create a new lean project with mathlib ready to go.</p>
</li>
<li>in a project depending on mathlib, <code>leancli upgrade-mathlib</code> should upgrade mathlib, including oleans</li>
<li>in mathlib, <code>leancli upgrade-mathlib</code> should upgrade mathlib, including oleans</li>
<li>in a project not depending on mathlib (?!),  <code>leancli add-mathlib</code> should make it a decent Lean project, including oleans</li>
<li>in any project, <code>leancli mk-cache</code> and <code>lean-cli get-cache</code> should make and fetch olean cache. If this project is mathlib, that cache will live in <code>$HOME/.mathlib</code>, else it will live in <code>_cache</code> in the project</li>
<li>in any project, <code>leancli build</code> should do a <code>leanpkg build</code></li>
<li>in any project, <code>leancli hooks</code> should do what <code>setup-git-hooks</code> used to do</li>
<li><code>leancli get tutorials</code> should give you the tutorials project, ready to use (alternative commands: <code>leancli get leanprover-community/tutorials</code> or <code>leancli get https://github.com/leanprover-community/tutorials.git</code>)</li>
</ul>

<a name="188888476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188888476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188888476">Kevin Buzzard (Feb 23 2020 at 23:10)</a>:</h4>
<p><code>leancli new myprojet</code> seems to work for me on Ubuntu 18.04, but probably that was the least of your worries.</p>

<a name="188889734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188889734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188889734">Patrick Massot (Feb 23 2020 at 23:50)</a>:</h4>
<p>This is still good to know!</p>

<a name="188889975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188889975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188889975">Alex J. Best (Feb 23 2020 at 23:59)</a>:</h4>
<p>On OSX: making  new project works fine! When I go to mathlib and run <code>leancli upgrade-mathlib</code> (why did the name change from <code>update-mathlib</code>?) I get:</p>
<div class="codehilite"><pre><span></span>+alex:~/mathlib ((bcb63ebf...)) üêå leancli upgrade-mathlib
Traceback (most recent call last):
  File &quot;/usr/local/bin/leancli&quot;, line 8, in &lt;module&gt;
    sys.exit(main())
  File &quot;/usr/local/lib/python3.7/site-packages/mathlibtools/leancli.py&quot;, line 75, in main
    &#39;hooks&#39;: hooks,
  File &quot;/usr/local/lib/python3.7/site-packages/fire/core.py&quot;, line 138, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File &quot;/usr/local/lib/python3.7/site-packages/fire/core.py&quot;, line 471, in _Fire
    target=component.__name__)
  File &quot;/usr/local/lib/python3.7/site-packages/fire/core.py&quot;, line 675, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File &quot;/usr/local/lib/python3.7/site-packages/mathlibtools/leancli.py&quot;, line 26, in upgrade_mathlib
    proj().upgrade_mathlib()
  File &quot;/usr/local/lib/python3.7/site-packages/mathlibtools/leanproject.py&quot;, line 306, in upgrade_mathlib
    rem = next(remote for remote in self.repo.remotes
StopIteration
</pre></div>

<a name="188890180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188890180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188890180">Alex J. Best (Feb 24 2020 at 00:03)</a>:</h4>
<p>I believe this is my bad for having my mathlib remote url still pointing to <code>https://github.com/leanprover/mathlib.git</code>  which is the old url</p>

<a name="188890186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188890186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188890186">Alex J. Best (Feb 24 2020 at 00:03)</a>:</h4>
<p>But probably this situation should still be handled either with a nice error message, or it shouldn't be too hard to make this url work too.</p>

<a name="188890234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188890234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188890234">Alex J. Best (Feb 24 2020 at 00:04)</a>:</h4>
<p>e.g. "You do not appear to have <code>leanprover-community/mathlib</code> as a remote for this repository. Are you sure you are in a mathlib repository?"</p>

<a name="188890438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188890438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188890438">Alex J. Best (Feb 24 2020 at 00:09)</a>:</h4>
<p>After fixing that and making sure I was on the <code>lean-3.5.1</code> branch it looks to work.<br>
One annoyance is that I usually checkout <code>origin/lean-3.5.1</code> which makes it error, maybe that was bad practice on my account still.</p>

<a name="188905857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188905857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188905857">Patrick Massot (Feb 24 2020 at 07:47)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="127136">@Alex J. Best</span>. About the upgrade name: this mess comes from the discrepancy between the existing <code>leanpkg upgrade</code> and <code>update-mathlib</code>. But I think I'll introduce aliases so that <code>leancli upgrade-mathlib</code>, <code>leancli update-mathlib</code> and <code>leancli up</code> all do the same.</p>

<a name="188905927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188905927" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188905927">Patrick Massot (Feb 24 2020 at 07:49)</a>:</h4>
<p>About git pulling mathlib, this is clearly the trickiest part, because there can be a wild diversity of git situations. I'll add a couple more heuristics, but the documentation will need to point out that, if you are in a weird setup, you can always do <code>git pull whatever &amp;&amp; leancli get-cache</code>.</p>

<a name="188905954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188905954" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188905954">Patrick Massot (Feb 24 2020 at 07:49)</a>:</h4>
<p>It would be nice to have tests on Windows as well. By <span class="user-mention" data-user-id="110596">@Rob Lewis</span> or <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> maybe?</p>

<a name="188906019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188906019" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188906019">Patrick Massot (Feb 24 2020 at 07:50)</a>:</h4>
<p>Also I think <span class="user-mention" data-user-id="110087">@Scott Morrison</span> recently complained about API rate limit errors. Would you mind trying this brand new toy which should never hit that error (unless you ask for ancient nightlies).</p>

<a name="188911964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188911964" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188911964">Rob Lewis (Feb 24 2020 at 09:48)</a>:</h4>
<p>Thanks Patrick! I haven't tried it yet but this looks very nice. Can I bikeshed about the name? <code>leancli</code> sounds kind of awkward. What about <code>leanproject</code>? (Or <code>lean-project</code>?)</p>

<a name="188912009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188912009" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188912009">Johan Commelin (Feb 24 2020 at 09:48)</a>:</h4>
<p><code>cliean</code>?</p>

<a name="188914214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188914214" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188914214">Gabriel Ebner (Feb 24 2020 at 10:24)</a>:</h4>
<p>I can confirm that <code>leancli get-cache</code> works for me.  Regarding the name: since we already have all kinds of puns (<code>elan</code>, <code>trepplein</code>, lean forward, lean together, etc.), how about <code>penche</code>?</p>

<a name="188921285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921285">Vaibhav Karve (Feb 24 2020 at 12:36)</a>:</h4>
<p>Another name suggestion: <code>cline</code>.</p>

<a name="188921507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921507" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921507">Patrick Massot (Feb 24 2020 at 12:39)</a>:</h4>
<p>As I wrote in the first message of this thread, the name is definitely open for bike-shedding. But I don't get the pun with <code>penche</code>.</p>

<a name="188921614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921614">Gabriel Ebner (Feb 24 2020 at 12:41)</a>:</h4>
<p>According to my French dictionary, "pencher" means "to lean".</p>

<a name="188921618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921618">Patrick Massot (Feb 24 2020 at 12:41)</a>:</h4>
<p>Are there other remarks about how the tools work? I was teaching this morning, and at 2 I'll go back to teach for three hours, so you all have time for testing.</p>

<a name="188921669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921669" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921669">Patrick Massot (Feb 24 2020 at 12:42)</a>:</h4>
<p>Oh, I didn't even think to try to read it as French.</p>

<a name="188921676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921676" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921676">Patrick Massot (Feb 24 2020 at 12:42)</a>:</h4>
<p>Ok, so it does work.</p>

<a name="188921700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921700" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921700">Johan Commelin (Feb 24 2020 at 12:42)</a>:</h4>
<p>What is "lean" as in "thin" in French?</p>

<a name="188921715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921715" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921715">Patrick Massot (Feb 24 2020 at 12:43)</a>:</h4>
<p>"mince" or "svelte"</p>

<a name="188921734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921734">Patrick Massot (Feb 24 2020 at 12:43)</a>:</h4>
<p>depending on context</p>

<a name="188921762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188921762" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188921762">Johan Commelin (Feb 24 2020 at 12:43)</a>:</h4>
<p>Ha, <code>mince</code> sounds like you're try to turn the olean files into minced meat or something (-;</p>

<a name="188922090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188922090" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188922090">Anne Baanen (Feb 24 2020 at 12:48)</a>:</h4>
<p>How about <code>fuzhou</code>, apparently the name of a prefecture in China which contains Le'an County?</p>

<a name="188922444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188922444" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188922444">Gabriel Ebner (Feb 24 2020 at 12:53)</a>:</h4>
<blockquote>
<p>Le'an County</p>
</blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> for <code>‰πêÂÆâ new-project</code>, this reduces the risk of name collision.</p>

<a name="188928748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188928748" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188928748">Rob Lewis (Feb 24 2020 at 14:09)</a>:</h4>
<p>It's certainly more boring than <code>‰πêÂÆâ</code>, but the grammar of <code>leanproject</code> sounds nice. <code>leanproject new</code>, <code>leanproject upgrade-mathlib</code>, <code>leanproject fetch-cache</code>. When you have supporting tools that are going in peoples' paths, I think it's nice to make the name obviously connect to the main tool. If someone installed this and forgot about it, they'd have no idea after a while that <code>penche</code> and <code>lean</code> were connected.</p>

<a name="188946401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188946401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188946401">Patrick Massot (Feb 24 2020 at 17:21)</a>:</h4>
<p>Ok, let's name that <code>leanproject</code>. Should I make a couple of fixes and open a PR to mathlib-tools or are there still people who want to test this or ask for different features? Are there people who would miss the current <code>update-mathlib</code>, <code>cache-olean</code> and <code>setup-git-hooks</code>? Or course <code>leanpkg</code> will stay, even if its direct use will be somehow deprecated.</p>

<a name="188946506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188946506" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188946506">Johan Commelin (Feb 24 2020 at 17:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Thanks a lot for investing time in building this tool</p>

<a name="188950445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188950445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188950445">Sebastien Gouezel (Feb 24 2020 at 18:07)</a>:</h4>
<p>I just got a failure</p>
<div class="codehilite"><pre><span></span>PS C:\Users\sebas\Desktop\mathlib_master - Copie&gt; leancli upgrade-mathlib
Looking for local mathlib oleans
Looking for Azure mathlib oleans
Trying to download https://oleanstorage.blob.core.windows.net/mathlib/8030469cccb4306230015df55ba50a5e280727bf.tar.gz¬†to C:\Users\sebas\.mathlib\8030469cccb4306230015df55ba50a5e280727bf.tar.gz
Traceback (most recent call last):
  File &quot;C:\Program Files\Python37\Scripts\leancli-script.py&quot;, line 11, in &lt;module&gt;
    load_entry_point(&#39;mathlibtools==0.0.3&#39;, &#39;console_scripts&#39;, &#39;leancli&#39;)()
  File &quot;c:\program files\python37\lib\site-packages\mathlibtools\leancli.py&quot;, line 75, in main
    &#39;hooks&#39;: hooks,
  File &quot;c:\program files\python37\lib\site-packages\fire\core.py&quot;, line 138, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File &quot;c:\program files\python37\lib\site-packages\fire\core.py&quot;, line 471, in _Fire
    target=component.__name__)
  File &quot;c:\program files\python37\lib\site-packages\fire\core.py&quot;, line 675, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File &quot;c:\program files\python37\lib\site-packages\mathlibtools\leancli.py&quot;, line 26, in upgrade_mathlib
    proj().upgrade_mathlib()
  File &quot;c:\program files\python37\lib\site-packages\mathlibtools\leanproject.py&quot;, line 317, in upgrade_mathlib
    self.get_mathlib_olean()
  File &quot;c:\program files\python37\lib\site-packages\mathlibtools\leanproject.py&quot;, line 227, in get_mathlib_olean
    unpack_archive(get_mathlib_archive(self.mathlib_rev),
  File &quot;c:\program files\python37\lib\site-packages\mathlibtools\leanproject.py&quot;, line 117, in get_mathlib_archive
    download(AZURE_URL+fname, path)
  File &quot;c:\program files\python37\lib\site-packages\mathlibtools\leanproject.py&quot;, line 96, in download
    with target.open(&#39;wb&#39;) as tgt:
  File &quot;c:\program files\python37\lib\pathlib.py&quot;, line 1165, in open
    opener=self._opener)
  File &quot;c:\program files\python37\lib\pathlib.py&quot;, line 1019, in _opener
    return self._accessor.open(self, flags, mode)
FileNotFoundError: [Errno 2] No such file or directory: &#39;C:\\Users\\sebas\\.mathlib\\8030469cccb4306230015df55ba50a5e280727bf.tar.gz&#39;
</pre></div>


<p>I then created by hand the directory <code>'C:\\Users\\sebas\\.mathlib</code> and tried again, and it worked.</p>

<a name="188955427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188955427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188955427">Mario Carneiro (Feb 24 2020 at 19:04)</a>:</h4>
<p>It seems like the error reporting situation here is not great. When a big script like this fails I have no idea how to recover or what alternative steps to take</p>

<a name="188955569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188955569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188955569">Mario Carneiro (Feb 24 2020 at 19:06)</a>:</h4>
<p>Could you maybe sprinkle some <code>try:</code> around in the code and explain to the user what went wrong? User facing errors are not supposed to be stackdumps</p>

<a name="188955646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188955646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188955646">Patrick Massot (Feb 24 2020 at 19:07)</a>:</h4>
<p>Sure. We are at the testing phase where I do need to see tracebacks (not stackdumps...). But then I'll hide all that.</p>

<a name="188961334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188961334" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188961334">Gabriel Ebner (Feb 24 2020 at 20:11)</a>:</h4>
<blockquote>
<p>Or course leanpkg will stay</p>
</blockquote>
<p><code>leanpkg</code> doesn't do anything magic.  There's nothing to stop you from replacing parts or all of it within <code>leanproject</code> if you want.</p>

<a name="188961454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188961454" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188961454">Patrick Massot (Feb 24 2020 at 20:12)</a>:</h4>
<p>I could avoid calling it from <code>leanproject</code>, but I guess we shouldn't remove it from <code>leanprover-community/lean</code></p>

<a name="188968273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188968273" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188968273">Patrick Massot (Feb 24 2020 at 21:31)</a>:</h4>
<p>I pushed a new version. Everybody is welcome to test (again). Please see the first message in this thread, except that <code>leancli</code> is now called <code>leanproject</code>.</p>

<a name="188968600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188968600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188968600">Patrick Massot (Feb 24 2020 at 21:35)</a>:</h4>
<p>Note that <code>leanproject up</code> will have a hard time working on mathlib master. It may pull the lastest commit on master before CI builds it and pushes it to the cloud.</p>

<a name="188970878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188970878" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188970878">Patrick Massot (Feb 24 2020 at 22:01)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib-tools/pull/16" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/16">https://github.com/leanprover-community/mathlib-tools/pull/16</a></p>

<a name="188970918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188970918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188970918">Patrick Massot (Feb 24 2020 at 22:01)</a>:</h4>
<p>Now is a good time to test!</p>

<a name="188971114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188971114" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188971114">Patrick Massot (Feb 24 2020 at 22:03)</a>:</h4>
<p>Oh, CI fails. I haven't modified any CI instructions. Is anyone familiar with CI on this repository and could try to port it to the new system?</p>

<a name="188971239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188971239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188971239">Patrick Massot (Feb 24 2020 at 22:05)</a>:</h4>
<p>Note that the PR does include tests, ran by tox against python 3.5, 3.6, 3.7 and 3.8.</p>

<a name="188971356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188971356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188971356">Patrick Massot (Feb 24 2020 at 22:06)</a>:</h4>
<p>I'll work on this CI tomorrow if nobody does it while I sleep, but everybody can already test by cloning the branch and installing. And everybody can review the python code.</p>

<a name="188972968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188972968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188972968">Scott Morrison (Feb 24 2020 at 22:26)</a>:</h4>
<p>Is the intention to eventually drop the separate repository, and just include this tool in the main (community) lean repository?</p>

<a name="188972996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188972996" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188972996">Patrick Massot (Feb 24 2020 at 22:27)</a>:</h4>
<p>I don't know. I don't remember why we separated this repository.</p>

<a name="188974432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188974432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188974432">Simon Hudon (Feb 24 2020 at 22:46)</a>:</h4>
<p>We separated it because of how different the testing of the tools was from testing the mathlib PRs and it caused the mathlib builds to fail for unforeseen reasons</p>

<a name="188974807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188974807" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188974807">Patrick Massot (Feb 24 2020 at 22:51)</a>:</h4>
<p>Sounds reasonable.</p>

<a name="188998727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188998727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188998727">Johan Commelin (Feb 25 2020 at 08:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> When I run <code>leanproject get-cache</code> I get</p>
<div class="codehilite"><pre><span></span>Trying to download https://oleanstorage.blob.core.windows.net/mathlib/5770369f6d3f28356be20931c9ade07be37a01ad.tar.gz¬†to /home/jmc/.mathlib/5770369f6d3f28356be20931c9ade07be37a01ad.tar.gz
</pre></div>


<p>That's still the older slower URL, right?</p>

<a name="188998753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/188998753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#188998753">Johan Commelin (Feb 25 2020 at 08:04)</a>:</h4>
<p>Also, should <code>leanproject up</code> work in a mathlib directory? That's not clear to me from the output of <code>--help</code></p>

<a name="189000957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189000957" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189000957">Patrick Massot (Feb 25 2020 at 08:48)</a>:</h4>
<p>I thought I changed the url, but something went wrong. This should work now</p>

<a name="189000991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189000991" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189000991">Patrick Massot (Feb 25 2020 at 08:49)</a>:</h4>
<p>About upgrade, how would you phrase the help message to make it clear it will work everywhere?</p>

<a name="189001690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001690" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001690">Johan Commelin (Feb 25 2020 at 09:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> What is the difference with <code>up</code>?</p>

<a name="189001700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001700" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001700">Johan Commelin (Feb 25 2020 at 09:02)</a>:</h4>
<p>I mean <code>get-cache</code> vs <code>up</code>.</p>

<a name="189001711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001711" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001711">Patrick Massot (Feb 25 2020 at 09:02)</a>:</h4>
<p>In mathlib itself, <code>up</code> will try to <code>git pull</code> then get oleans</p>

<a name="189001719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001719" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001719">Johan Commelin (Feb 25 2020 at 09:02)</a>:</h4>
<p>Aha, I see.</p>

<a name="189001733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001733" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001733">Patrick Massot (Feb 25 2020 at 09:03)</a>:</h4>
<p>In a project depending on mathlib, up will do what <code>leanpkg upgrade</code>+<code>leanpkg configure</code>+<code>update-mathlib</code> did</p>

<a name="189001741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001741" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001741">Patrick Massot (Feb 25 2020 at 09:03)</a>:</h4>
<p>without the occasional "is not a tree" weird error message.</p>

<a name="189001749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001749" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001749">Johan Commelin (Feb 25 2020 at 09:03)</a>:</h4>
<p>Ok, that seems useful.</p>

<a name="189001841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001841">Johan Commelin (Feb 25 2020 at 09:05)</a>:</h4>
<p>Is there a place where you want to document this, besides <code>--help</code>? Because this seems hard to summarise in one line.</p>

<a name="189001848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001848" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001848">Johan Commelin (Feb 25 2020 at 09:05)</a>:</h4>
<p>Or is <code>--help</code> also for longer explanations?</p>

<a name="189001926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001926" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001926">Patrick Massot (Feb 25 2020 at 09:06)</a>:</h4>
<p>Of course there will be longer help in a new version of <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/install/project.md" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/install/project.md">https://github.com/leanprover-community/mathlib/blob/master/docs/install/project.md</a></p>

<a name="189001938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189001938" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189001938">Patrick Massot (Feb 25 2020 at 09:06)</a>:</h4>
<p>But <code>leanproject up --help</code> will also display more</p>

<a name="189002060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189002060" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189002060">Johan Commelin (Feb 25 2020 at 09:08)</a>:</h4>
<p>Aah, <span class="user-mention" data-user-id="110031">@Patrick Massot</span> I think it makes sense to show in the general <code>--help</code> that <code>CMD --help</code> will show more details.</p>

<a name="189002193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189002193" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189002193">Patrick Massot (Feb 25 2020 at 09:10)</a>:</h4>
<p>I don't know if we can do that in the current setup, I'll investigate. Yesterday I switched from <a href="https://google.github.io/python-fire/" target="_blank" title="https://google.github.io/python-fire/">fire</a> to <a href="https://click.palletsprojects.com/en/7.x/" target="_blank" title="https://click.palletsprojects.com/en/7.x/">click</a> for command line handling and help building (because it seemed easier to create aliases).</p>

<a name="189004098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189004098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189004098">Rob Lewis (Feb 25 2020 at 09:42)</a>:</h4>
<p>Indeed, I think the output of <code>leanproject --help</code> could be expanded a bit. <code>upgrade-mathlib</code> in particular isn't clear. Maybe "Upgrade a mathlib dependency to the latest compatible version" or something like that?</p>

<a name="189033839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189033839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189033839">Patrick Massot (Feb 25 2020 at 16:16)</a>:</h4>
<p>I managed to make travis happy: <a href="https://travis-ci.org/leanprover-community/mathlib-tools?utm_medium=notification&amp;utm_source=github_status" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib-tools?utm_medium=notification&amp;utm_source=github_status">https://travis-ci.org/leanprover-community/mathlib-tools?utm_medium=notification&amp;utm_source=github_status</a>. Now a much harder challenge will be AppVeyor.</p>

<a name="189432552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189432552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189432552">Patrick Massot (Mar 01 2020 at 12:59)</a>:</h4>
<p>Gabriel, I don't understand your latest comment on this PR. Could you clarify what you wish?</p>

<a name="189432775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189432775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189432775">Gabriel Ebner (Mar 01 2020 at 13:06)</a>:</h4>
<p>Let me rephrase it:  when I run <code>leanproject up</code> on an up-to-date mathlib branch, it fetches oleans.  But when I run <code>leanproject up</code> on something that is not a mathlib branch, I suddenly get an error message from <code>git</code> with no further explanation.<br>
There is already a helpful error message when <code>leanproject</code> can't find the mathlib remote here:  <a href="https://github.com/leanprover-community/mathlib-tools/blob/fc2d84d5cc798a79fb16cf29f433fc77d56b5a25/mathlibtools/lib.py#L373-L375" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/blob/fc2d84d5cc798a79fb16cf29f433fc77d56b5a25/mathlibtools/lib.py#L373-L375">https://github.com/leanprover-community/mathlib-tools/blob/fc2d84d5cc798a79fb16cf29f433fc77d56b5a25/mathlibtools/lib.py#L373-L375</a><br>
I would also like to see this error message when the pull fails two lines after that: <a href="https://github.com/leanprover-community/mathlib-tools/blob/fc2d84d5cc798a79fb16cf29f433fc77d56b5a25/mathlibtools/lib.py#L377" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/blob/fc2d84d5cc798a79fb16cf29f433fc77d56b5a25/mathlibtools/lib.py#L377">https://github.com/leanprover-community/mathlib-tools/blob/fc2d84d5cc798a79fb16cf29f433fc77d56b5a25/mathlibtools/lib.py#L377</a> (at least that's where I think the error comes from)</p>

<a name="189432834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189432834" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189432834">Patrick Massot (Mar 01 2020 at 13:09)</a>:</h4>
<p>Those lines will be executed when you are not working on mathlib.</p>

<a name="189432876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189432876" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189432876">Patrick Massot (Mar 01 2020 at 13:10)</a>:</h4>
<p>When you are not working on mathlib, git pulling mathlib is handled by <code>leanpkg</code>.</p>

<a name="189433171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189433171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189433171">Gabriel Ebner (Mar 01 2020 at 13:20)</a>:</h4>
<p>AFAICT <code>leanproject up</code> executes <code>proj().upgrade_mathlib()</code>.  The lines I've quoted are then executed if <code>self.is_mathlib</code> is true (which I hope is the case if I'm working on mathlib).</p>

<a name="189433217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189433217" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189433217">Gabriel Ebner (Mar 01 2020 at 13:22)</a>:</h4>
<p>By "not a mathlib branch", I mean a branch in mathlib that is only on my own fork (i.e. no corresponding branch on <code>leanprover-community</code>), or I've checked out some random commit (which is on <code>leanprover-community/mathlib</code> but doesn't correspond to any branch).</p>

<a name="189433227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189433227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189433227">Patrick Massot (Mar 01 2020 at 13:22)</a>:</h4>
<p>Ok, I misunderstood "not a mathlib branch".</p>

<a name="189433772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189433772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189433772">Patrick Massot (Mar 01 2020 at 13:43)</a>:</h4>
<p>This should be fixed now.</p>

<a name="189433889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189433889" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189433889">Patrick Massot (Mar 01 2020 at 13:47)</a>:</h4>
<p>I think I emptied the request stream. The only thing that is missing is upgrading mathlib to a new version of Lean. One thing we can do is <code>leanproject upgrade-mathlib</code> could ask GitHub whether there is a leanprover-community/mathlib branch named <code>lean-X.Y.Z</code> with <code>X.Y.Z</code> bigger than the Lean version currently used by the project (note this would cost a bit of  time). Then we could change the project Lean version and upgrade mathlib. Do we want that? Do we want <code>leanproject</code> to ask for confirmation before doing that? Or should this be a manual only operation (or a new command in <code>leanproject</code>)?</p>

<a name="189434219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189434219" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189434219">Gabriel Ebner (Mar 01 2020 at 13:58)</a>:</h4>
<p><code>leanproject upgrade-lean</code> could also be part of the next PR.  I think <code>leanproject</code> is sufficiently polished and tested now that we should merge the PR and make a new release on pypi.</p>

<a name="189435662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435662">Patrick Massot (Mar 01 2020 at 14:46)</a>:</h4>
<p>This will be quick to implement, I can do it tonight if we decide what we want.</p>

<a name="189435725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435725" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435725">Rob Lewis (Mar 01 2020 at 14:48)</a>:</h4>
<p>I think <code>leanproject upgrade-lean</code> should probably take an optional Lean version. So with no version given it upgrades to the newest Lean it can find, and <code>leanproject upgrade-lean 3.6.1</code> does what you'd expect even after 3.6.2 is released.</p>

<a name="189435739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435739" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435739">Patrick Massot (Mar 01 2020 at 14:49)</a>:</h4>
<p>Do I understand correctly that you both think <code>leanproject upgrade-mathlib</code> should not silently upgrade the lean version?</p>

<a name="189435793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435793">Rob Lewis (Mar 01 2020 at 14:51)</a>:</h4>
<p>We could have a flag for it. <code>leanproject upgrade-mathlib --upgrade-lean</code>if the default is not to, or swap the default. I'm not sure which is better.</p>

<a name="189435840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435840" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435840">Rob Lewis (Mar 01 2020 at 14:52)</a>:</h4>
<p>My instinct is to do less by default.</p>

<a name="189435847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435847">Patrick Massot (Mar 01 2020 at 14:53)</a>:</h4>
<p>Given that we don't backport anything to old mathlib branches, I would say people who want to upgrade mathlib want to upgrade Lean. But we could at least ask for confirmation.</p>

<a name="189435906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435906" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435906">Rob Lewis (Mar 01 2020 at 14:55)</a>:</h4>
<p>Actually, I'd skip the step of asking for confirmation. As long as there's an option <code>upgrade-mathlib --no-lean-upgrade</code> or whatever, I think it's fine.</p>

<a name="189435912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435912" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435912">Rob Lewis (Mar 01 2020 at 14:55)</a>:</h4>
<p>Adding prompts just makes the directions for new users more confusing.</p>

<a name="189435953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435953">Patrick Massot (Mar 01 2020 at 14:56)</a>:</h4>
<p>Currently <code>leanproject check</code> prompts before touching oleans.</p>

<a name="189435965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189435965" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189435965">Rob Lewis (Mar 01 2020 at 14:57)</a>:</h4>
<p>That's fine, it's not part of the normal workflow, right?</p>

<a name="189436007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189436007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189436007">Patrick Massot (Mar 01 2020 at 14:58)</a>:</h4>
<p>It's part of making Jason feel safer (and also of helping debugging new users on Zulip).</p>

<a name="189436063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189436063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189436063">Patrick Massot (Mar 01 2020 at 15:00)</a>:</h4>
<p>So not part of the normal workflow.</p>

<a name="189567385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189567385" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189567385">Sebastien Gouezel (Mar 03 2020 at 06:38)</a>:</h4>
<p>I just got a surprising error message from <code>leanproject</code>:</p>
<div class="codehilite"><pre><span></span><span class="bp">&gt;</span> <span class="n">leanproject</span> <span class="n">up</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">remote</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Trying</span> <span class="n">to</span> <span class="n">download</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">oleanstorage</span><span class="bp">.</span><span class="n">azureedge</span><span class="bp">.</span><span class="n">net</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">e0030149a7e753283e01c64f6ec8de94d2eebf93</span><span class="bp">.</span><span class="n">tar</span><span class="bp">.</span><span class="n">gz</span>¬†<span class="n">to</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Sebastien</span><span class="err">\</span><span class="bp">.</span><span class="n">mathlib</span><span class="err">\</span><span class="n">e0030149a7e753283e01c64f6ec8de94d2eebf93</span><span class="bp">.</span><span class="n">tar</span><span class="bp">.</span><span class="n">gz</span>
<span class="mi">100</span><span class="err">%</span><span class="bp">|</span><span class="err">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span><span class="bp">|</span> <span class="mi">215</span><span class="bp">/</span><span class="mi">215</span> <span class="o">[</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="bp">&lt;</span><span class="err">?</span><span class="o">,</span> <span class="err">?</span><span class="n">iB</span><span class="bp">/</span><span class="n">s</span><span class="o">]</span>
<span class="n">Found</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">at</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">oleanstorage</span><span class="bp">.</span><span class="n">azureedge</span><span class="bp">.</span><span class="n">net</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span>
<span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Sebastien</span><span class="err">\</span><span class="bp">.</span><span class="n">mathlib</span><span class="err">\</span><span class="n">e0030149a7e753283e01c64f6ec8de94d2eebf93</span><span class="bp">.</span><span class="n">tar</span><span class="bp">.</span><span class="n">gz</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">compressed</span> <span class="n">or</span> <span class="n">uncompressed</span> <span class="n">tar</span> <span class="n">file</span>
</pre></div>


<p>If I understand correctly, the oleans are not yet on Azure, so it downloaded the <code>.xml</code> file and then realized it's not the right file. What is confusing to me is that it mentions a <code>.tar.gz</code> file, and then says it is not a compressed or uncompressed <code>tar</code> file.</p>

<a name="189570322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189570322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189570322">Patrick Massot (Mar 03 2020 at 07:58)</a>:</h4>
<p>S√©bastien, when did you last upgrade leanproject? This xml thing should not happen anymore.</p>

<a name="189570333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189570333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189570333">Patrick Massot (Mar 03 2020 at 07:59)</a>:</h4>
<p>The fact that it mentions a tar.gz file is not suprising, leanproject is making up that file name from the commit hash.</p>

<a name="189573240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189573240" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189573240">Sebastien Gouezel (Mar 03 2020 at 08:53)</a>:</h4>
<p>Yes, I was probably just working with an old version. Sorry for the noise.</p>
<p>(I have just updated and tried again, but now the oleans are already there on Azure so I can't conclude anything)</p>

<a name="189573483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189573483" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189573483">Patrick Massot (Mar 03 2020 at 08:57)</a>:</h4>
<p>I hope <span class="user-mention" data-user-id="110596">@Rob Lewis</span> and <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> will have time to fix that Azure delay issue. This is the main thing blocking the release of <code>leanproject</code>. Until that is fixed, this tool will remain completely unreliable.</p>

<a name="189574044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189574044" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189574044">Sebastien Gouezel (Mar 03 2020 at 09:05)</a>:</h4>
<p>That tool is already amazing. With a good error message explaining what is going on in case of failure, I think it can (and should?) be released now.</p>

<a name="189574271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189574271" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189574271">Sebastien Gouezel (Mar 03 2020 at 09:08)</a>:</h4>
<p>I tried it now, just after a push to mathlib. Indeed I don't get any more the weird error message. Instead, I have</p>
<div class="codehilite"><pre><span></span><span class="bp">&gt;</span> <span class="n">leanproject</span> <span class="n">up</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">remote</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Trying</span> <span class="n">to</span> <span class="n">download</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">oleanstorage</span><span class="bp">.</span><span class="n">azureedge</span><span class="bp">.</span><span class="n">net</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="mi">2</span><span class="n">d1bd457d4da3383a8154528bb2df09a977523a2</span><span class="bp">.</span><span class="n">tar</span><span class="bp">.</span><span class="n">gz</span>¬†<span class="n">to</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">sebas</span><span class="err">\</span><span class="bp">.</span><span class="n">mathlib</span><span class="err">\</span><span class="mi">2</span><span class="n">d1bd457d4da3383a8154528bb2df09a977523a2</span><span class="bp">.</span><span class="n">tar</span><span class="bp">.</span><span class="n">gz</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">GitHub</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Info</span><span class="o">:</span> <span class="n">No</span> <span class="n">github</span> <span class="kn">section</span> <span class="n">found</span> <span class="k">in</span> <span class="err">&#39;</span><span class="n">git</span> <span class="n">config&#39;</span><span class="o">,</span> <span class="n">we</span> <span class="n">will</span> <span class="n">use</span> <span class="n">GitHub</span> <span class="k">with</span> <span class="n">no</span> <span class="n">authentication</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">mathlib</span> <span class="n">oleans</span>
</pre></div>


<p>I think an error message like <code>oleans not found on Azure. This is usually due to a delay between a push to master and the generation of oleans. Please retry in one hour</code> would be helpful in this situation.</p>

<a name="189576297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189576297" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189576297">Kevin Buzzard (Mar 03 2020 at 09:37)</a>:</h4>
<p>I don't want to wait an hour, I'd rather have the last mathlib for which the oleans are on Azure, right now. I never had to wait for update-mathlib and I don't care if I'm one day out of date. Or is this a problem which is only temporary?</p>
<p>My instinct is not to switch until I'm being assured that I don't have to wait for an hour.</p>

<a name="189576368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189576368" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189576368">Kevin Buzzard (Mar 03 2020 at 09:38)</a>:</h4>
<p>PS should I worry about the "no authentication" line? I get this on at least one of the machines I use lean on</p>

<a name="189577219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189577219" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189577219">Mario Carneiro (Mar 03 2020 at 09:53)</a>:</h4>
<p>it's not really a security concern, but it does mean that you get rate limited</p>

<a name="189579793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189579793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189579793">Johan Commelin (Mar 03 2020 at 10:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> <code>leanproject get-cache</code> should get you yesterdays oleans...</p>

<a name="189588918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189588918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189588918">Patrick Massot (Mar 03 2020 at 12:40)</a>:</h4>
<p>Kevin, I think you missed part of the discussion. There shouldn't be any need to wait. The issue is that our continuous integration keeps building the same lean files but with different git commits. Mergify creates merge commits with no added content compared to the successful build that prompted mergify to merge. Anyway, don't worry about this, Gabriel and Rob will fix it.</p>

<a name="189599261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189599261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189599261">Rob Lewis (Mar 03 2020 at 14:50)</a>:</h4>
<p>I thought about the delay a bit more, and I have most of a solution. It's kind of a subtle thing. What we want goes way against the grain of Mergify. And there are enough little things that Mergify does (queuing, setting the commit author, closing PRs, deleting branches) that it will be a huge pain to reimplement in e.g. Actions.</p>
<p>The big issue is that the final Mergify build has a different git hash than the merge commit that will get pushed to master. And we can't predict what the master commit will be until it happens. But what we can do is this. We store a table in Azure that maps file hashes to git hashes. By a file hash, I mean a hash computed from all .lean files in <code>src</code> and <code>leanpkg.toml</code>. When an archive gets uploaded to Azure, we add a row to the table. </p>
<p>If <code>leanproject</code> doesn't find an archive corresponding to the git hash, it can compute the file hash, and query the table; if there's a row for that file hash, it points to an archive built from a different commit, but with identical lean files. So it's safe to use that archive instead.</p>

<a name="189600945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189600945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189600945">Johan Commelin (Mar 03 2020 at 15:06)</a>:</h4>
<p>That sounds like a good solution. But where do the file hashes get computed for the entries in the table in Azure?</p>

<a name="189601008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601008" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601008">Johan Commelin (Mar 03 2020 at 15:06)</a>:</h4>
<p>I currently don't know the system very well. Who is pushing the oleans to Azure. Is mergify doing this? Or some other part of CI?</p>

<a name="189601394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601394">Rob Lewis (Mar 03 2020 at 15:11)</a>:</h4>
<p>GitHub Actions is in charge of pushing the archives to Azure. It can compute the file hashes. We need to make sure that Actions and <code>leanproject</code> compute the same hash, so I think they should use the same Python script.</p>

<a name="189601724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601724" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601724">Johan Commelin (Mar 03 2020 at 15:14)</a>:</h4>
<p>This</p>
<div class="codehilite"><pre><span></span>find src | grep &quot;[.]lean$&quot; | sort | xargs sha512sum | sha512sum
</pre></div>


<p>is fast (instant, &lt; 0.1s) on my machine, and makes sure that the order in which files are visited doesn't influence the hash.</p>

<a name="189601754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601754" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601754">Rob Lewis (Mar 03 2020 at 15:15)</a>:</h4>
<p>Is it OS independent?</p>

<a name="189601808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601808" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601808">Johan Commelin (Mar 03 2020 at 15:15)</a>:</h4>
<p>I really don't know what I can expect windows users to have nowadays</p>

<a name="189601824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601824" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601824">Johan Commelin (Mar 03 2020 at 15:16)</a>:</h4>
<p>Do we expect them to have <code>git bash</code>?</p>

<a name="189601894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601894">Johan Commelin (Mar 03 2020 at 15:16)</a>:</h4>
<p>Or is that no longer a prerequisite to installing mathlib and friends?</p>

<a name="189601907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189601907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189601907">Rob Lewis (Mar 03 2020 at 15:16)</a>:</h4>
<p>We'll have to do this from Python in <code>leanproject</code>. Instead of calling a bash script from Python that might not work on every OS, we should probably just implement it in Python.</p>

<a name="189602308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189602308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189602308">Johan Commelin (Mar 03 2020 at 15:18)</a>:</h4>
<p>Apparently you get all files in subdirectories with</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">my_path</span> <span class="o">+</span> <span class="s1">&#39;/**/*.lean&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

<a name="189603513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603513">Rob Lewis (Mar 03 2020 at 15:30)</a>:</h4>
<p>I think something like this is right.</p>
<div class="codehilite"><pre><span></span><span class="c1"># adapted from https://stackoverflow.com/questions/24937495/how-can-i-calculate-a-hash-for-a-filesystem-directory-using-python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>


<span class="k">def</span> <span class="nf">md5_update_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="nb">hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">hash</span>

<span class="k">def</span> <span class="nf">md5_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">md5_update_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">md5_update_from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.lean&#39;</span><span class="p">:</span>
            <span class="nb">hash</span> <span class="o">=</span> <span class="n">md5_update_from_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">hash</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">hash</span>

<span class="k">def</span> <span class="nf">md5_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">md5_update_from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">md5_dir_and_file</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
  <span class="n">dir_hash</span> <span class="o">=</span> <span class="n">md5_update_from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">())</span>
  <span class="n">dir_file_hash</span> <span class="o">=</span> <span class="n">md5_update_from_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dir_hash</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">dir_file_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">src_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
<span class="n">toml_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;leanpkg.toml&#39;</span><span class="p">)</span>
<span class="nb">hash</span> <span class="o">=</span> <span class="n">md5_dir_and_file</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">toml_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
</pre></div>

<a name="189603561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603561" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603561">Rob Lewis (Mar 03 2020 at 15:30)</a>:</h4>
<p>This will be sensitive to the presence of untracked .lean files in the src directory.</p>

<a name="189603629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603629" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603629">Rob Lewis (Mar 03 2020 at 15:31)</a>:</h4>
<p>Maybe it should use the git Python library to only check files that are part of the repo.</p>

<a name="189603801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603801" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603801">Johan Commelin (Mar 03 2020 at 15:33)</a>:</h4>
<p>Do you really want to use md5?</p>

<a name="189603813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603813" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603813">Johan Commelin (Mar 03 2020 at 15:33)</a>:</h4>
<p>I thought that was deprecated half a century ago...</p>

<a name="189603842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603842">Rob Lewis (Mar 03 2020 at 15:34)</a>:</h4>
<p>That was just from the StackOverflow example, but I don't think it really matters.</p>

<a name="189603900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603900" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603900">Rob Lewis (Mar 03 2020 at 15:34)</a>:</h4>
<p>There's no security concern here.</p>

<a name="189603952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603952" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603952">Johan Commelin (Mar 03 2020 at 15:35)</a>:</h4>
<p>Sure...</p>

<a name="189603992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189603992" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189603992">Johan Commelin (Mar 03 2020 at 15:35)</a>:</h4>
<p>Good catch that you also take the toml into account</p>

<a name="189604081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604081">Rob Lewis (Mar 03 2020 at 15:36)</a>:</h4>
<p>With this approach, there will only be a short delay between a commit hitting master and the correctly named archive being uploaded. We'll be able to grab the oleans and skip the build. The untracked file worry only matters in that minute in between.</p>

<a name="189604129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604129">Johan Commelin (Mar 03 2020 at 15:37)</a>:</h4>
<p><a href="https://gist.github.com/seveas/4318006" target="_blank" title="https://gist.github.com/seveas/4318006">https://gist.github.com/seveas/4318006</a> -- git-list-all-files</p>

<a name="189604171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604171">Johan Commelin (Mar 03 2020 at 15:37)</a>:</h4>
<p>If we just filter for <code>.lean</code> and <code>.toml</code>, then we would be done, I guess.</p>

<a name="189604309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604309">Rob Lewis (Mar 03 2020 at 15:39)</a>:</h4>
<p>That looks like major overkill, all files that have ever existed in the repo in any branch? We just want the current head.</p>

<a name="189604328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604328" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604328">Rob Lewis (Mar 03 2020 at 15:39)</a>:</h4>
<p>But I'm sure there's a way to get this.</p>

<a name="189604613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604613" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604613">Johan Commelin (Mar 03 2020 at 15:42)</a>:</h4>
<p>Hmmm, you are right.. I didn't read carefully</p>

<a name="189604618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189604618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189604618">Rob Lewis (Mar 03 2020 at 15:42)</a>:</h4>
<p>I need to do other things this afternoon, but I leave a challenge for <span class="user-mention" data-user-id="110031">@Patrick Massot</span> . Give me a Python script that computes this hash, reliably across OSes. I'll give you a URL pattern to check if <code>leanproject</code> fails to find an archive at the git hash URL. If successful it will return JSON with an alternate git hash to look for.</p>

<a name="189605006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605006">Rob Lewis (Mar 03 2020 at 15:47)</a>:</h4>
<p>You know what, ignore that. It will be better to keep this out of <code>leanproject</code> entirely. We can live with a delay of a couple minutes between a commit hitting master and the archive being available. Then this can stay entirely in CI.</p>

<a name="189605122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605122">Johan Commelin (Mar 03 2020 at 15:48)</a>:</h4>
<p>In that case you can even resort to my 1-liner (-;</p>

<a name="189605194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605194">Rob Lewis (Mar 03 2020 at 15:49)</a>:</h4>
<p>Gotta include <code>leanpkg.toml</code> too...</p>

<a name="189605526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605526">Johan Commelin (Mar 03 2020 at 15:53)</a>:</h4>
<div class="codehilite"><pre><span></span>find . | grep &#39;[.]lean$\|[.]toml$&#39; | sort | xargs shasum | shasum
</pre></div>

<a name="189605647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605647" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605647">Rob Lewis (Mar 03 2020 at 15:54)</a>:</h4>
<p>Only find <code>lean</code> files in <code>src/</code>, but include <code>leanpkg.toml</code> which is in <code>.</code>? :)</p>

<a name="189605752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605752">Johan Commelin (Mar 03 2020 at 15:55)</a>:</h4>
<p>Hmmm, do we not want <code>archive/</code> etc?</p>

<a name="189605931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189605931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189605931">Rob Lewis (Mar 03 2020 at 15:57)</a>:</h4>
<p>Nope. Why should we refuse to use olean files from a build that only changed something in archive?</p>

<a name="189606228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189606228" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189606228">Gabriel Ebner (Mar 03 2020 at 15:59)</a>:</h4>
<p>Please also include the output of <code>lean --version</code>, if possible.  Otherwise this is a bit flaky if you use <code>leanprover-community/lean:nightly</code> as the lean version in <code>leanpkg.toml</code>.</p>

<a name="189606492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189606492" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189606492">Johan Commelin (Mar 03 2020 at 16:02)</a>:</h4>
<div class="codehilite"><pre><span></span>echo `find src | grep &#39;[.]lean$&#39; | sort | xargs shasum` `shasum leanpkg.toml` &quot;lean --version:&quot; `lean --version` | shasum | head -c 40; echo
ffd5c1d3c3db39f68d267a5f6d75696ccc8925b4
</pre></div>

<a name="189606793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189606793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189606793">Johan Commelin (Mar 03 2020 at 16:04)</a>:</h4>
<p>This was on a dirty mathlib, so you shouldn't be able to reproduce (-;</p>

<a name="189633016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189633016" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189633016">Patrick Massot (Mar 03 2020 at 20:53)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span>  I'm not sure I understand the conclusion of this shasum discussion. Do you expect me to do something?</p>

<a name="189675704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189675704" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189675704">Rob Lewis (Mar 04 2020 at 09:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> not at the moment. Although, a flag for <code>leanproject get-cache</code> to skip the <code>mathlib-nightly</code> lookup would be helpful! (Meaning, just fail if the cache doesn't exist on Azure.)</p>

<a name="189690752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189690752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189690752">Rob Lewis (Mar 04 2020 at 13:40)</a>:</h4>
<p>I have this mostly implemented. There seems to be a small bug in <code>leanproject</code> blocking it for now: <a href="https://github.com/leanprover-community/mathlib-tools/pull/16#issuecomment-594527235" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/16#issuecomment-594527235">https://github.com/leanprover-community/mathlib-tools/pull/16#issuecomment-594527235</a></p>

<a name="189690827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189690827" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189690827">Rob Lewis (Mar 04 2020 at 13:41)</a>:</h4>
<p>When this lands, oleans should be available on Azure about a minute after a commit hits master, as long as that commit came from a PR from a mathlib branch.</p>

<a name="189690896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189690896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189690896">Patrick Massot (Mar 04 2020 at 13:42)</a>:</h4>
<p>Thanks. What you describe is not a bug, this is the intended behavior of this <code>-u</code> option. It was meant to provide the base url, not the tar.gz file url.</p>

<a name="189690962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189690962" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189690962">Rob Lewis (Mar 04 2020 at 13:43)</a>:</h4>
<p>Oh, I see. Can I have an option to direct it to a different filename too?</p>

<a name="189690972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189690972" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189690972">Rob Lewis (Mar 04 2020 at 13:43)</a>:</h4>
<p>Even better if I can give it the filename and not the full URL!</p>

<a name="189691022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691022" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691022">Patrick Massot (Mar 04 2020 at 13:44)</a>:</h4>
<p>I don't understand what you want.</p>

<a name="189691073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691073" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691073">Rob Lewis (Mar 04 2020 at 13:45)</a>:</h4>
<p>I want to say "even though the git hash is <code>xyz</code>, use the oleans from <code>abc.tar.gz</code> instead."</p>

<a name="189691129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691129">Rob Lewis (Mar 04 2020 at 13:45)</a>:</h4>
<p>The idea being, <code>abc</code> and <code>xyz</code> are different commits that contain identical Lean files.</p>

<a name="189691139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691139" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691139">Patrick Massot (Mar 04 2020 at 13:45)</a>:</h4>
<p>And who is providing the hashes xyz and abc?</p>

<a name="189691196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691196">Patrick Massot (Mar 04 2020 at 13:46)</a>:</h4>
<p>We don't want end-users to see any of this trickery, right?</p>

<a name="189691200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691200">Rob Lewis (Mar 04 2020 at 13:46)</a>:</h4>
<p>I provide <code>abc</code>. You're computing <code>xyz</code> from the current git hash but I want to ignore it in this case.</p>

<a name="189691214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691214" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691214">Rob Lewis (Mar 04 2020 at 13:46)</a>:</h4>
<p>This is an option, nobody has to use this if they don't know what they're doing.</p>

<a name="189691308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691308">Patrick Massot (Mar 04 2020 at 13:47)</a>:</h4>
<p>But let's say Kevin wants to upgrade mathlib, without needing to be lucky to want that one hour and a half after the lean-3.5.1 branch is moved to a new commit in the morning. Does he need to do anything?</p>

<a name="189691330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691330" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691330">Rob Lewis (Mar 04 2020 at 13:47)</a>:</h4>
<p>No.</p>

<a name="189691418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691418" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691418">Patrick Massot (Mar 04 2020 at 13:48)</a>:</h4>
<p>(I hope Kevin won't mind being used as the archetypal clueless user in this discussion).</p>

<a name="189691437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691437" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691437">Patrick Massot (Mar 04 2020 at 13:48)</a>:</h4>
<p>So, who will be using this option. CI?</p>

<a name="189691481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691481" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691481">Rob Lewis (Mar 04 2020 at 13:49)</a>:</h4>
<p>Yes, CI and users who know what they're doing.</p>

<a name="189691502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691502">Patrick Massot (Mar 04 2020 at 13:49)</a>:</h4>
<p>Ok, fine.</p>

<a name="189691552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691552">Patrick Massot (Mar 04 2020 at 13:50)</a>:</h4>
<p>I'll do that as soon as I'll be done with marking.</p>

<a name="189691559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189691559" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189691559">Rob Lewis (Mar 04 2020 at 13:50)</a>:</h4>
<p>Thanks!</p>

<a name="189773954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189773954" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189773954">Patrick Massot (Mar 05 2020 at 09:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189691073" title="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189691073">said</a>:</p>
<blockquote>
<p>I want to say "even though the git hash is <code>xyz</code>, use the oleans from <code>abc.tar.gz</code> instead."</p>
</blockquote>
<p>Which command do you this option to modify? Is it only <code>leanproject get-cache</code>? Or do you also want <code>leanproject upgrade-mathlib</code> to be also using it?</p>

<a name="189774403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189774403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189774403">Patrick Massot (Mar 05 2020 at 09:47)</a>:</h4>
<p>I tried to think about implementation but there is too much to guess here. I need to know <em>precisely</em> what you actually want to do on your side.</p>

<a name="189775611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189775611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189775611">Johan Commelin (Mar 05 2020 at 10:02)</a>:</h4>
<p>You probably have a function <code>compute_hash</code> somewhere. Can every command that uses this function get an option <code>--use-hash</code> that specifies a hash (without the <code>.tar.gz</code> suffix) that will be used instead of whatever result <code>compute_hash</code> returns?</p>

<a name="189779603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189779603" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189779603">Patrick Massot (Mar 05 2020 at 11:00)</a>:</h4>
<p>Thanks Johan, but this kind of message is exactly what doesn't help ( trying to guess what leanproject does and running into XY problem).</p>

<a name="189780029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189780029" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189780029">Gabriel Ebner (Mar 05 2020 at 11:06)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> In the worst case, you can always run curltar yourself:</p>
<div class="codehilite"><pre><span></span>curl https://oleanstorage.azureedge.net/mathlib/<span class="nv">$MY_FAVORITE_HASH</span>.tar.gz <span class="p">|</span> tar xz
<span class="c1"># or if you want a one-line replacement for `leanproject get-cache`:</span>
curl https://oleanstorage.azureedge.net/mathlib/<span class="k">$(</span>git rev-parse HEAD<span class="k">)</span>.tar.gz <span class="p">|</span> tar xz
</pre></div>

<a name="189782754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189782754" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189782754">Johan Commelin (Mar 05 2020 at 11:49)</a>:</h4>
<p>Is there anything else on the wishlist apart from Rob's item?</p>

<a name="189784844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189784844" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189784844">Rob Lewis (Mar 05 2020 at 12:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189774403" title="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189774403">said</a>:</p>
<blockquote>
<p>I tried to think about implementation but there is too much to guess here. I need to know <em>precisely</em> what you actually want to do on your side.</p>
</blockquote>
<p>I only care about <code>get-cache</code>. I don't think it makes sense for <code>upgrade-mathlib</code>. Just like <code>-u</code> lets me change the base url where it looks for the archive, I'd like to change the filename as well.</p>

<a name="189784954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189784954" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189784954">Rob Lewis (Mar 05 2020 at 12:24)</a>:</h4>
<p>So regardless of my current mathlib version, if I type <code>leanproject -u mywebsite.com -n filename.tar.gz get-cache</code>  it will download the archive from <code>mywebsite.com/filename.tar.gz</code>.</p>

<a name="189785293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189785293" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189785293">Gabriel Ebner (Mar 05 2020 at 12:29)</a>:</h4>
<p>We only use this for CI, right?  Why not just <code>curl https://mywebsite.com/filename.tar.gz | tar xz</code>?</p>

<a name="189786074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786074">Rob Lewis (Mar 05 2020 at 12:38)</a>:</h4>
<p>Well, first we check for the file in the normal place, and then there's the olean touching logic. So it would be repeating a bunch of features of <code>leanproject get-cache</code>. But we could.</p>

<a name="189786444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786444" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786444">Gabriel Ebner (Mar 05 2020 at 12:42)</a>:</h4>
<p>I'm not sure we should be touching oleans in CI anyhow.  The CI servers should all have the same timezone and time, so there shouldn't be any issues.  And if there are issues, it's okay if they build twice.</p>

<a name="189786498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786498" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786498">Gabriel Ebner (Mar 05 2020 at 12:43)</a>:</h4>
<p>Am I getting this right?  We first check if there's the file for the current commit (in case somebody pushes the same commit to a different branch?), and then we check if there's a file for the current content hash?  Isn't the first check redundant?</p>

<a name="189786664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786664" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786664">Rob Lewis (Mar 05 2020 at 12:45)</a>:</h4>
<p>Big disclaimer, I'm home sick with a fever today, so yes you're probably right.</p>

<a name="189786698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786698" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786698">Rob Lewis (Mar 05 2020 at 12:46)</a>:</h4>
<p>I'll try it out when I trust myself to code...</p>

<a name="189786764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786764" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786764">Gabriel Ebner (Mar 05 2020 at 12:46)</a>:</h4>
<p>Please take care of yourself.  You should take the day off.</p>

<a name="189786802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189786802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189786802">Rob Lewis (Mar 05 2020 at 12:47)</a>:</h4>
<p>Only here because I've been lying in bed all day and I'm bored ;)</p>

<a name="189822316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189822316" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189822316">Scott Morrison (Mar 05 2020 at 18:34)</a>:</h4>
<p>I find myself often typing:</p>
<div class="codehilite"><pre><span></span>git checkout X    # this successfully downloads oleans, but git also tells me &quot;Your branch is behind &#39;origin/X&#39; by 25 commits&quot;
git pull
leanproject get-cache # successfully downloads the latest oleans
</pre></div>

<a name="189830674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189830674" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189830674">Gabriel Ebner (Mar 05 2020 at 20:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> This is just <code>git checkout X &amp;&amp; leanproject up</code></p>

<a name="189830803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189830803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189830803">Scott Morrison (Mar 05 2020 at 20:05)</a>:</h4>
<p>Ah, thanks! So I just stop using <code>git pull</code>. I wonder if there is a good way to steer people towards doing this?</p>

<a name="189830823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189830823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189830823">Scott Morrison (Mar 05 2020 at 20:05)</a>:</h4>
<p>(We know lack of oleans is a huge hurdle to newcomers.)</p>

<a name="189830972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189830972" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189830972">Gabriel Ebner (Mar 05 2020 at 20:07)</a>:</h4>
<p>A big issue with <code>leanproject up</code> is that you don't get olean if the branch has been updated in the last two hours.  It would be great if it could check out the latest commit where oleans are available.</p>

<a name="189831062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189831062" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189831062">Simon Hudon (Mar 05 2020 at 20:08)</a>:</h4>
<p>that would be the HEAD of the branch <code>lean-3.5.1</code>, no?</p>

<a name="189831289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189831289" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189831289">Scott Morrison (Mar 05 2020 at 20:11)</a>:</h4>
<p>I think Gabriel means the latest commit on whichever branch you're on, that has oleans.</p>

<a name="189831306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189831306" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189831306">Scott Morrison (Mar 05 2020 at 20:11)</a>:</h4>
<p>So <code>git pull</code> gets you to the HEAD of your current branch, but <code>leanproject up</code> takes you to the latest with oleans.</p>

<a name="189831435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189831435" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189831435">Scott Morrison (Mar 05 2020 at 20:13)</a>:</h4>
<p>Or maybe <code>leanproject up</code> should take you to HEAD, but with the latest available oleans, even if they haven't caught up with HEAD?</p>

<a name="189834070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189834070" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189834070">Gabriel Ebner (Mar 05 2020 at 20:40)</a>:</h4>
<p>When checking out master, I typically want the latest one that has full oleans.  When checking out feature branches, I want  the latest one and I'll take whatever oleans I get.</p>

<a name="189839167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189839167" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189839167">Scott Morrison (Mar 05 2020 at 21:36)</a>:</h4>
<p>I think it might be better not to have inconsistent behaviour for <code>leanproject up</code> on master and other branches.</p>

<a name="189839198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189839198" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189839198">Scott Morrison (Mar 05 2020 at 21:36)</a>:</h4>
<p>For people who want guaranteed oleans, we should advertise to them the existence of the <code>lean-3.X.X</code> branches, which should always have oleans and stay close to master.</p>

<a name="189839233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189839233" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189839233">Scott Morrison (Mar 05 2020 at 21:37)</a>:</h4>
<p>(Advertising could even be in the form of a message whenever <code>leanproject</code> fails to find oleans!)</p>

<a name="189839347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189839347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189839347">Scott Morrison (Mar 05 2020 at 21:38)</a>:</h4>
<p>We might also consider, as version numbers seem likely to keep moving for a while now, having a <code>latest</code> branch, that is guaranteed to have oleans, and tracks close to master, regardless of version numbers.</p>

<a name="189877530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189877530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189877530">Gabriel Ebner (Mar 06 2020 at 09:58)</a>:</h4>
<p>I think I've said it before: we should merge <code>leanproject</code> now.  There are lots of nice suggestions here, and I believe they would be even better as PRs to <code>mathlib-tools</code>.<br>
Patrick and Kevin have said that we should wait until we've improved the delay between commits to master and olean tarballs being available.  But this is a red herring.  This doesn't work with <code>cache-olean</code> either.  And if you stay on the <code>lean-3.6.1</code> branch like you had to with <code>cache-olean</code> then <code>leanproject up</code> will always find oleans without any delay.</p>

<a name="189877722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189877722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189877722">Johan Commelin (Mar 06 2020 at 10:01)</a>:</h4>
<p>Go for it!</p>

<a name="189877930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189877930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189877930">Gabriel Ebner (Mar 06 2020 at 10:05)</a>:</h4>
<p>Ok, now we just need to wait for <span class="user-mention" data-user-id="110031">@Patrick Massot</span> to push the release to pypi.</p>

<a name="189877969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189877969" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189877969">Mario Carneiro (Mar 06 2020 at 10:05)</a>:</h4>
<p>what is the documentation story? Is this live for users?</p>

<a name="189878151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878151">Gabriel Ebner (Mar 06 2020 at 10:09)</a>:</h4>
<p>Oh yeah, this is a good point.  I completely forgot about it.  It is not yet live for users that use <code>pip install mathlibtools</code>.  You only get it if you use the git version directly.</p>

<a name="189878159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878159" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878159">Mario Carneiro (Mar 06 2020 at 10:09)</a>:</h4>
<p>Speaking as the old fart who can't be bothered to learn new things, there are too many mathlib tools. What do they all do? Are some superseding others? How do I use them in both simple and less simple use cases? A FAQ or documentation page addressing these questions would be very helpful.</p>

<a name="189878175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878175" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878175">Gabriel Ebner (Mar 06 2020 at 10:09)</a>:</h4>
<p>Then you'll be delighted.  All of the old tools are gone.  Now there's only one tool called <code>leanproject</code> and it's wonderful.</p>

<a name="189878232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878232" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878232">Mario Carneiro (Mar 06 2020 at 10:10)</a>:</h4>
<p>and <code>pip</code>, of course</p>

<a name="189878261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878261">Mario Carneiro (Mar 06 2020 at 10:10)</a>:</h4>
<p>installing python has been the sticking point in lean setup for me on more than one occasion</p>

<a name="189878304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878304" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878304">Gabriel Ebner (Mar 06 2020 at 10:11)</a>:</h4>
<p>Ok, this doesn't change.  We've always required <code>pip</code>.</p>

<a name="189878324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878324" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878324">Mario Carneiro (Mar 06 2020 at 10:12)</a>:</h4>
<p>lean itself isn't too hard to get running... can we distribute binary tools?</p>

<a name="189878376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878376">Mario Carneiro (Mar 06 2020 at 10:12)</a>:</h4>
<p>or is CI for that too much work</p>

<a name="189878488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878488" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878488">Sebastian Ullrich (Mar 06 2020 at 10:14)</a>:</h4>
<p>You mean, rewrite it in Rust?</p>

<a name="189878850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189878850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189878850">Gabriel Ebner (Mar 06 2020 at 10:21)</a>:</h4>
<p>I've made a basic PR to change all descriptions from <code>update-mathlib</code> to <code>leanproject</code>.  <a href="https://github.com/leanprover-community/mathlib/issues/2093" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/2093">#2093</a></p>

<a name="189887303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189887303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189887303">Patrick Massot (Mar 06 2020 at 12:29)</a>:</h4>
<p>I'm sorry I'm super busy all day. I'll push to pypi tonight.</p>

<a name="189887714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189887714" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189887714">Gabriel Ebner (Mar 06 2020 at 12:34)</a>:</h4>
<p>No need to hurry.  This can wait another day if it has to.</p>

<a name="189888210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189888210" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189888210">Patrick Massot (Mar 06 2020 at 12:41)</a>:</h4>
<p>I'm using my phone in a train so I can't do much but I commented on the doc PR. You haven't explored the full power of leanproject yet.</p>

<a name="189891174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189891174" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189891174">Gabriel Ebner (Mar 06 2020 at 13:17)</a>:</h4>
<blockquote>
<p>You haven't explored the full power of leanproject yet.</p>
</blockquote>
<p>I really haven't.  You should have posted a leanproject tutorial!  This is the first time I hear of <code>leanproject get</code> and <code>leanproject new</code>.  BTW, <code>leanproject get</code> didn't work so I filed a PR: <a href="https://github.com/leanprover-community/mathlib-tools/pull/18" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/18">https://github.com/leanprover-community/mathlib-tools/pull/18</a></p>

<a name="189894120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189894120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189894120">Johan Commelin (Mar 06 2020 at 13:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189878175" title="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189878175">said</a>:</p>
<blockquote>
<p>Then you'll be delighted.  All of the old tools are gone.  Now there's only one tool called <code>leanproject</code> and it's wonderful.</p>
</blockquote>
<p>I think it still depends on <code>elan</code>. But <code>olean-cache</code> and <code>update-mathlib</code> seem to be superseded.</p>

<a name="189975391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189975391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189975391">Patrick Massot (Mar 07 2020 at 15:55)</a>:</h4>
<p>Yes, <code>leanproject</code> depends on <code>elan</code>. Internally it also depends on <code>leanpkg</code> (this is pure laziness from me), but from a user point of view it replaces <code>leanpkg</code> entirely. And <code>elan</code> is not meant to be directly used in a normal workflow.</p>

<a name="189975500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189975500" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189975500">Patrick Massot (Mar 07 2020 at 15:58)</a>:</h4>
<p>I think I emptied the feature requests and bug reports. Tonight I'll write more documentation, and probably some more tests. But real world testing is still very welcome. Everybody is also welcome to write python tests. Up to now there are only end-to-end functional tests, in <a href="https://github.com/leanprover-community/mathlib-tools/blob/refactor/tests/test_functional.py" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/blob/refactor/tests/test_functional.py">https://github.com/leanprover-community/mathlib-tools/blob/refactor/tests/test_functional.py</a>, that actually run git commands and download stuff. But the python code is written is such a way that unit tests would be easy to build, so feel free to add those if you have too much time.</p>

<a name="189977157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189977157" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189977157">Kevin Buzzard (Mar 07 2020 at 16:46)</a>:</h4>
<p>I would happily test if you tell me precisely what to type to get me from where I am now (no leanproject installed) to the command which upgrades a working lean project from Lean 3.4.2 to Lean 3.6.1. I have a student at Xena who would like to use the new case bash tactic but I've been refraining from updating everyone's set-up at Xena because my impression is that things aren't ready yet (I tried upgrading a student project to 3.6.1 last Thursday and it turned out that there were no mathlib oleans which was a disaster)</p>

<a name="189978376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189978376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189978376">Gabriel Ebner (Mar 07 2020 at 17:18)</a>:</h4>
<p>If you have already installed <code>update-mathlib</code> using <code>pip</code> (the current installation method), then you can do the following:</p>
<div class="codehilite"><pre><span></span>sudo pip3 install https://github.com/leanprover-community/mathlib-tools/archive/refactor.tar.gz
cd my-lean-project
leanproject up
</pre></div>


<p>If you don't have <code>pip3</code> yet, then you need to run <code>apt install python3-pip</code> first (as described in our installation docs: <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/install/debian_details.md" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/install/debian_details.md">https://github.com/leanprover-community/mathlib/blob/master/docs/install/debian_details.md</a>).</p>

<a name="189978939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189978939" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189978939">Kevin Buzzard (Mar 07 2020 at 17:35)</a>:</h4>
<p>What if I'm on Ubuntu which is stuck with Python 2.something? Should I be doing all this in some virtual environment, or do I not need to worry about that extra hassle?</p>

<a name="189989078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189989078" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189989078">Patrick Massot (Mar 07 2020 at 22:31)</a>:</h4>
<p>Kevin, you are not stuck with python 2. You can <code>sudo apt install python3-pip</code> and then clone the repository, checkout the <code>refactor</code> branch and <code>sudo pip3 install .</code>. You don't need to be in a virtual environment if you don't really know what it means.</p>

<a name="189989119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189989119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189989119">Patrick Massot (Mar 07 2020 at 22:32)</a>:</h4>
<p>I'm done for tonight. I put documentation at <a href="https://github.com/leanprover-community/mathlib-tools/blob/refactor/README.md" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/blob/refactor/README.md">https://github.com/leanprover-community/mathlib-tools/blob/refactor/README.md</a>. Everybody is welcome to comment on the documentation, even without trying the tools.</p>

<a name="189989132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/189989132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#189989132">Patrick Massot (Mar 07 2020 at 22:34)</a>:</h4>
<p>For instance, every native speaker is welcome to translate this documentation into actual English without asking for permission.</p>

<a name="190021528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190021528" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190021528">Patrick Massot (Mar 08 2020 at 17:38)</a>:</h4>
<p>Gabriel, did you find time to read the new documentation and test more stuff?</p>

<a name="190205931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190205931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190205931">Rob Lewis (Mar 10 2020 at 18:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189573483" title="#narrow/stream/113488-general/topic/new.20mathlib.20tools/near/189573483">said</a>:</p>
<blockquote>
<p>I hope <span class="user-mention silent" data-user-id="110596">Rob Lewis</span> and <span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> will have time to fix that Azure delay issue. This is the main thing blocking the release of <code>leanproject</code>. Until that is fixed, this tool will remain completely unreliable.</p>
</blockquote>
<p>Look at this nice speedy master build: <a href="https://github.com/leanprover-community/mathlib/runs/498569708" target="_blank" title="https://github.com/leanprover-community/mathlib/runs/498569708">https://github.com/leanprover-community/mathlib/runs/498569708</a></p>

<a name="190206164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190206164" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190206164">Johan Commelin (Mar 10 2020 at 18:13)</a>:</h4>
<p>26 minutes for linting <span aria-label="shock" class="emoji emoji-1f628" role="img" title="shock">:shock:</span></p>

<a name="190206176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190206176" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190206176">Gabriel Ebner (Mar 10 2020 at 18:13)</a>:</h4>
<p>Speedy?  I think it still takes an hour.  But it's nice that the oleans are already available.</p>

<a name="190206183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190206183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190206183">Johan Commelin (Mar 10 2020 at 18:13)</a>:</h4>
<p>But otherwise, I agree that it's quite impressive</p>

<a name="190206234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190206234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190206234">Gabriel Ebner (Mar 10 2020 at 18:13)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Actually linting is two times 30 minutes.  The second time we regenerate the <code>nolints.txt</code> file.</p>

<a name="190206327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190206327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190206327">Rob Lewis (Mar 10 2020 at 18:14)</a>:</h4>
<p>30 seconds to push the oleans, that's what matters.</p>

<a name="190208187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190208187" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190208187">Johan Commelin (Mar 10 2020 at 18:31)</a>:</h4>
<p>Ooh boy. I didn't realise that linting took that long.</p>

<a name="190208554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190208554" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190208554">Rob Lewis (Mar 10 2020 at 18:34)</a>:</h4>
<p>I think the linters in <a href="https://github.com/leanprover-community/mathlib/issues/2089" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/2089">#2089</a> slowed it down a bunch.</p>

<a name="190212600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190212600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190212600">Gabriel Ebner (Mar 10 2020 at 19:09)</a>:</h4>
<p>It's cumulative.   The first simp-normal form linter added 7 minutes, the second one added another 15 minutes or so.  We have 16 linters now in total.</p>

<a name="190212698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190212698" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190212698">Gabriel Ebner (Mar 10 2020 at 19:10)</a>:</h4>
<p>It shouldn't be hard to run the linters in parallel, in case somebody is motivated.</p>

<a name="190212800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190212800" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190212800">Johan Commelin (Mar 10 2020 at 19:11)</a>:</h4>
<p>I fear that we'll need that pretty soon, if we continue adding linters like this (-;</p>

<a name="190212816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190212816" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190212816">Johan Commelin (Mar 10 2020 at 19:11)</a>:</h4>
<p>Which is probably a good thing.</p>

<a name="190212895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190212895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190212895">Reid Barton (Mar 10 2020 at 19:12)</a>:</h4>
<p>I'm not familiar with the new CI infrastructure, do we actually get multiple cpus?</p>

<a name="190213030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190213030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190213030">Gabriel Ebner (Mar 10 2020 at 19:13)</a>:</h4>
<p>According to the github documentation, we have a <code>Standard_DS2_v2</code> virtual machine.  That should be 2 CPUs: <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/dv2-dsv2-series#dsv2-series" target="_blank" title="https://docs.microsoft.com/en-us/azure/virtual-machines/dv2-dsv2-series#dsv2-series">https://docs.microsoft.com/en-us/azure/virtual-machines/dv2-dsv2-series#dsv2-series</a></p>

<a name="190217957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190217957" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190217957">Kevin Buzzard (Mar 10 2020 at 20:01)</a>:</h4>
<p>Does it make sense to say "we only need to run the linters on the files that changed" (or at least some of the linters)? Or can a change in one file make a linter fail on a file which imports it?</p>

<a name="190218428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190218428" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190218428">Gabriel Ebner (Mar 10 2020 at 20:06)</a>:</h4>
<p>At least the simp and type-class linters (which take the majority of the time) are global.</p>

<a name="190219590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190219590" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190219590">Gabriel Ebner (Mar 10 2020 at 20:18)</a>:</h4>
<p>The caching didn't work for the last PR: <a href="https://github.com/leanprover-community/mathlib/runs/498865888" target="_blank" title="https://github.com/leanprover-community/mathlib/runs/498865888">https://github.com/leanprover-community/mathlib/runs/498865888</a><br>
Apparently the merge commits created by mergify don't run the push action, only the pull_request action.  And the pull_request action doesn't upload to azure: <a href="https://github.com/leanprover-community/mathlib/runs/498571556" target="_blank" title="https://github.com/leanprover-community/mathlib/runs/498571556">https://github.com/leanprover-community/mathlib/runs/498571556</a></p>

<a name="190219883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190219883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190219883">Rob Lewis (Mar 10 2020 at 20:21)</a>:</h4>
<blockquote>
<p>Apparently the merge commits created by mergify don't run the push action, only the pull_request action.</p>
</blockquote>
<p>God damn it, what?</p>

<a name="190220171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190220171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190220171">Rob Lewis (Mar 10 2020 at 20:24)</a>:</h4>
<p>Does Mergify do something different than the "update branch" button?</p>

<a name="190220227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190220227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190220227">Rob Lewis (Mar 10 2020 at 20:24)</a>:</h4>
<p>Because I'm pretty sure that triggers a push build, right?</p>

<a name="190220511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190220511" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190220511">Rob Lewis (Mar 10 2020 at 20:27)</a>:</h4>
<p>Oh, that last PR was from an external repo.</p>

<a name="190220540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190220540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190220540">Rob Lewis (Mar 10 2020 at 20:27)</a>:</h4>
<p>We won't get oleans in that case.</p>

<a name="190220673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190220673" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190220673">Rob Lewis (Mar 10 2020 at 20:28)</a>:</h4>
<p>No oleans were ever uploaded from that PR because external repos don't have write credentials for Azure.</p>

<a name="190226202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190226202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190226202">Gabriel Ebner (Mar 10 2020 at 21:18)</a>:</h4>
<p>You're right, of course.</p>

<a name="190226586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190226586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190226586">Patrick Massot (Mar 10 2020 at 21:21)</a>:</h4>
<p>This is a good opportunity to remind every occasional contributors that they shouldn't hesitate to ask for write access to branches of our main repository. Opening PRs from such branches have more and more advantages. I sent an invitation to <span class="user-mention" data-user-id="260921">@Markus Himmel</span> who is the author of the PR we are discussing.</p>

<a name="190226869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190226869" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190226869">Reid Barton (Mar 10 2020 at 21:23)</a>:</h4>
<p>Please don't hesitate too long, though</p>

<a name="190226938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190226938" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190226938">Patrick Massot (Mar 10 2020 at 21:24)</a>:</h4>
<p>Corrected, thanks</p>

<a name="190229381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190229381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190229381">Rob Lewis (Mar 10 2020 at 21:47)</a>:</h4>
<p>Heh, I just realized something. Our slowness to change the PR process "saved" us here. Unlike in Travis, PR builds in Actions are consistently a merge commit between the PR branch and master. So Mergify's "update branch" step is unnecessary -- if the PR build succeeds, the branch can be safely merged. We could have gotten rid of this with the switch to Actions. EXCEPT, the "update branch" step is now what allows us to have oleans ready to go immediately.</p>

<a name="190229552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190229552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190229552">Rob Lewis (Mar 10 2020 at 21:49)</a>:</h4>
<p>Oh, wait, I guess that's not really true, never mind.</p>

<a name="190229564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190229564" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190229564">Rob Lewis (Mar 10 2020 at 21:49)</a>:</h4>
<p>It doesn't re-run the PR builds when master changes.</p>

<a name="190229757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190229757" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190229757">Rob Lewis (Mar 10 2020 at 21:51)</a>:</h4>
<p>Actually, is there any point at all in running the PR builds in our current setup?</p>

<a name="190229854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190229854" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190229854">Rob Lewis (Mar 10 2020 at 21:52)</a>:</h4>
<p>Even in PRs from external repos, the branch builds should happen, right? Because the Actions config is part of the repo?</p>

<a name="190229946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190229946" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190229946">Patrick Massot (Mar 10 2020 at 21:53)</a>:</h4>
<p>Maybe forks need to activate GitHub action? I'm saying that at random</p>

<a name="190230402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190230402" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190230402">Rob Lewis (Mar 10 2020 at 21:57)</a>:</h4>
<p>It is opt-in, but there's a big green button to do it.</p>

<a name="190277672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190277672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190277672">Koundinya Vajjha (Mar 11 2020 at 12:58)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110031">@Patrick Massot</span> , I tried this out today, but I get the following error with <code>leanproject new myproject</code> :</p>
<div class="codehilite"><pre><span></span>error: ill-formed search path entry &#39;/home/kody/projects/lean4/library&#39;, should be of form &#39;pkg=path&#39;
Traceback (most recent call last):
  File &quot;/usr/bin/leanproject&quot;, line 11, in &lt;module&gt;
    load_entry_point(&#39;mathlibtools==0.0.3&#39;, &#39;console_scripts&#39;, &#39;leanproject&#39;)()
  File &quot;/usr/lib/python3.8/site-packages/click/core.py&quot;, line 764, in __call__
    return self.main(*args, **kwargs)
  File &quot;/usr/lib/python3.8/site-packages/click/core.py&quot;, line 717, in main
    rv = self.invoke(ctx)
  File &quot;/usr/lib/python3.8/site-packages/click/core.py&quot;, line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File &quot;/usr/lib/python3.8/site-packages/click/core.py&quot;, line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File &quot;/usr/lib/python3.8/site-packages/click/core.py&quot;, line 555, in invoke
    return callback(*args, **kwargs)
  File &quot;/usr/lib/python3.8/site-packages/mathlibtools/leanproject.py&quot;, line 55, in new
    LeanProject.new(Path(path), url)
  File &quot;/usr/lib/python3.8/site-packages/mathlibtools/lib.py&quot;, line 296, in new
    proj = cls.from_path(path)
  File &quot;/usr/lib/python3.8/site-packages/mathlibtools/lib.py&quot;, line 161, in from_path
    repo = Repo(path, search_parent_directories=True)
  File &quot;/home/kody/.local/lib/python3.8/site-packages/git/repo/base.py&quot;, line 130, in __init__
    raise NoSuchPathError(epath)
git.exc.NoSuchPathError: /home/kody/projects/myproject
</pre></div>


<p>I am on Arch Linux and on python 3.8.1 as it shows.</p>

<a name="190277846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/new%20mathlib%20tools/near/190277846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/62589newmathlibtools.html#190277846">Koundinya Vajjha (Mar 11 2020 at 13:00)</a>:</h4>
<p>The script is picking up the Lean4 library path for some reason...?</p>


{% endraw %}

{% include archive_update.html %}