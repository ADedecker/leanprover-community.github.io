---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/00190recordstub.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html">record stub</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="136169584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136169584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136169584">Reid Barton (Oct 21 2018 at 00:50)</a>:</h4>
<p>The hole command to create a record stub is really nice!<br>
Can any emacs gurus (<span class="user-mention" data-user-id="110026">@Simon Hudon</span>?) tell me how I can write an emacs command that will insert <code>{! !}</code> at the point, navigate inside it (if necessary), and then invoke the Instance Stub hole command?</p>

<a name="136183553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183553" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183553">Simon Hudon (Oct 21 2018 at 07:26)</a>:</h4>
<p>Sure :) Let's go step by step. In your configuration file (<code>.emacs</code> or <code>.emacs.d/init.el</code>), create a function, let's say:</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">lean-insert-stub</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">print</span> <span class="s">&quot;hello world&quot;</span><span class="p">))</span>
</pre></div>

<a name="136183684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183684" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183684">Simon Hudon (Oct 21 2018 at 07:31)</a>:</h4>
<p>You can change it a little so that you can invoke it from anywhere in emacs:</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">lean-insert-stub</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">print</span> <span class="s">&quot;hello world&quot;</span><span class="p">))</span>
</pre></div>


<p>Then, you just need <code>M-x lean-insert-stub</code> to invoke it.</p>

<a name="136183728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183728">Simon Hudon (Oct 21 2018 at 07:32)</a>:</h4>
<p>And if you want it to actually do something: </p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">lean-insert-stub</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">insert</span> <span class="s">&quot;{!  !}&quot;</span><span class="p">))</span>
</pre></div>

<a name="136183809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183809" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183809">Reid Barton (Oct 21 2018 at 07:35)</a>:</h4>
<p>I tried having it call <code>(lean-hole)</code> next but I got an error even though repositioning the cursor after the insert isn't necessary interactively</p>

<a name="136183855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183855" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183855">Reid Barton (Oct 21 2018 at 07:36)</a>:</h4>
<div class="codehilite"><pre><span></span>error in lean-server command handler: (wrong-type-argument number-or-marker-p nil)
Server response was:
</pre></div>

<a name="136183867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183867" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183867">Simon Hudon (Oct 21 2018 at 07:37)</a>:</h4>
<p>I'm looking at <code>lean-hole--command</code> instead</p>

<a name="136183935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136183935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136183935">Reid Barton (Oct 21 2018 at 07:38)</a>:</h4>
<p>It kind of looks like the lean mode is not designed to handle selecting a hole command non-interactively, in terms of the code structure</p>

<a name="136184005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136184005" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136184005">Reid Barton (Oct 21 2018 at 07:40)</a>:</h4>
<p>Am I supposed to locally set this thing <code>completing-read-function</code>? Is that the "emacs way"?</p>

<a name="136184014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136184014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136184014">Reid Barton (Oct 21 2018 at 07:41)</a>:</h4>
<p>not that that helps, when it is not getting that far yet</p>

<a name="136184074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136184074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136184074">Simon Hudon (Oct 21 2018 at 07:43)</a>:</h4>
<p>Yeah, now that I look more closely, it's not obvious</p>

<a name="136184663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/record%20stub/near/136184663" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00190recordstub.html#136184663">Simon Hudon (Oct 21 2018 at 08:02)</a>:</h4>
<p>To be fair, I'm still new to emacs. Maybe <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> can shed some light. What I got so far is:</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">lean-insert-stub</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">insert</span> <span class="s">&quot;{!  !}&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">-3</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">p</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">start-pos</span> <span class="nv">p</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">end-pos</span> <span class="nv">p</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">start-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">end-marker</span> <span class="p">(</span><span class="nf">make-marker</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">set-marker</span> <span class="nv">start-marker</span> <span class="nv">start-pos</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">set-marker</span> <span class="nv">end-marker</span> <span class="nv">end-pos</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">lean-hole--command</span> <span class="s">&quot;Instance Stub&quot;</span> <span class="nv">start-marker</span> <span class="nv">end-marker</span><span class="p">))))</span>
  <span class="p">)</span>
</pre></div>


<p>which I built from copying bits from <code>lean-hole</code></p>


{% endraw %}
