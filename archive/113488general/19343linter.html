---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/19343linter.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html">linter</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="180209336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180209336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#180209336">Sebastien Gouezel (Nov 08 2019 at 07:56)</a>:</h4>
<p>I am just compiling the latest mathlib. I got an error</p>
<div class="codehilite"><pre><span></span><span class="err">\</span><span class="n">mathlib</span><span class="err">\</span><span class="n">scripts</span><span class="err">\</span><span class="n">mk_nolint</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">allKK</span><span class="err"></span><span class="o">[</span><span class="mi">2</span><span class="n">K</span>
<span class="n">could</span> <span class="n">not</span> <span class="n">resolve</span> <span class="kn">import</span><span class="o">:</span> <span class="n">all</span>
</pre></div>

<a name="180209494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180209494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#180209494">Sebastien Gouezel (Nov 08 2019 at 08:00)</a>:</h4>
<p>Never mind, I should just <code>make src</code>.</p>

<a name="180213362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180213362" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#180213362">Rob Lewis (Nov 08 2019 at 09:14)</a>:</h4>
<p>Edit - never mind, I misread this, sorry.</p>

<a name="180213388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180213388" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#180213388">Rob Lewis (Nov 08 2019 at 09:14)</a>:</h4>
<p>(deleted)</p>

<a name="182788778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182788778" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#182788778">Sebastien Gouezel (Dec 06 2019 at 18:25)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/1786" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1786">#1786</a> has just been merged, and it contains the following line:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">fintype</span><span class="bp">.</span><span class="n">compact_space</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">Î±</span><span class="o">]</span> <span class="o">:</span> <span class="n">compact_space</span> <span class="n">Î±</span>
</pre></div>


<p>I thought that the linter was supposed to ask for a reduced priority on this kind of instance. Has it been deactivated?</p>

<a name="182793450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182793450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#182793450">Floris van Doorn (Dec 06 2019 at 19:15)</a>:</h4>
<p>I think the instance checker is not yet one of the active linters:<br>
<a href="https://github.com/leanprover-community/mathlib/blob/827e78b1638868734de786baac70b5d3f1d5118e/scripts/mk_nolint.lean#L28" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/827e78b1638868734de786baac70b5d3f1d5118e/scripts/mk_nolint.lean#L28">https://github.com/leanprover-community/mathlib/blob/827e78b1638868734de786baac70b5d3f1d5118e/scripts/mk_nolint.lean#L28</a><br>
<a href="https://github.com/leanprover-community/mathlib/blob/740168bf22c86e2d83b98e069b85ac7360dbba8c/scripts/mk_all.sh#L42" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/740168bf22c86e2d83b98e069b85ac7360dbba8c/scripts/mk_all.sh#L42">https://github.com/leanprover-community/mathlib/blob/740168bf22c86e2d83b98e069b85ac7360dbba8c/scripts/mk_all.sh#L42</a></p>

<a name="182793496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182793496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#182793496">Floris van Doorn (Dec 06 2019 at 19:15)</a>:</h4>
<p>(not sure which of these lists is the relevant one, or whether it is necessary that those two lists are the same at all time)</p>

<a name="182794781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182794781" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#182794781">Rob Lewis (Dec 06 2019 at 19:28)</a>:</h4>
<p>The second is the relevant one, and it's most important that the second is a subset of the first. It should be safe to add the priority check back to CI now. With Floris' PRs, I guess almost all of mathlib is passing now. So there should be very few changes to <code>nolints.txt</code>, or none if we update the remaining failures.</p>

<a name="182796917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182796917" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#182796917">Sebastien Gouezel (Dec 06 2019 at 19:48)</a>:</h4>
<p>I vote for enabling it, as this is really a useful check.</p>

<a name="182807502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182807502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#182807502">Rob Lewis (Dec 06 2019 at 21:36)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/1787" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1787">#1787</a> passed. Luckily the <code>fintype.compact_space</code> instance was the only bad one that snuck in.</p>

<a name="184261727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184261727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#184261727">Oliver Nash (Dec 26 2019 at 13:28)</a>:</h4>
<p>I recently learned that it can be dangerous to have a class with more explicit parameters than one which it is extending: <a href="#narrow/stream/113488-general/topic/typeclass.20problems/near/184192445" title="#narrow/stream/113488-general/topic/typeclass.20problems/near/184192445">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass.20problems/near/184192445</a></p>

<a name="184261744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184261744" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#184261744">Oliver Nash (Dec 26 2019 at 13:29)</a>:</h4>
<p>I'm not quite sure exactly what the rule would be, but I wonder if this is the sort of thing we could have the linter warn about?</p>

<a name="184909272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184909272" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#184909272">Floris van Doorn (Jan 06 2020 at 14:18)</a>:</h4>
<p>Yes, this is definitely something we can have the linter warn about. I think the rule is<br>
"There cannot be a local constant in one of the (type-class) hypotheses that does not occur in the conclusion (and cannot be inferred from the type of the local constants in the conclusion)."<br>
I'm not sure if the parenthetical is necessary.</p>
<p>There are instances which violate this rule, <code>coe_trans</code> comes to mind:</p>
<div class="codehilite"><pre><span></span><span class="n">coe_trans</span> <span class="o">:</span> <span class="bp">Î </span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">uâ</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">uâ</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">uâ</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="n">b</span> <span class="n">c</span><span class="o">],</span> <span class="n">has_coe_t</span> <span class="n">a</span> <span class="n">c</span>
</pre></div>


<p>However, instances like those do raise issues:<br>
<a href="#narrow/stream/113488-general/topic/remove.20all.20instances.20with.20variable.20domain" title="#narrow/stream/113488-general/topic/remove.20all.20instances.20with.20variable.20domain">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/remove.20all.20instances.20with.20variable.20domain</a></p>

<a name="184962951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184962951" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#184962951">Mario Carneiro (Jan 06 2020 at 22:18)</a>:</h4>
<p>outparams are also excepted from this rule</p>

<a name="191422772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191422772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191422772">Kevin Buzzard (Mar 22 2020 at 23:54)</a>:</h4>
<p>I have a small laptop and failing eyesight (meaning that when I can't find my specs I have to turn font size up), and I really like the rule which says that lines in mathlib are supposed to be at most 100 characters long. Not every line in mathlib has this property though. I would be very happy if this became a hard and fast rule. Can we lint for it, or is this considered to just be some sort of guideline and most people don't actually care about it?</p>

<a name="191428126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191428126" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191428126">Yury G. Kudryashov (Mar 23 2020 at 02:37)</a>:</h4>
<p>I have a PR with a slightly longer line that I can't (or at least don't want to) break. It is a markdown link to a section of a Wikipedia page.</p>

<a name="191428189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191428189" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191428189">Yury G. Kudryashov (Mar 23 2020 at 02:38)</a>:</h4>
<p>Currently 2258 lines in <code>*.lean</code> files have &gt;100 characters.</p>

<a name="191428198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191428198" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191428198">Yury G. Kudryashov (Mar 23 2020 at 02:39)</a>:</h4>
<p>And another ~600 have =100 characters. So people try to follow this rule.</p>

<a name="191441049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191441049" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191441049">Johan Commelin (Mar 23 2020 at 08:00)</a>:</h4>
<p>One problem with such a linter is that it's not so easy to write a <code>nolint</code> attribute for it. (I think.)</p>

<a name="191453037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191453037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191453037">Rob Lewis (Mar 23 2020 at 10:17)</a>:</h4>
<p>This kind of thing doesn't fit in the current linter framework. The linter has no access to the source code.</p>

<a name="191453069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191453069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19343linter.html#191453069">Rob Lewis (Mar 23 2020 at 10:17)</a>:</h4>
<p>If someone wants to implement a syntactic linter, I won't complain, but it's basically a separate tool from the existing linters.</p>


{% endraw %}

{% include archive_update.html %}