---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/57076correctfreesemigroup.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html">"correct" free semigroup</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="158737026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158737026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158737026">Kenny Lau (Feb 17 2019 at 09:58)</a>:</h4>
<p>Which one is the correct version of free semigroup over a type?</p>

<a name="158737035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158737035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158737035">Kenny Lau (Feb 17 2019 at 09:59)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">inductive</span> <span class="n">free_semigroup</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">of</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">free_semigroup</span>
<span class="bp">|</span> <span class="n">cons</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">free_semigroup</span> <span class="bp">→</span> <span class="n">free_semigroup</span>

<span class="kn">namespace</span> <span class="n">free_semigroup</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="n">def</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">free_semigroup</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="n">L2</span> <span class="o">:=</span> <span class="n">cons</span> <span class="n">x</span> <span class="n">L2</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">cons</span> <span class="n">x</span> <span class="n">L1</span><span class="o">)</span> <span class="n">L2</span> <span class="o">:=</span> <span class="n">cons</span> <span class="n">x</span> <span class="o">(</span><span class="n">mul</span> <span class="n">L1</span> <span class="n">L2</span><span class="o">)</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">semigroup</span> <span class="o">(</span><span class="n">free_semigroup</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul</span> <span class="o">:=</span> <span class="n">mul</span><span class="o">,</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">L1</span> <span class="n">L2</span> <span class="n">L3</span><span class="o">,</span> <span class="n">free_semigroup</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">L1</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">L1</span> <span class="n">ih</span><span class="o">,</span>
    <span class="n">congr_arg</span> <span class="o">(</span><span class="n">cons</span> <span class="n">x</span><span class="o">)</span> <span class="n">ih</span> <span class="o">}</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">semigroup</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>

<span class="n">def</span> <span class="n">lift</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">x</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">cons</span> <span class="n">x</span> <span class="n">tl</span><span class="o">)</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">tl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">lift_of</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">lift_mul</span> <span class="o">(</span><span class="n">L1</span> <span class="n">L2</span><span class="o">)</span> <span class="o">:</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">L1</span> <span class="bp">*</span> <span class="n">L2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">L1</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">L2</span> <span class="o">:=</span>
<span class="n">free_semigroup</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">L1</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">tl</span> <span class="n">ih</span><span class="o">,</span>
<span class="k">show</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">tl</span> <span class="bp">*</span> <span class="n">L2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">tl</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">L2</span><span class="o">,</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">ih</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">lift_unique</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f</span> <span class="bp">=</span> <span class="n">lift</span> <span class="o">(</span><span class="n">f</span> <span class="err">∘</span> <span class="n">of</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">L</span><span class="o">,</span> <span class="n">free_semigroup</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">L</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">tl</span> <span class="n">ih</span><span class="o">,</span>
<span class="o">(</span><span class="n">hf</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="n">tl</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">congr_arg</span> <span class="bp">_</span> <span class="n">ih</span>

<span class="kn">end</span> <span class="n">free_semigroup</span>
</pre></div>

<a name="158737037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158737037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158737037">Kenny Lau (Feb 17 2019 at 09:59)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">list</span><span class="bp">.</span><span class="n">basic</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="n">def</span> <span class="n">free_semigroup</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">L</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">//</span> <span class="n">L</span> <span class="bp">≠</span> <span class="o">[]</span> <span class="o">}</span>

<span class="kn">namespace</span> <span class="n">free_semigroup</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">semigroup</span> <span class="o">(</span><span class="n">free_semigroup</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">L1</span> <span class="n">L2</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">L1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">++</span> <span class="n">L2</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">L1</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">append_eq_nil</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">L1</span> <span class="n">L2</span> <span class="n">L3</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">list</span><span class="bp">.</span><span class="n">append_assoc</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">of</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="o">[</span><span class="n">x</span><span class="o">],</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons_ne_nil</span> <span class="bp">_</span> <span class="bp">_⟩</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">semigroup</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>

<span class="n">def</span> <span class="n">lift&#39;</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">L</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">,</span> <span class="n">L</span> <span class="bp">≠</span> <span class="o">[]</span> <span class="bp">→</span> <span class="n">β</span>
<span class="bp">|</span> <span class="o">[]</span>            <span class="n">H</span>  <span class="o">:=</span> <span class="n">absurd</span> <span class="n">rfl</span> <span class="n">H</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">hd</span><span class="bp">::</span><span class="o">[])</span>      <span class="n">H</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">hd</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">hd</span><span class="bp">::</span><span class="n">hd2</span><span class="bp">::</span><span class="n">tl</span><span class="o">)</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">hd</span> <span class="bp">*</span> <span class="n">lift&#39;</span> <span class="o">(</span><span class="n">hd2</span><span class="bp">::</span><span class="n">tl</span><span class="o">)</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">cons_ne_nil</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>

<span class="n">def</span> <span class="n">lift</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">β</span> <span class="o">:=</span>
<span class="n">lift&#39;</span> <span class="n">f</span> <span class="n">L</span><span class="bp">.</span><span class="mi">1</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">lift_of</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">lift_mul</span> <span class="o">(</span><span class="n">L1</span> <span class="n">L2</span><span class="o">)</span> <span class="o">:</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">L1</span> <span class="bp">*</span> <span class="n">L2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">L1</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">L2</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">change</span> <span class="n">lift&#39;</span> <span class="n">f</span> <span class="o">(</span><span class="n">L1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">++</span> <span class="n">L2</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">=</span> <span class="n">lift&#39;</span> <span class="n">f</span> <span class="n">L1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">_</span> <span class="bp">*</span> <span class="n">lift&#39;</span> <span class="n">f</span> <span class="n">L2</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">L1</span> <span class="k">with</span> <span class="n">L1</span> <span class="n">h1</span><span class="o">,</span> <span class="n">cases</span> <span class="n">L2</span> <span class="k">with</span> <span class="n">L2</span> <span class="n">h2</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">L1</span> <span class="k">with</span> <span class="n">hd</span> <span class="n">tl</span> <span class="n">ih</span><span class="o">,</span> <span class="o">{</span> <span class="n">exact</span> <span class="o">(</span><span class="n">h1</span> <span class="n">rfl</span><span class="o">)</span><span class="bp">.</span><span class="n">elim</span> <span class="o">},</span>
  <span class="n">cases</span> <span class="n">tl</span> <span class="k">with</span> <span class="n">hd2</span> <span class="n">tl</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">L2</span> <span class="k">with</span> <span class="n">hd3</span> <span class="n">tl2</span><span class="o">,</span> <span class="o">{</span> <span class="n">exact</span> <span class="o">(</span><span class="n">h2</span> <span class="n">rfl</span><span class="o">)</span><span class="bp">.</span><span class="n">elim</span> <span class="o">},</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">change</span> <span class="n">f</span> <span class="n">hd</span> <span class="bp">*</span> <span class="bp">_</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">hd</span> <span class="bp">*</span> <span class="bp">_</span> <span class="bp">*</span> <span class="bp">_</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_assoc</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">congr_arg</span> <span class="o">((</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">hd</span><span class="o">))</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">ih</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">cons_ne_nil</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">lift_unique</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f</span> <span class="bp">=</span> <span class="n">lift</span> <span class="o">(</span><span class="n">f</span> <span class="err">∘</span> <span class="n">of</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">L</span><span class="o">,</span> <span class="n">H</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">L</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="o">(</span><span class="n">h</span> <span class="n">rfl</span><span class="o">)</span><span class="bp">.</span><span class="n">elim</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">hd</span> <span class="n">tl</span> <span class="n">ih</span> <span class="n">h</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">tl</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">ih</span> <span class="n">h</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">hd2</span> <span class="n">tl</span> <span class="n">ih</span> <span class="n">h</span><span class="o">,</span> <span class="o">(</span><span class="n">hf</span> <span class="o">(</span><span class="n">of</span> <span class="n">hd</span><span class="o">)</span> <span class="bp">⟨</span><span class="n">hd2</span><span class="bp">::</span><span class="n">tl</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons_ne_nil</span> <span class="bp">_</span> <span class="bp">_⟩</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">congr_arg</span> <span class="bp">_</span> <span class="o">(</span><span class="n">ih</span> <span class="bp">_</span><span class="o">))</span> <span class="n">ih</span> <span class="n">h</span><span class="o">)</span> <span class="n">H</span>

<span class="kn">end</span> <span class="n">free_semigroup</span>
</pre></div>

<a name="158737153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158737153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158737153">Mario Carneiro (Feb 17 2019 at 10:03)</a>:</h4>
<p>I would actually prefer A x list A over the subtype of nonempty lists</p>

<a name="158737306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158737306" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158737306">Kenny Lau (Feb 17 2019 at 10:08)</a>:</h4>
<p>aha, a third construction</p>

<a name="158738775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158738775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158738775">Kenny Lau (Feb 17 2019 at 10:54)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">free_semigroup</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span>
<span class="n">α</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">α</span>

<span class="kn">namespace</span> <span class="n">free_semigroup</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">semigroup</span> <span class="o">(</span><span class="n">free_semigroup</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">L1</span> <span class="n">L2</span><span class="o">,</span> <span class="o">(</span><span class="n">L1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">L1</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">++</span> <span class="n">L2</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">::</span> <span class="n">L2</span><span class="bp">.</span><span class="mi">2</span><span class="o">),</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">L1</span> <span class="n">L2</span> <span class="n">L3</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span> <span class="n">rfl</span> <span class="err">$</span> <span class="n">list</span><span class="bp">.</span><span class="n">append_assoc</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">of</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="o">[])</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">semigroup</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>

<span class="n">def</span> <span class="n">lift&#39;</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span>
<span class="bp">|</span> <span class="n">x</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">x</span>
<span class="bp">|</span> <span class="n">x</span> <span class="o">(</span><span class="n">hd</span><span class="bp">::</span><span class="n">tl</span><span class="o">)</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift&#39;</span> <span class="n">hd</span> <span class="n">tl</span>

<span class="n">def</span> <span class="n">lift</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">β</span> <span class="o">:=</span>
<span class="n">lift&#39;</span> <span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">lift_of</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">lift_mul</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">x</span> <span class="k">with</span> <span class="n">x</span> <span class="n">L1</span><span class="o">,</span> <span class="n">cases</span> <span class="n">y</span> <span class="k">with</span> <span class="n">y</span> <span class="n">L2</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">L1</span> <span class="k">with</span> <span class="n">hd</span> <span class="n">tl</span> <span class="n">ih</span> <span class="n">generalizing</span> <span class="n">x</span><span class="o">,</span> <span class="o">{</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">change</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">((</span><span class="n">hd</span><span class="o">,</span> <span class="n">tl</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">L2</span><span class="o">))</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">hd</span><span class="o">,</span> <span class="n">tl</span><span class="o">)</span> <span class="bp">*</span> <span class="n">lift</span> <span class="n">f</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">L2</span><span class="o">),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">ih</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">]</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">lift_unique</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">free_semigroup</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f</span> <span class="bp">=</span> <span class="n">lift</span> <span class="o">(</span><span class="n">f</span> <span class="err">∘</span> <span class="n">of</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">L</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">L</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">hd</span> <span class="n">tl</span> <span class="n">ih</span> <span class="n">x</span><span class="o">,</span>
  <span class="o">(</span><span class="n">hf</span> <span class="o">(</span><span class="n">of</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">hd</span><span class="o">,</span> <span class="n">tl</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">congr_arg</span> <span class="bp">_</span> <span class="err">$</span> <span class="n">ih</span> <span class="bp">_</span><span class="o">)</span> <span class="n">x</span>

<span class="kn">end</span> <span class="n">free_semigroup</span>
</pre></div>

<a name="158741011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741011" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741011">Kevin Buzzard (Feb 17 2019 at 12:03)</a>:</h4>
<p>The "core API" of a construction such as a free functor (or more generally some adjoint functor) is presumably the definition and the proof that it satisfies the universal property (which as Kenny pointed out to me recently is data, it's an equiv of hom-sets). As a mathematician I have been led to believe that any other property that a mathematician might want from the construction should be deducible from the universal property. </p>
<p>This leads me to several questions, which I have only recently begun to somehow understand from the point of view of Lean code. First, if one can prove the universal property for all three definitions, then perhaps one has all a mathematician needs, and so maybe a mathematician does not care which construction to use. From a CS point of view I would imagine there are more issues at stake though. What are these issues?</p>
<p>Second, I think I know examples -- although rather few -- where there are lemmas which are useful for a mathematician to have in practice, but which are perhaps more easily proved using the construction rather than the universal property. The one that immediately springs to mind is in the context of the tensor product of two modules <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> over a commutative ring <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span>. It's a theorem that any element of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><msub><mo>⊗</mo><mi>R</mi></msub><mi>N</mi></mrow><annotation encoding="application/x-tex">M\otimes_R N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mbin"><span class="mbin">⊗</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> can be written (usually highly non-uniquely) as a finite sum <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></msubsup><msub><mi>m</mi><mi>i</mi></msub><mo>⊗</mo><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sum_{i=1}^t m_i\otimes n_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.933456em;"></span><span class="strut bottom" style="height:1.233166em;vertical-align:-0.29971000000000003em;"></span><span class="base"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.933456em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mathrm mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"></span></span></span></span></span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">⊗</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>i</mi></msub><mo>∈</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">m_i\in M</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mrel">∈</span><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub><mo>∈</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">n_i\in N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mrel">∈</span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span>. This is useful in commutative algebra to "reduce to the Noetherian case" -- any element of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><msub><mo>⊗</mo><mi>R</mi></msub><mi>N</mi></mrow><annotation encoding="application/x-tex">M\otimes_R N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mbin"><span class="mbin">⊗</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> is in the image of a natural map from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>M</mi><mo mathvariant="normal">′</mo></msup><msub><mo>⊗</mo><mi>R</mi></msub><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">M'\otimes_R N'</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.901892em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mbin"><span class="mbin">⊗</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>M</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">M'</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.751892em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">N'</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.751892em;"></span><span class="strut bottom" style="height:0.751892em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> are finitely-generated submodules of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span>. If I remember correctly, the proof in Atiyah--Macdonald is "this follows from the explicit construction of the tensor product as a quotient of the free abelian group on pairs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(m,n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mopen">(</span><span class="mord mathit">m</span><span class="mpunct">,</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>" rather than "this follows from the universal property". I have not thought about how a universal property proof would go, but it's tantamount to saying that the image of the canonical bilinear map <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>×</mo><mi>N</mi><mo>→</mo><mi>M</mi><msub><mo>⊗</mo><mi>R</mi></msub><mi>N</mi></mrow><annotation encoding="application/x-tex">M\times N\to M\otimes_R N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mrel">→</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mbin"><span class="mbin">⊗</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> generates the tensor product.</p>
<p>And finally, there is the Strickland Predicate. For localisations I am currently very much of the opinion that Neil's definition of a predicate saying "if these criteria are satisfied, then this ring is isomorphic to the localisation of this ring". The criteria are <em>not</em> "it satisfies the right universal property" and they are <em>not</em> "by the universal property there's a map from the localisation to this ring, and the criterion is that it's a bijection" (although of course they are provably equivalent to these predicates). Neil's predicate is more intrinsic to the situation, and my feeling is that his code seems to unify some work which I did multiple times in the schemes project. Is this something to do with the fact that we have lots of universes or is there a more fundamental issue at stake?</p>
<p>Can any of <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> , <span class="user-mention" data-user-id="110032">@Reid Barton</span> or <span class="user-mention" data-user-id="130308">@Neil Strickland</span>  enlighten me as to what is actually going on here?</p>

<a name="158741191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741191" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741191">Mario Carneiro (Feb 17 2019 at 12:08)</a>:</h4>
<p>As you've identified, the way that we want to interact with a type varies by application. Sometimes we want it to be an object with a universal property, sometimes we want it to be a concrete construction, sometimes we want it to be a <em>different</em> concrete construction. And when you throw in DTT you always wish that your view du jour is the definitional one, but that's not possible</p>

<a name="158741196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741196">Mario Carneiro (Feb 17 2019 at 12:08)</a>:</h4>
<p>What is possible is to provide a number of interfaces to the type so you have what you need for the application</p>

<a name="158741272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741272" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741272">Mario Carneiro (Feb 17 2019 at 12:11)</a>:</h4>
<p>As for Neil's predicate, you may have identified an important aspect here. It's not enough to know that A is isomorphic to B[1/f] usually - you want an actual isomorphism for computability reasons and also because you will want to say things about this map later</p>

<a name="158741279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741279">Kevin Buzzard (Feb 17 2019 at 12:11)</a>:</h4>
<p>So the correct choice for the definition of free semigroup is: look at all the code in the world which uses free semigroups, and in each case consider the definition which would have made the code easiest to write or to use (in the sense that you maximise the number of proofs which would have been <code>rfl</code>) and then you choose that definition?</p>

<a name="158741280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741280" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741280">Mario Carneiro (Feb 17 2019 at 12:11)</a>:</h4>
<p>If it's unique, then you can treat it as a predicate, but otherwise it's data</p>

<a name="158741285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741285">Kenny Lau (Feb 17 2019 at 12:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> for the tensor product case, it reduces to the facts that (1) tensor product commutes with direct limit and (2) every module is a direct limit of finitely generated modules</p>

<a name="158741337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741337" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741337">Kevin Buzzard (Feb 17 2019 at 12:12)</a>:</h4>
<p>Kenny -- exactly! So we can do a whole bunch of commutative algebra and universal properties and then come up with a beautiful conceptual proof of this fact.</p>

<a name="158741340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741340" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741340">Kevin Buzzard (Feb 17 2019 at 12:12)</a>:</h4>
<p>Or we can just say "oh look it's trivial from the construction"</p>

<a name="158741342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741342">Mario Carneiro (Feb 17 2019 at 12:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>  yes, although you can restrict attention to the theorems that should be in the free semigroup file (among all theorems in the world)</p>

<a name="158741355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741355">Kevin Buzzard (Feb 17 2019 at 12:13)</a>:</h4>
<p>So this sounds like an experimental science -- Kenny has three candidate definitions and there's no obvious algorithm to work out which is best -- we need the users to tell us.</p>

<a name="158741358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741358" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741358">Mario Carneiro (Feb 17 2019 at 12:13)</a>:</h4>
<p>There are more theorems to prove than just the universal property though</p>

<a name="158741359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741359" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741359">Kevin Buzzard (Feb 17 2019 at 12:13)</a>:</h4>
<p>Why?</p>

<a name="158741384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%22correct%22%20free%20semigroup/near/158741384" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/57076correctfreesemigroup.html#158741384">Mario Carneiro (Feb 17 2019 at 12:14)</a>:</h4>
<p>If it was just that, then I agree that the quotient is best</p>


{% endraw %}
