---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/14624Abunchoffinequivresults.html
---

## Stream: [general](index.html)
### Topic: [A bunch of fin equiv results](14624Abunchoffinequivresults.html)

---


{% raw %}
#### [ Kenny Lau (Apr 22 2018 at 09:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521488):
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">equiv</span> <span class="n">data</span><span class="bp">.</span><span class="n">fin</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fin_zero_elim</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">false</span><span class="bp">.</span><span class="n">elim</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">not_lt_zero</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span>

<span class="n">def</span> <span class="n">fin_sum</span>  <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="err">⊕</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="err">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">x</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">y</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">lt_of_lt_of_le</span> <span class="n">y</span><span class="bp">.</span><span class="mi">2</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_add_right</span> <span class="n">m</span> <span class="n">n</span><span class="bp">⟩</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">m</span> <span class="bp">+</span> <span class="n">y</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_lt_add_left</span> <span class="n">y</span><span class="bp">.</span><span class="mi">2</span> <span class="n">m</span><span class="bp">⟩</span><span class="o">),</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">if</span> <span class="n">H</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">m</span>
    <span class="k">then</span> <span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">H</span><span class="bp">⟩</span>
    <span class="k">else</span> <span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">m</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">lt_of_add_lt_add_left</span> <span class="err">$</span>
      <span class="k">show</span> <span class="n">m</span> <span class="bp">+</span> <span class="o">(</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">m</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">,</span>
      <span class="k">from</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_of_le</span> <span class="err">$</span> <span class="n">le_of_not_gt</span> <span class="n">H</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">▸</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">x</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">y</span><span class="bp">.</span><span class="mi">2</span><span class="o">]</span><span class="bp">;</span> <span class="k">from</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="n">rfl</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">m</span> <span class="bp">+</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">m</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">zero_le</span><span class="o">],</span>
       <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">H</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span><span class="o">]</span><span class="bp">;</span>
       <span class="k">from</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="n">rfl</span><span class="o">),</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">begin</span>
    <span class="n">by_cases</span> <span class="n">H</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">m</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">dsimp</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_pos</span> <span class="n">H</span><span class="o">]</span><span class="bp">;</span> <span class="n">simp</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="n">rfl</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">dsimp</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_neg</span> <span class="n">H</span><span class="o">]</span><span class="bp">;</span> <span class="n">simp</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span><span class="bp">;</span> <span class="n">simp</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_of_le</span> <span class="o">(</span><span class="n">le_of_not_gt</span> <span class="n">H</span><span class="o">)]</span> <span class="o">}</span>
  <span class="kn">end</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">fin_prod</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">×</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="err">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">*</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="k">calc</span>
          <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span>
        <span class="bp">=</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ac_refl</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_le_add_left</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:</span> <span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ_mul</span> <span class="bp">_</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">m</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul_le_mul_right</span> <span class="bp">_</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span>
      <span class="k">from</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pos_of_ne_zero</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">H</span><span class="o">,</span>
        <span class="n">nat</span><span class="bp">.</span><span class="n">not_lt_zero</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="err">$</span> <span class="k">by</span> <span class="n">subst</span> <span class="n">H</span><span class="bp">;</span> <span class="k">from</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
    <span class="o">(</span><span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">div_lt_iff_lt_mul</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">H</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span>
     <span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="err">%</span> <span class="n">n</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mod_lt</span> <span class="bp">_</span> <span class="n">H</span><span class="bp">⟩</span><span class="o">),</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="bp">⟩</span><span class="o">,</span> <span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span>
      <span class="k">from</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pos_of_ne_zero</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">H</span><span class="o">,</span>
        <span class="n">nat</span><span class="bp">.</span><span class="n">not_lt_zero</span> <span class="n">y</span><span class="bp">.</span><span class="mi">1</span> <span class="err">$</span> <span class="n">H</span> <span class="bp">▸</span> <span class="n">y</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
    <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span><span class="bp">.</span><span class="mi">2</span>
    <span class="bp">⟨</span><span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="err">$</span> <span class="k">calc</span>
            <span class="o">(</span><span class="n">y</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span>
          <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_mul_div_left</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">H</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">nat</span><span class="bp">.</span><span class="n">div_eq_of_lt</span> <span class="n">y</span><span class="bp">.</span><span class="mi">2</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">zero_add</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
     <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="err">$</span> <span class="k">calc</span>
            <span class="o">(</span><span class="n">y</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="err">%</span> <span class="n">n</span>
          <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="mi">1</span> <span class="err">%</span> <span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_mul_mod_self_left</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="mi">1</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mod_eq_of_lt</span> <span class="n">y</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">right_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mod_add_div</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">fin_zero_pi</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="err">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="err">^</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="n">x</span><span class="o">,</span> <span class="n">false</span><span class="bp">.</span><span class="n">elim</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">not_lt_zero</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">fin_zero_elim</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="err">$</span> <span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="err">$</span>
    <span class="n">nat</span><span class="bp">.</span><span class="n">eq_zero_of_le_zero</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_of_lt_succ</span> <span class="n">hx</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">fin_succ_pi</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="err">≃</span> <span class="o">((</span><span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="bp">×</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="err">∘</span> <span class="n">raise_fin</span><span class="o">,</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">lt_succ_self</span> <span class="n">n</span><span class="bp">⟩</span><span class="o">),</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">x</span><span class="o">,</span> <span class="k">if</span> <span class="n">H</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">H</span><span class="bp">⟩</span> <span class="k">else</span> <span class="n">f</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">if</span> <span class="n">H</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span>
    <span class="k">then</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">raise_fin</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_pos</span> <span class="n">H</span><span class="o">]</span><span class="bp">;</span>
      <span class="k">from</span> <span class="n">congr_arg</span> <span class="n">f</span> <span class="o">(</span><span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="n">rfl</span><span class="o">)</span>
    <span class="k">else</span> <span class="k">by</span> <span class="n">dsimp</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_neg</span> <span class="n">H</span><span class="o">]</span><span class="bp">;</span>
      <span class="k">from</span> <span class="n">congr_arg</span> <span class="n">f</span> <span class="o">(</span><span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_antisymm</span>
        <span class="o">(</span><span class="n">le_of_not_gt</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_lt_succ</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="o">)),</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">x</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span><span class="bp">.</span><span class="mi">2</span>
    <span class="bp">⟨</span><span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">raise_fin</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_pos</span> <span class="n">y</span><span class="bp">.</span><span class="mi">2</span><span class="o">]</span><span class="bp">;</span>
       <span class="k">from</span> <span class="n">congr_arg</span> <span class="n">f</span> <span class="o">(</span><span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span> <span class="n">rfl</span><span class="o">),</span>
     <span class="k">by</span> <span class="n">simp</span><span class="bp">⟩</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">fin_pi</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="err">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="err">^</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">nat</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">n</span> <span class="o">(</span><span class="n">fin_zero_pi</span> <span class="n">m</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">n</span> <span class="n">ih</span><span class="o">,</span> <span class="k">calc</span>
      <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span>
    <span class="err">≃</span> <span class="o">((</span><span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="bp">×</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin_succ_pi</span> <span class="bp">_</span> <span class="bp">_</span>
<span class="bp">...</span> <span class="err">≃</span> <span class="o">((</span><span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="err">^</span> <span class="n">n</span><span class="o">))</span> <span class="bp">×</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">prod_congr</span> <span class="n">ih</span> <span class="err">$</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="bp">_</span>
<span class="bp">...</span> <span class="err">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="err">^</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="n">fin_prod</span> <span class="bp">_</span> <span class="bp">_</span>
</pre></div>


<p>Are these already in mathlib?</p>

#### [ Kenny Lau (Apr 22 2018 at 09:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521581):
<p>I just built myself a digit converter accidentally</p>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">0</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">1</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">2</span> <span class="c1">--2</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">3</span> <span class="c1">--2</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">4</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">5</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="n">nat</span><span class="bp">.</span><span class="n">to_digits</span> <span class="mi">5</span> <span class="mi">300</span> <span class="c1">--[0,0,2,2]</span>
</pre></div>

#### [ Mario Carneiro (Apr 22 2018 at 09:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521582):
<p>Not exactly, but <code>fintype.card_sum</code> seems really similar, and not nearly as complicated of a proof</p>

#### [ Kenny Lau (Apr 22 2018 at 10:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521927):
<blockquote>
<p>Not exactly, but <code>fintype.card_sum</code> seems really similar, and not nearly as complicated of a proof</p>
</blockquote>
<p>well, that depends on a lot of lemmas (and I still can't trace where the main proof is), whereas this one builds everything from "scratch"</p>

#### [ Kenny Lau (Apr 22 2018 at 10:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521931):
<p>(ignoring lemmas about natural numbers)</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521988):
<p>that's what I mean by not nearly as complicated</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125521989):
<p>them giants have shoulders, use them</p>

#### [ Kenny Lau (Apr 22 2018 at 10:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522030):
<p>hmm</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522077):
<p>It's possible that a refactoring is necessary, but this is clearly repeating work that already exists and I would want there to be only one proof from which both facts follow</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522078):
<p>Also there are some similar statements in <code>cardinal</code></p>

#### [ Kenny Lau (Apr 22 2018 at 10:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522084):
<p>right but that's cardinals</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522086):
<p>I'm pretty sure <code>nat_cast_pow</code> unfolds to exactly <code>fin_pi</code></p>

#### [ Mario Carneiro (Apr 22 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522126):
<p>it's talking about cardinality of finite sets in terms of <code>fin</code></p>

#### [ Kenny Lau (Apr 22 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522134):
<p>interesting</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522135):
<p>and relating it to the cardinal power which is the function space</p>

#### [ Kenny Lau (Apr 22 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522136):
<p>I wonder how my digit extraction will work</p>

#### [ Kenny Lau (Apr 22 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522137):
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">0</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">1</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">2</span> <span class="c1">--2</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">3</span> <span class="c1">--2</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">4</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="o">(</span><span class="n">fin_pi</span> <span class="mi">5</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">⟨</span><span class="mi">300</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="bp">⟩</span> <span class="mi">5</span> <span class="c1">--0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="n">nat</span><span class="bp">.</span><span class="n">to_digits</span> <span class="mi">5</span> <span class="mi">300</span> <span class="c1">--[0,0,2,2]</span>
</pre></div>

#### [ Kenny Lau (Apr 22 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522138):
<p>will this code run?</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522188):
<p>Neither the cardinal version nor the finset version gives you this explicitly, since the finset is unordered and the cardinal is nonconstructive (the proof is probably constructive but it's buried in a nonconstructive statement)</p>

#### [ Kenny Lau (Apr 22 2018 at 10:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522189):
<p>exactly</p>

#### [ Mario Carneiro (Apr 22 2018 at 10:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20bunch%20of%20fin%20equiv%20results/near/125522190):
<p>but <code>multiset.pi</code> should be generalized to <code>list.pi</code> and that is your digit calculator</p>


{% endraw %}
