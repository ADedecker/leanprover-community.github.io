---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/680066cases.html
---

## Stream: [general](https://leanprover-community.github.io/archive/113488general/index.html)
### Topic: [6 cases](https://leanprover-community.github.io/archive/113488general/680066cases.html)

---

<base href="https://leanprover.zulipchat.com">
{% raw %}
#### [ Kevin Buzzard (Nov 18 2018 at 20:46)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147928252):
<p>Is there a trick for doing this painlessly:</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">H0</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">0</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H1</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">2</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">3</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H4</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">4</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H5</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">5</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">Hr</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span>
</pre></div>


<p>Currently I have</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">Hlt6</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="o">(</span><span class="n">lt_or_eq_of_le</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_succ_le_succ</span> <span class="n">Hlt6</span><span class="o">))</span> <span class="k">with</span> <span class="n">Hlt5</span> <span class="n">Heq5</span><span class="o">,</span>
    <span class="n">cases</span> <span class="o">(</span><span class="n">lt_or_eq_of_le</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_succ_le_succ</span> <span class="n">Hlt5</span><span class="o">))</span> <span class="k">with</span> <span class="n">Hlt4</span> <span class="n">Heq4</span><span class="o">,</span>
      <span class="n">cases</span> <span class="o">(</span><span class="n">lt_or_eq_of_le</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_succ_le_succ</span> <span class="n">Hlt4</span><span class="o">))</span> <span class="k">with</span> <span class="n">Hlt3</span> <span class="n">Heq3</span><span class="o">,</span>
        <span class="n">cases</span> <span class="o">(</span><span class="n">lt_or_eq_of_le</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_succ_le_succ</span> <span class="n">Hlt3</span><span class="o">))</span> <span class="k">with</span> <span class="n">Hlt2</span> <span class="n">Heq2</span><span class="o">,</span>
          <span class="n">cases</span> <span class="o">(</span><span class="n">lt_or_eq_of_le</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_succ_le_succ</span> <span class="n">Hlt2</span><span class="o">))</span> <span class="k">with</span> <span class="n">Hlt1</span> <span class="n">Heq1</span><span class="o">,</span>
            <span class="n">cases</span> <span class="o">(</span><span class="n">lt_or_eq_of_le</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_of_succ_le_succ</span> <span class="n">Hlt1</span><span class="o">))</span> <span class="k">with</span> <span class="n">Hlt0</span> <span class="n">Heq0</span><span class="o">,</span>
              <span class="n">cases</span> <span class="n">Hlt0</span><span class="o">,</span>
            <span class="n">rw</span> <span class="n">Heq0</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H0</span><span class="o">,</span>
          <span class="n">rw</span> <span class="n">Heq1</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H1</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">Heq2</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H2</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">Heq3</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H3</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">Heq4</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H4</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">Heq5</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H5</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<div class="codehilite"><pre><span></span>
</pre></div>

#### [ Kevin Buzzard (Nov 18 2018 at 21:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147928746):
<p>Just to be clear -- "this" isn't proving the 6 lemmas, it's proving the example. I guess I'd like some tactic which replaces <code>r &lt; 6 -&gt; P r</code> with <code>P 0 \and P 1 \and P 2 \and P 3 \and P 4 \and P 5</code> which I could then just kill with <code>\&lt;H0,H1,H2,H3,H4,H5\&gt;</code> on one line.</p>

#### [ Kevin Buzzard (Nov 18 2018 at 21:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147928810):
<p>Here's the context (question and solution on an M1F example sheet):</p>
<p><a href="https://github.com/ImperialCollegeLondon/M1F_example_sheets/tree/master/src/example_sheet_05/Sht05Q05" target="_blank" title="https://github.com/ImperialCollegeLondon/M1F_example_sheets/tree/master/src/example_sheet_05/Sht05Q05">https://github.com/ImperialCollegeLondon/M1F_example_sheets/tree/master/src/example_sheet_05/Sht05Q05</a></p>

#### [ Bryan Gin-ge Chen (Nov 18 2018 at 21:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147928998):
<p>This isn't the tactic you want, but is (in my opinion) a little cleaner than what you posted:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">Hr</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">r</span><span class="o">,</span> <span class="n">Hr</span> <span class="k">with</span>
<span class="bp">|</span> <span class="mi">0</span><span class="o">,</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">H0</span>
<span class="bp">|</span> <span class="mi">1</span><span class="o">,</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">H1</span>
<span class="bp">|</span> <span class="mi">2</span><span class="o">,</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">H2</span>
<span class="bp">|</span> <span class="mi">3</span><span class="o">,</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">H3</span>
<span class="bp">|</span> <span class="mi">4</span><span class="o">,</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">H4</span>
<span class="bp">|</span> <span class="mi">5</span><span class="o">,</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">H5</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">6</span><span class="o">),</span> <span class="n">H</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">revert</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">simp</span>
  <span class="kn">end</span>
<span class="kn">end</span>
</pre></div>

#### [ Kenny Lau (Nov 18 2018 at 21:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147929396):
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">H0</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">0</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H1</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">2</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">3</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H4</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">4</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H5</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">5</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">Hr</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">repeat</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">Hr</span> <span class="k">with</span> <span class="bp">_</span> <span class="n">Hr</span> <span class="o">},</span>
  <span class="n">exacts</span> <span class="o">[</span><span class="n">H5</span><span class="o">,</span> <span class="n">H4</span><span class="o">,</span> <span class="n">H3</span><span class="o">,</span> <span class="n">H2</span><span class="o">,</span> <span class="n">H1</span><span class="o">,</span> <span class="n">H0</span><span class="o">]</span>
<span class="kn">end</span>
</pre></div>

#### [ Kevin Buzzard (Nov 18 2018 at 22:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147932349):
<p>Nice! <code>exacts</code>??</p>

#### [ Kenny Lau (Nov 18 2018 at 22:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/147932362):
<p>it clears many goals at once</p>

#### [ Kenny Lau (Nov 24 2018 at 02:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148257191):
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fin_cases</span>

<span class="kn">lemma</span> <span class="n">H0</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">0</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H1</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">2</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">3</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H4</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">4</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H5</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">5</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">Hr</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">suffices</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">6</span><span class="o">,</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">this</span> <span class="bp">⟨</span><span class="n">r</span><span class="o">,</span> <span class="n">Hr</span><span class="bp">⟩</span> <span class="o">},</span>
  <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">fin_cases</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">exacts</span> <span class="o">[</span><span class="n">H0</span><span class="o">,</span> <span class="n">H1</span><span class="o">,</span> <span class="n">H2</span><span class="o">,</span> <span class="n">H3</span><span class="o">,</span> <span class="n">H4</span><span class="o">,</span> <span class="n">H5</span><span class="o">]</span>
<span class="kn">end</span>
</pre></div>

#### [ Kenny Lau (Nov 24 2018 at 02:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148257197):
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span></p>

#### [ Kevin Buzzard (Nov 24 2018 at 08:49)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148267406):
<p>Aah I remember Scott talking about cases on fin n. So this happened? :-) Thanks for pointing it out!</p>

#### [ Kenny Lau (Nov 24 2018 at 23:20)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148293408):
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">tactic</span> <span class="n">interactive</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">nat_lt_cases</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span>
   <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
   <span class="n">bound</span> <span class="err">←</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">,</span>
   <span class="n">expr</span><span class="bp">.</span><span class="n">local_const</span> <span class="bp">_</span> <span class="n">nval</span> <span class="bp">_</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">return</span> <span class="n">val</span><span class="o">,</span>
   <span class="n">iterate_at_most</span> <span class="n">bound</span> <span class="o">(</span><span class="n">do</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
     <span class="o">(</span><span class="bp">_</span><span class="o">,</span><span class="bp">_</span><span class="o">,(</span><span class="bp">_</span><span class="o">,</span><span class="n">e</span><span class="o">)</span><span class="bp">::_</span><span class="o">)</span><span class="bp">::_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases_core</span> <span class="n">val</span> <span class="o">[</span><span class="n">nval</span><span class="o">,</span><span class="n">h</span><span class="o">],</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">clear</span> <span class="n">e</span><span class="o">,</span> <span class="n">swap</span><span class="o">),</span>
   <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
   <span class="k">proof</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="bp">```</span><span class="o">(</span><span class="n">absurd</span> <span class="err">%%</span><span class="n">e</span> <span class="o">(</span><span class="n">not_lt_of_ge</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="err">%%</span><span class="n">ebound</span> <span class="err">%%</span><span class="n">val</span><span class="o">)),</span>
   <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="k">proof</span><span class="o">,</span>
   <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span>
   <span class="n">set_goals</span> <span class="n">goals</span><span class="bp">.</span><span class="n">reverse</span><span class="o">,</span>
   <span class="n">skip</span>
<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">lemma</span> <span class="n">H0</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">0</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H1</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">2</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">3</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H4</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">4</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">8</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>
<span class="kn">lemma</span> <span class="n">H5</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="mi">5</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">Hr</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="mi">6</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">20</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">44</span> <span class="bp">+</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">nat_lt_cases</span> <span class="n">Hr</span><span class="o">,</span>
  <span class="n">exacts</span> <span class="o">[</span><span class="n">H0</span><span class="o">,</span> <span class="n">H1</span><span class="o">,</span> <span class="n">H2</span><span class="o">,</span> <span class="n">H3</span><span class="o">,</span> <span class="n">H4</span><span class="o">,</span> <span class="n">H5</span><span class="o">]</span>
<span class="kn">end</span>
</pre></div>

#### [ Kenny Lau (Nov 24 2018 at 23:20)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148293413):
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span></p>

#### [ Kenny Lau (Nov 24 2018 at 23:20)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148293415):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> how can I improve this tactic?</p>

#### [ Kevin Buzzard (Nov 24 2018 at 23:23)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148293479):
<p>Aah, they appear in the right order this time :-) I guess you can just <code>exacts [&lt;4,0,1,rfl&gt;,&lt;0,5,0,rfl&gt;,...]</code></p>

#### [ Kevin Buzzard (Nov 24 2018 at 23:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148293527):
<p>Someone will want you to do it for <code>Ha : r &gt; 2</code> <code>Hb : r &lt;= 6</code> at some point</p>

#### [ Kenny Lau (Nov 24 2018 at 23:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/148293580):
<p>great</p>

#### [ Patrick Massot (Jan 25 2019 at 13:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156849825):
<blockquote>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">tactic</span> <span class="n">interactive</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">nat_lt_cases</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span>
   <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
   <span class="n">bound</span> <span class="err">←</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">,</span>
   <span class="n">expr</span><span class="bp">.</span><span class="n">local_const</span> <span class="bp">_</span> <span class="n">nval</span> <span class="bp">_</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">return</span> <span class="n">val</span><span class="o">,</span>
   <span class="n">iterate_at_most</span> <span class="n">bound</span> <span class="o">(</span><span class="n">do</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
     <span class="o">(</span><span class="bp">_</span><span class="o">,</span><span class="bp">_</span><span class="o">,(</span><span class="bp">_</span><span class="o">,</span><span class="n">e</span><span class="o">)</span><span class="bp">::_</span><span class="o">)</span><span class="bp">::_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases_core</span> <span class="n">val</span> <span class="o">[</span><span class="n">nval</span><span class="o">,</span><span class="n">h</span><span class="o">],</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">clear</span> <span class="n">e</span><span class="o">,</span> <span class="n">swap</span><span class="o">),</span>
   <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
   <span class="k">proof</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="bp">```</span><span class="o">(</span><span class="n">absurd</span> <span class="err">%%</span><span class="n">e</span> <span class="o">(</span><span class="n">not_lt_of_ge</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="err">%%</span><span class="n">ebound</span> <span class="err">%%</span><span class="n">val</span><span class="o">)),</span>
   <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="k">proof</span><span class="o">,</span>
   <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span>
   <span class="n">set_goals</span> <span class="n">goals</span><span class="bp">.</span><span class="n">reverse</span><span class="o">,</span>
   <span class="n">skip</span>
<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
</pre></div>


</blockquote>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> what happened to this tactic, did it ever get PR'ed?</p>

#### [ Kenny Lau (Jan 25 2019 at 13:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156849836):
<p>no it didn't</p>

#### [ Patrick Massot (Jan 25 2019 at 13:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156849845):
<p>Is there a better recommended way do achieve the same result?</p>

#### [ Kenny Lau (Jan 25 2019 at 13:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156849849):
<p>no idea</p>

#### [ Patrick Massot (Jan 25 2019 at 13:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156850210):
<p>It doesn't work at all actually</p>

#### [ Patrick Massot (Jan 25 2019 at 13:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156850217):
<p>Sometimes it works but this is very unstable</p>

#### [ Patrick Massot (Jan 25 2019 at 13:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156850397):
<p>I'd be very grateful if someone can make a reliable version of this tactic</p>

#### [ Patrick Massot (Jan 25 2019 at 14:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156851579):
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> maybe?</p>

#### [ Patrick Massot (Jan 25 2019 at 14:20)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156851743):
<p>MWE:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">tactic</span> <span class="n">interactive</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">nat_lt_cases</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span>
   <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
   <span class="n">bound</span> <span class="err">←</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">,</span>
   <span class="n">expr</span><span class="bp">.</span><span class="n">local_const</span> <span class="bp">_</span> <span class="n">nval</span> <span class="bp">_</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">return</span> <span class="n">val</span><span class="o">,</span>
   <span class="n">iterate_at_most</span> <span class="n">bound</span> <span class="o">(</span><span class="n">do</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
     <span class="o">(</span><span class="bp">_</span><span class="o">,</span><span class="bp">_</span><span class="o">,(</span><span class="bp">_</span><span class="o">,</span><span class="n">e</span><span class="o">)</span><span class="bp">::_</span><span class="o">)</span><span class="bp">::_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases_core</span> <span class="n">val</span> <span class="o">[</span><span class="n">nval</span><span class="o">,</span><span class="n">h</span><span class="o">],</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">clear</span> <span class="n">e</span><span class="o">,</span> <span class="n">swap</span><span class="o">),</span>
   <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
   <span class="k">proof</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="bp">```</span><span class="o">(</span><span class="n">absurd</span> <span class="err">%%</span><span class="n">e</span> <span class="o">(</span><span class="n">not_lt_of_ge</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="err">%%</span><span class="n">ebound</span> <span class="err">%%</span><span class="n">val</span><span class="o">)),</span>
   <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="k">proof</span><span class="o">,</span>
   <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span>
   <span class="n">set_goals</span> <span class="n">goals</span><span class="bp">.</span><span class="n">reverse</span><span class="o">,</span>
   <span class="n">skip</span>
<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="n">def</span> <span class="n">pair</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">k</span><span class="o">,</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">2</span><span class="bp">*</span><span class="n">k</span>

<span class="n">def</span> <span class="n">impair</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">k</span><span class="o">,</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">2</span><span class="bp">*</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span>

<span class="kn">lemma</span> <span class="n">div_euclide</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">.</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">exact_dec_trivial</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">q</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">r</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">*</span><span class="n">q</span> <span class="bp">+</span> <span class="n">r</span> <span class="bp">∧</span> <span class="n">r</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">a</span><span class="bp">/</span><span class="n">b</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">a</span> <span class="err">%</span> <span class="n">b</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mod_add_div</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mod_lt</span> <span class="n">a</span> <span class="n">hb</span><span class="o">]</span><span class="bp">⟩⟩</span>

<span class="kn">lemma</span> <span class="n">pair_ou_impair</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">pair</span> <span class="n">n</span> <span class="bp">∨</span> <span class="n">impair</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">rcases</span>  <span class="n">div_euclide</span> <span class="n">n</span> <span class="mi">2</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">q</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">hnqr</span><span class="o">,</span> <span class="n">hr</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">nat_lt_cases</span> <span class="n">hr</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">left</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">q</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">hnqr</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">right</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">q</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">hnqr</span> <span class="o">}</span>
<span class="kn">end</span>
</pre></div>


<p>The assumption <code>hnqr</code> randomly disappears from context in either or both of the branches</p>

#### [ Kevin Buzzard (Jan 25 2019 at 14:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156851945):
<p>make another assumption that depends on <code>hnqr</code> so it can't be deleted :-)</p>

#### [ Patrick Massot (Jan 25 2019 at 14:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156852105):
<p>Kevin, how would you do this proof in your classes?</p>

#### [ Neil Strickland (Jan 25 2019 at 14:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853132):
<p>Isn't fin_cases supposed to do this? (But fin_cases failed for unclear reasons, the only time I tried it.)</p>

#### [ Patrick Massot (Jan 25 2019 at 14:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853585):
<p>My data is not in <code>fin 2</code>, it is a <code>nat</code> which, by assumption, is less than 2. I don't want the overhead of translating back and forth between those two setups (that are mathematically indistinguishable)</p>

#### [ Patrick Massot (Jan 25 2019 at 14:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853620):
<p>I'm about to start classes on mathematical reasoning. I'll try to use Lean as a tool, but I'm not running a Lean course</p>

#### [ Patrick Massot (Jan 25 2019 at 14:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853676):
<p>I want all the technical Lean stuff to be hidden in mathlib or custom imports</p>

#### [ Rob Lewis (Jan 25 2019 at 14:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853942):
<p>I can take a shot at it. When you say the assumption randomly disappears, do you really mean its behavior changes in the same proof?</p>

#### [ Patrick Massot (Jan 25 2019 at 14:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853967):
<p>Yes, it can change if you restart Lean, or add unrelated stuff before the lemma etc.</p>

#### [ Patrick Massot (Jan 25 2019 at 14:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853976):
<p>Pretty much the same hell as with <code>tfae</code></p>

#### [ Rob Lewis (Jan 25 2019 at 14:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156853978):
<p>Hmm, okay.</p>

#### [ Patrick Massot (Jan 25 2019 at 15:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156854548):
<p>Can you reproduce that using my MNWE?</p>

#### [ Rob Lewis (Jan 25 2019 at 15:21)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156855480):
<p>Yeah, I can reproduce.</p>

#### [ Patrick Massot (Jan 25 2019 at 15:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156855542):
<p>And can you fix it?</p>

#### [ Rob Lewis (Jan 25 2019 at 15:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156855548):
<p>Not instantly!</p>

#### [ Patrick Massot (Jan 25 2019 at 15:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156855558):
<p>I see your grant money drifting away from you...</p>

#### [ Rob Lewis (Jan 25 2019 at 15:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156855647):
<p>I know grant proposals are usually ambitious, but "I can fix any bug in 10 seconds" might scare off even the ERC.</p>

#### [ Rob Lewis (Jan 25 2019 at 15:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156856534):
<p>I don't know what <code>tactic.clear e</code> is supposed to achieve. Deleting that seems to solve the issue.</p>

#### [ Rob Lewis (Jan 25 2019 at 15:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156856547):
<p>But I also don't know where the undeterminism is coming from.</p>

#### [ Rob Lewis (Jan 25 2019 at 15:40)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156856638):
<p>This whole tactic should probably be wrapped in <code>focus1</code>. If there's more than one goal when you call it, the order gets screwed up.</p>

#### [ Patrick Massot (Jan 25 2019 at 15:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156856799):
<p>Thanks! How do you "wrap in <code>focus1</code>"?</p>

#### [ Rob Lewis (Jan 25 2019 at 15:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156856812):
<p><code>meta def nat_lt_cases (h : parse ident) : tactic unit := focus1 $ do ...</code></p>

#### [ Patrick Massot (Jan 25 2019 at 17:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156863864):
<p>I tried to build a version which would also work with <code>≤</code> but failed. How would you try <code>  `(%%val &lt; %%ebound) ← infer_type e,</code> and then try <code>  `(%%val ≤ %%ebound) ← infer_type e, </code> and tweak the bound accordingly?</p>

#### [ Rob Lewis (Jan 25 2019 at 17:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156865663):
<p>I'd just define something like this:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">get_lt_sides</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="bp">ℕ</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">≤</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="o">:=</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">val</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="o">:=</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">val</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">failed</span>
</pre></div>

#### [ Rob Lewis (Jan 25 2019 at 17:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156865779):
<p>You can probably take advantage of the fact that <code>nat.lt</code> is defined in terms of <code>nat.le</code>.</p>

#### [ Patrick Massot (Jan 25 2019 at 18:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156866770):
<p>I'm afraid this will rather be a disadvantage. The le case may match when I want lt to match</p>

#### [ Patrick Massot (Jan 25 2019 at 18:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156866784):
<p>But I can't use this <code>get_lt_sides</code> in any case</p>

#### [ Rob Lewis (Jan 25 2019 at 18:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156867226):
<p>If you modify the tactic to work on an le proof instead of a lt proof, and use <code>get_lt_sides</code> at the beginning to compute <code>bound</code>, it should work when given either an le or an lt proof.</p>

#### [ Patrick Massot (Jan 25 2019 at 18:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156867228):
<p>Maybe I can actually</p>

#### [ Patrick Massot (Jan 25 2019 at 18:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156867457):
<p>My problem was I was not able to reconstitute <code>ebound</code> from <code>bound</code> but I cheated in</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">tactic</span> <span class="n">interactive</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">get_lt_sides</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span> <span class="bp">×</span> <span class="bp">ℕ</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="o">:=</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">val</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">ebound</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">≤</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="o">:=</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">val</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">ebound</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">failed</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">nat_cases</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">focus1</span> <span class="err">$</span> <span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span>
   <span class="bp">⟨</span><span class="n">val</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">ebound</span><span class="o">,</span> <span class="n">bound</span><span class="bp">⟩⟩</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span> <span class="bp">&gt;&gt;=</span> <span class="n">get_lt_sides</span><span class="o">,</span>
   <span class="n">expr</span><span class="bp">.</span><span class="n">local_const</span> <span class="bp">_</span> <span class="n">nval</span> <span class="bp">_</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">return</span> <span class="n">val</span><span class="o">,</span>
   <span class="n">iterate_at_most</span> <span class="n">bound</span> <span class="o">(</span><span class="n">do</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
     <span class="o">(</span><span class="bp">_</span><span class="o">,</span><span class="bp">_</span><span class="o">,(</span><span class="bp">_</span><span class="o">,</span><span class="n">e</span><span class="o">)</span><span class="bp">::_</span><span class="o">)</span><span class="bp">::_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases_core</span> <span class="n">val</span> <span class="o">[</span><span class="n">nval</span><span class="o">,</span><span class="n">h</span><span class="o">],</span>
     <span class="n">swap</span><span class="o">),</span>
   <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span> <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
   <span class="k">proof</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="bp">```</span><span class="o">(</span><span class="n">absurd</span> <span class="err">%%</span><span class="n">e</span> <span class="o">(</span><span class="n">not_lt_of_ge</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="err">%%</span><span class="n">ebound</span> <span class="err">%%</span><span class="n">val</span><span class="o">)),</span>
   <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="k">proof</span><span class="o">,</span>
   <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span>
   <span class="n">set_goals</span> <span class="n">goals</span><span class="bp">.</span><span class="n">reverse</span><span class="o">,</span>
   <span class="n">skip</span>
<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
</pre></div>

#### [ Patrick Massot (Jan 25 2019 at 18:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156867686):
<p>But we still have the esthetic problem that you removed the <code>tactic.clear</code> which was meant to get rid of the bound assumption (which is turned into silly inequalities after running the tactic)</p>

#### [ Rob Lewis (Jan 25 2019 at 18:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156867944):
<p>Add <code>clear_lst [h]</code> before <code>swap</code>, I think.</p>

#### [ Rob Lewis (Jan 25 2019 at 18:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156867965):
<p><code>clear</code> takes an expr, <code>clear_lst</code> takes a list of names, I think we're missing a version that takes a single name.</p>

#### [ Patrick Massot (Jan 25 2019 at 18:32)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156868588):
<p>Thank you very much Rob (and Kenny for the initial version). What I currently have is:</p>
<div class="codehilite"><pre><span></span><span class="kn">open</span> <span class="n">tactic</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">get_nat_ineq</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span> <span class="bp">×</span> <span class="bp">ℕ</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="o">:=</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">val</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">ebound</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">val</span> <span class="bp">≤</span> <span class="err">%%</span><span class="n">ebound</span><span class="o">)</span> <span class="o">:=</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">val</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">mk</span> <span class="n">ebound</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">eval_expr</span> <span class="bp">ℕ</span> <span class="n">ebound</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">failed</span>

<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">nat_cases</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">focus1</span> <span class="err">$</span> <span class="n">do</span>
  <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span>
  <span class="bp">⟨</span><span class="n">val</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">ebound</span><span class="o">,</span> <span class="n">bound</span><span class="bp">⟩⟩</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span> <span class="bp">&gt;&gt;=</span> <span class="n">get_nat_ineq</span><span class="o">,</span>
  <span class="n">expr</span><span class="bp">.</span><span class="n">local_const</span> <span class="bp">_</span> <span class="n">nval</span> <span class="bp">_</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">return</span> <span class="n">val</span><span class="o">,</span>
  <span class="n">iterate_at_most</span> <span class="n">bound</span> <span class="err">$</span> <span class="n">do</span> <span class="o">{</span>
      <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
      <span class="o">(</span><span class="bp">_</span><span class="o">,</span><span class="bp">_</span><span class="o">,(</span><span class="bp">_</span><span class="o">,</span><span class="n">e</span><span class="o">)</span><span class="bp">::_</span><span class="o">)</span><span class="bp">::_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases_core</span> <span class="n">val</span> <span class="o">[</span><span class="n">nval</span><span class="o">,</span> <span class="n">h</span><span class="o">],</span>
      <span class="n">clear_lst</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span>
      <span class="n">swap</span><span class="o">},</span>
  <span class="n">e</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">val</span> <span class="err">←</span> <span class="n">get_local</span> <span class="n">nval</span><span class="o">,</span>
  <span class="k">proof</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="bp">```</span><span class="o">(</span><span class="n">absurd</span> <span class="err">%%</span><span class="n">e</span> <span class="o">(</span><span class="n">not_lt_of_ge</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="err">%%</span><span class="n">ebound</span> <span class="err">%%</span><span class="n">val</span><span class="o">)),</span>
  <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="k">proof</span><span class="o">,</span>
  <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span>
  <span class="n">set_goals</span> <span class="n">goals</span><span class="bp">.</span><span class="n">reverse</span>
<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
</pre></div>


<p>It works for me, and I think this is a very useful tactic. Do you want to open a PR? Would you like me to do it?</p>

#### [ Patrick Massot (Jan 25 2019 at 18:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156869028):
<p>Or should we wait until someone does a version consuming an optional lower bound?</p>

#### [ Patrick Massot (Jan 25 2019 at 18:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156869069):
<p>I also have tests if you want to PR:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="mi">4</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="mi">10</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">nat_cases</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">do</span> <span class="o">{</span> <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span> <span class="n">guard</span> <span class="o">(</span><span class="n">goals</span><span class="bp">.</span><span class="n">length</span> <span class="bp">=</span> <span class="mi">5</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">exact</span> <span class="n">dec_trivial</span><span class="o">},</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="mi">10</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">nat_cases</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">do</span> <span class="o">{</span> <span class="n">goals</span> <span class="err">←</span> <span class="n">get_goals</span><span class="o">,</span> <span class="n">guard</span> <span class="o">(</span><span class="n">goals</span><span class="bp">.</span><span class="n">length</span> <span class="bp">=</span> <span class="mi">4</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">exact</span> <span class="n">dec_trivial</span><span class="o">},</span>
<span class="kn">end</span>
</pre></div>

#### [ Rob Lewis (Jan 25 2019 at 19:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156870702):
<p>Nice! I think this is "complete" when it takes an optional lower bound (and in that case, works for <code>int</code> also). When you write something that does x, and y looks similar to x, people will eventually ask you to make it do y as well. <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>

#### [ Rob Lewis (Jan 25 2019 at 19:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156870820):
<p>Going from here to there is nontrivial but not super difficult.</p>

#### [ Patrick Massot (Jan 25 2019 at 19:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156870830):
<p>I'd love to see that</p>

#### [ Rob Lewis (Jan 25 2019 at 19:05)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156870956):
<p>This could be a good exercise for anyone looking to get better at writing tactics. I don't mind seeing this PR'ed as is, with a little cleanup, with the expectation that someone will finish it.</p>

#### [ Rob Lewis (Jan 25 2019 at 19:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156871085):
<p>For cleanup: you don't need to bind the result of <code>cases_core</code>. There are some unneeded <code>tactic.</code> names since you have <code>tactic</code> open.</p>

#### [ Patrick Massot (Jan 25 2019 at 19:13)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156871498):
<p>I think that <code>tactic.exact</code> is there to disambiguate from <code>tactic.interactive.exact</code></p>

#### [ Patrick Massot (Jan 25 2019 at 19:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156873782):
<p>I'd like to know how to avoid that <code>ebound</code> hack though. Inside a tactic, I have a <code>nat</code> taken from a function returning <code>tactic nat</code>, how can I turn it into an <code>expr</code>?</p>

#### [ Simon Hudon (Jan 25 2019 at 20:46)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156879188):
<p>if <code>n</code> is your <code>nat</code>, <code>reflect n</code> will give you an expression that corresponds to it</p>

#### [ Patrick Massot (Jan 25 2019 at 20:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/6%20cases/near/156879299):
<p>Thanks!</p>


{% endraw %}
