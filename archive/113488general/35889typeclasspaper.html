---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/35889typeclasspaper.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html">typeclass paper</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="185313688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185313688" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185313688">Daniel Selsam (Jan 10 2020 at 14:25)</a>:</h4>
<p>Hello Mathlib! As many of you know, <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> <span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> and I are writing a paper about our new typeclass resolution procedure for Lean4. We have a first draft and it would be great to get feedback, particularly from people who know more about Mathlib than they do about the internals of typeclass resolution. Here is a link: <a href="https://www.dropbox.com/s/5nxklkxvdh7xna9/typeclass.pdf?dl=0" target="_blank" title="https://www.dropbox.com/s/5nxklkxvdh7xna9/typeclass.pdf?dl=0">https://www.dropbox.com/s/5nxklkxvdh7xna9/typeclass.pdf?dl=0</a> Thanks in advance.</p>
<div class="message_inline_ref"><a href="https://www.dropbox.com/s/5nxklkxvdh7xna9/typeclass.pdf?dl=0" target="_blank" title="typeclass.pdf"><img src="https://www.dropbox.com/static/images/spectrum-icons/generated/content/content-pdf-large.png"></a><div><div class="message_inline_image_title">typeclass.pdf</div><desc class="message_inline_image_desc"></desc></div></div>

<a name="185314530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185314530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185314530">Rob Lewis (Jan 10 2020 at 14:34)</a>:</h4>
<p>Do you have a submission/feedback deadline? I'd love to take a look but might not find time until next week.</p>

<a name="185314592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185314592" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185314592">Daniel Selsam (Jan 10 2020 at 14:35)</a>:</h4>
<p>We are submitting to IJCAR 2020, January 23rd deadline</p>

<a name="185318515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185318515" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185318515">Johan Commelin (Jan 10 2020 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> See <a href="https://www.math.sciences.univ-nantes.fr/~gouezel/" target="_blank" title="https://www.math.sciences.univ-nantes.fr/~gouezel/">https://www.math.sciences.univ-nantes.fr/~gouezel/</a> for how to spell <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>'s name outside of Zulip <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>

<a name="185320293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185320293" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185320293">Johan Commelin (Jan 10 2020 at 15:34)</a>:</h4>
<blockquote>
<p>Thus even though e.g. lists and multisets may usefully coerce into each other, one direction must be chosen arbitrarily for the Coe instance and the other must be sacrificed.</p>
</blockquote>
<p>How do you coerce a multiset into a list? You've lost the ordering... Do you want "multisets" and "finsets"? (Note that the generic mathematical reader won't recognize "finset", but then, they aren't your target audience anyway.)</p>

<a name="185320352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185320352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185320352">Johan Commelin (Jan 10 2020 at 15:35)</a>:</h4>
<p>Also... you talk about coercions between "bijective" types. But for example <code>multiset</code> and <code>finset</code> are not bijective. It's just that there are natural maps in both directions, but those maps are not bijections.</p>

<a name="185320490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185320490" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185320490">Johan Commelin (Jan 10 2020 at 15:36)</a>:</h4>
<p>Minor comment:</p>
<blockquote>
<p>allows reducing the scalars in a module</p>
</blockquote>
<p>It's <em>restricting</em> scalars, not "reducing"</p>

<a name="185321363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185321363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185321363">Johan Commelin (Jan 10 2020 at 15:45)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> Is this new typeclass resolution procedure implemented in Lean4 or in C++?</p>

<a name="185321667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185321667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185321667">Daniel Selsam (Jan 10 2020 at 15:49)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> Is this new typeclass resolution procedure implemented in Lean4 or in C++?</p>
</blockquote>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> in Lean4: <a href="https://github.com/leanprover/lean4/blob/master/src/Init/Lean/Meta/SynthInstance.lean" target="_blank" title="https://github.com/leanprover/lean4/blob/master/src/Init/Lean/Meta/SynthInstance.lean">https://github.com/leanprover/lean4/blob/master/src/Init/Lean/Meta/SynthInstance.lean</a></p>

<a name="185321716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185321716" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185321716">Johan Commelin (Jan 10 2020 at 15:49)</a>:</h4>
<p>Ok, cool!</p>

<a name="185321840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185321840" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185321840">Johan Commelin (Jan 10 2020 at 15:51)</a>:</h4>
<p>Is there a way to deal with diamonds that prop-eq but not def-eq?</p>

<a name="185322040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322040" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322040">Johan Commelin (Jan 10 2020 at 15:53)</a>:</h4>
<p>For example, Chris mentioned the other day that we'll get two <code>algebra ℚ ℂ</code> instances. But we know that <code>algebra ℚ K</code> is a subsingleton, so they must be prop-eq.</p>

<a name="185322170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322170" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322170">Daniel Selsam (Jan 10 2020 at 15:54)</a>:</h4>
<p>What do you mean by "deal with"? What are you afraid will happen, and what do you want to happen?</p>

<a name="185322179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322179" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322179">Johan Commelin (Jan 10 2020 at 15:54)</a>:</h4>
<p>But maybe this is not something that the typeclass resolution should deal with, but another part of the system.</p>

<a name="185322321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322321" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322321">Johan Commelin (Jan 10 2020 at 15:55)</a>:</h4>
<p>I might claim that <code>algebra_map x = algebra_map x</code>, but both sides might find different instances (especially if the expressions are a bit more complicated and not syntactically equal).</p>

<a name="185322386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322386" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322386">Johan Commelin (Jan 10 2020 at 15:56)</a>:</h4>
<p>And so Lean will refuse, because the <code>algebra_map</code>s come from different instances.</p>

<a name="185322425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322425">Johan Commelin (Jan 10 2020 at 15:56)</a>:</h4>
<p>But since those instances are prop-eq, we are a silly rw away from moving forward.</p>

<a name="185322480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322480">Johan Commelin (Jan 10 2020 at 15:57)</a>:</h4>
<p>But I realize now that this is not a problem that you hit during tc resolution, but during type checking</p>

<a name="185322562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322562">Johan Commelin (Jan 10 2020 at 15:58)</a>:</h4>
<p>So I guess it's a bit off topic in this thread.</p>

<a name="185322677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20paper/near/185322677" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/35889typeclasspaper.html#185322677">Johan Commelin (Jan 10 2020 at 15:59)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> Section 5.3 ends with a parenthetical remark (that is not properly</p>


{% endraw %}

{% include archive_update.html %}