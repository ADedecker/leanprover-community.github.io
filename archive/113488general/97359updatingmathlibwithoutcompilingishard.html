---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/97359updatingmathlibwithoutcompilingishard.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html">updating mathlib without compiling is hard</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="160483552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160483552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160483552">Kevin Buzzard (Mar 11 2019 at 14:33)</a>:</h4>
<p>I have a project with a dependency on mathlib. I want Patrick's lovely <code>has_mem (set ℝ) (filter ℝ)</code>, which is in a recent mathlib. So I go to my project, type <code>leanpkg upgrade</code> and I find that mathlib is now back at Feb 23rd. </p>
<p>So I go into <code>_target/deps/mathlib</code>, checkout master, pull, look at the latest commit, edit my leanpkg.toml to point to this commit, then type <code>update-mathlib</code> and it says "no nightly archive found".</p>
<p>Now I don't know what to do.  I know that it will be much better when someone who can build the infrastructure builds the infrastructure but I just want to get something working quickly now, and I'm sure this should be possible with a bit of hacking around.</p>
<p>How do I painlessly figure out the most recent commit that will make <code>update-mathlib</code> work? And once I've figured it out, which of (a) manually editing my toml so that it points to this mathlib commit and (b) manually switching to the correct commit in _target/deps/mathlib do I need to do, in order to get update-mathlib to work?</p>
<p>I just want the most recent commit for which I don't have to compile mathlib.</p>

<a name="160484025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160484025" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160484025">Kevin Buzzard (Mar 11 2019 at 14:39)</a>:</h4>
<p>Oh! <code>update-mathlib</code> now works! So was I just unlucky somehow? I coincidentally pulled very quickly after a commit or something?</p>

<a name="160484101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160484101" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160484101">Chris Hughes (Mar 11 2019 at 14:39)</a>:</h4>
<p>There was a commit very recently, so that may be the case.</p>

<a name="160484428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160484428" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160484428">Patrick Massot (Mar 11 2019 at 14:43)</a>:</h4>
<p>Indeed the latest nighly is 14 minutes old The answer to the question was: go to <a href="https://github.com/leanprover-community/mathlib-nightly/releases" target="_blank" title="https://github.com/leanprover-community/mathlib-nightly/releases">https://github.com/leanprover-community/mathlib-nightly/releases</a>, get the commit hash, modify the leanpkg.toml of your project, and run upodate-mathlib</p>

<a name="160484495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160484495" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160484495">Patrick Massot (Mar 11 2019 at 14:44)</a>:</h4>
<p>Hopefully this answer will soon become unneeded</p>

<a name="160492717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160492717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160492717">Simon Hudon (Mar 11 2019 at 16:16)</a>:</h4>
<p><code>leanpkg upgrade</code> followed by <code>update-mathlib</code> should also work.</p>

<a name="160492977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160492977" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160492977">Patrick Massot (Mar 11 2019 at 16:19)</a>:</h4>
<p>No it won't work in general</p>

<a name="160492995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160492995" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160492995">Patrick Massot (Mar 11 2019 at 16:19)</a>:</h4>
<p>unless you are very lucky</p>

<a name="160493069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160493069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160493069">Patrick Massot (Mar 11 2019 at 16:20)</a>:</h4>
<p>This is why we need a binary release for every commit</p>

<a name="160494177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160494177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160494177">Simon Hudon (Mar 11 2019 at 16:32)</a>:</h4>
<p>Why doesn't it work?</p>

<a name="160498741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160498741" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160498741">Johan Commelin (Mar 11 2019 at 17:19)</a>:</h4>
<p>Because <code>leanpkg upgrade</code> moves to the latest commit of <code>mathlib</code>. And that one typically doesn't have an olean-release attached to it.</p>

<a name="160499177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499177">Johan Commelin (Mar 11 2019 at 17:25)</a>:</h4>
<p>Ideally, <code>leanpkg upgrade</code> would update to latest mathlib, and call <code>update-mathlib</code>.</p>

<a name="160499244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499244" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499244">Johan Commelin (Mar 11 2019 at 17:25)</a>:</h4>
<p>Alternatively, <code>update-mathlib</code> could edit the <code>.toml</code> to point to the latest olean-release of mathlib, and do the rest of its magic.</p>

<a name="160499305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499305">Simon Hudon (Mar 11 2019 at 17:26)</a>:</h4>
<p>It should go to the latest commit on the <code>lean-3.4.2</code> branch which get pushed when we make releases. They should all have a proper olean archive attached</p>

<a name="160499353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499353" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499353">Johan Commelin (Mar 11 2019 at 17:26)</a>:</h4>
<p>Hmm... that didn't work when I last tried it.</p>

<a name="160499404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499404">Johan Commelin (Mar 11 2019 at 17:27)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/tree/lean-3.4.2" target="_blank" title="https://github.com/leanprover-community/mathlib/tree/lean-3.4.2">https://github.com/leanprover-community/mathlib/tree/lean-3.4.2</a></p>

<a name="160499409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499409">Johan Commelin (Mar 11 2019 at 17:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>

<a name="160499530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160499530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160499530">Simon Hudon (Mar 11 2019 at 17:28)</a>:</h4>
<p>That's odd. I'll have a look</p>

<a name="160518079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160518079" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160518079">Simon Hudon (Mar 11 2019 at 21:08)</a>:</h4>
<p>I think there was probably a non-monotonic rebase about 11 days ago and now Travis fails every time it tries to push to <code>lean-3.4.2</code>. I pushed it manually.</p>

<a name="160518098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160518098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160518098">Simon Hudon (Mar 11 2019 at 21:08)</a>:</h4>
<p>It should now work if you do <code>leanpkg upgrade</code> and then <code>update-mathlib</code></p>

<a name="160518417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160518417" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160518417">Patrick Massot (Mar 11 2019 at 21:13)</a>:</h4>
<p>I can confirm it works in the perfectoid project (bringing it only 2 commits behind mathlib master)</p>

<a name="160518553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/updating%20mathlib%20without%20compiling%20is%20hard/near/160518553" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/97359updatingmathlibwithoutcompilingishard.html#160518553">Simon Hudon (Mar 11 2019 at 21:15)</a>:</h4>
<p><span aria-label="fireworks" class="emoji emoji-1f386" role="img" title="fireworks">:fireworks:</span></p>


{% endraw %}
