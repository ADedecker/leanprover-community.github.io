---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/79702rcasesnames.html
---

## Stream: [general](https://leanprover-community.github.io/archive/113488general/index.html)
### Topic: [rcases names](https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html)

---

<base href="https://leanprover.zulipchat.com">
{% raw %}
#### [ Patrick Massot (Aug 06 2018 at 13:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/130971668):
<p>I guess <code>rcases</code> doesn't (recursively) invent names because using autogenerated names is evil. But could we get a tactic which uses trace to indicate what is the structure of angle brackets that would need to be used, possibly with suggested names? Sometimes I spend quite a long time to figure out what to put after <code>rcases ... with</code></p>

#### [ Simon Hudon (Aug 06 2018 at 19:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/130994054):
<p>Let's say you have <code>h : a ∧ (b ∨ c)</code>, what would you like <code>rcases h with</code> to print?</p>

#### [ Patrick Massot (Aug 06 2018 at 22:34)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131002704):
<p>I didn't think about disjunctions. I'm always using <code>rcases</code> with exists and conjunctions.</p>

#### [ Simon Hudon (Aug 06 2018 at 22:38)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131002871):
<p>Can you show me an example where you'd like <code>rcases</code> to give you more information?</p>

#### [ Mario Carneiro (Aug 06 2018 at 23:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131004847):
<p>In that case it would probably print <code>rcases h with ⟨h_1, h_2 | h_2⟩</code></p>

#### [ Simon Hudon (Aug 06 2018 at 23:23)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005023):
<p>It would be cool if that kind of information could be fed to the IDE to generate snippets, now that I think of it. Maybe that can be done</p>

#### [ Mario Carneiro (Aug 06 2018 at 23:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005164):
<p>this certainly seems doable. I don't think it will be smart enough to not name variables that are eliminated after the match (i.e. <code>h : ∃ a b, a = b</code> should become <code>⟨a, _, rfl⟩</code> rather than <code>⟨a, b, rfl⟩</code>) but otherwise it should be possible. It may do weird things with dependent functions, like this:</p>
<div class="codehilite"><pre><span></span>def f : ℕ ⊕ ℕ → Prop
| (sum.inl a) := 0 &lt; a ∧ a &lt; 1
| (sum.inr a) := ∃ b, a &lt; b ∧ b &lt; a

example (h : ∃ n, f n) : false :=
by rcases h with ⟨a|a, _, _, _⟩
</pre></div>

#### [ Reid Barton (Aug 06 2018 at 23:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005264):
<p>In the same spirit, how about filling in a <code>_</code> whose type is a structure with a <code>{ ... }</code> snippet with field names already entered</p>

#### [ Mario Carneiro (Aug 06 2018 at 23:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005267):
<p>There is one example of "hints" being used in mathlib thus far, and I just use the error message in that case</p>
<div class="codehilite"><pre><span></span>example : ∃ n, 1 = n :=
by simpa using ⟨1, rfl⟩

-- simpa failed, &#39;using&#39; expression type not directly inferrable. Try:
--
-- simpa ... using
-- show Exists
--   (eq 1),
-- from Exists.intro 1 rfl
-- state:
-- ⊢ Exists (eq 1)
</pre></div>

#### [ Mario Carneiro (Aug 06 2018 at 23:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005339):
<p>all support for editor interaction was focused on the "holes" API, and that seems to have died. We probably won't see anything new here until lean 4</p>

#### [ Simon Hudon (Aug 06 2018 at 23:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005342):
<p>I had to stare at it for a while. It can be pretty aggressive indeed. I wonder if we could direct the IDE to do increasingly deep matching.</p>

#### [ Reid Barton (Aug 06 2018 at 23:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005351):
<p>I guess you could write a tactic which uses <code>trace</code> to produce some output which the user is supposed to copy and paste in, yeah. Kind of clunky but better than nothing</p>

#### [ Simon Hudon (Aug 06 2018 at 23:32)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005397):
<p>For now, we can already start supporting <code>snippet: </code> clauses in error messages. I have some ideas how to pick up on them in emacs at least.</p>

#### [ Simon Hudon (Aug 06 2018 at 23:32)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005411):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> I agree. And then progressively, you can automate that "copy and paste"</p>

#### [ Mario Carneiro (Aug 06 2018 at 23:33)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005421):
<p>Interesting idea. Whatever API you have has to be compatible with core lean error messages though</p>

#### [ Simon Hudon (Aug 06 2018 at 23:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005496):
<p>I agree. The best would be to choose a keyword (e.g. <code>snippet</code>) that we know isn't used in core lean. That way, in the worse case, the plugin does nothing</p>

#### [ Mario Carneiro (Aug 07 2018 at 01:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009017):
<p>I started trying to implement this, but there is a problem with recursive definitions:</p>
<div class="codehilite"><pre><span></span>example (n : nat) : true :=
by rcases n with _|⟨_|⟨_|⟨_|⟨_|⟨_|_⟩⟩⟩⟩⟩; trivial
</pre></div>

#### [ Simon Hudon (Aug 07 2018 at 01:09)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009083):
<p>I did not see that coming. How about we use a default depth, maybe 3? Or just don't follow recursive references</p>

#### [ Mario Carneiro (Aug 07 2018 at 01:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009154):
<p>would the depth be cumulative over all splits or just for the one recursive? i.e. if there are two nats</p>

#### [ Simon Hudon (Aug 07 2018 at 01:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009284):
<p>I would make that depth the maximum distance between any one case split and the root of the type term. E.g. in <code>ℕ × (ℕ ⊕ ℕ)</code> match on the root product (1) then twice on the nat on the left, then match on the sum on the right (2), and then once on each nat.</p>

#### [ Simon Hudon (Aug 07 2018 at 01:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009289):
<p>It might get ugly fast though if you have structures with 10 fields include each other.</p>

#### [ Mario Carneiro (Aug 07 2018 at 01:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009423):
<p>what do you mean include each other?</p>

#### [ Simon Hudon (Aug 07 2018 at 01:20)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009471):
<p>like:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">big_struct1</span> <span class="o">:=</span> <span class="c1">-- ten fields</span>

<span class="kn">structure</span> <span class="n">big_struct2</span> <span class="o">:=</span> <span class="c1">-- ten fields of type `big_struct1`</span>

<span class="kn">structure</span> <span class="n">big_struct3</span> <span class="o">:=</span> <span class="c1">-- ten fields of type `big_struct2`</span>
</pre></div>

#### [ Mario Carneiro (Aug 07 2018 at 01:21)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009514):
<p>meh, it's still finite. Users will have to use discretion</p>

#### [ Mario Carneiro (Aug 07 2018 at 01:21)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009515):
<p>or adjust the depth</p>

#### [ Mario Carneiro (Aug 08 2018 at 13:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131100819):
<p><code>rcases_hint</code> and <code>rintro_hint</code> are now in mathlib! It was a bit more complicated than I originally thought, since you have to do basically the same thing as <code>rcases</code> except backwards so there is lots of similar but different code from <code>rcases</code>.</p>

#### [ Patrick Massot (Aug 08 2018 at 13:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131100895):
<p>did you push that?</p>

#### [ Simon Hudon (Aug 08 2018 at 23:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131132812):
<p>Awesome! You really don't waste a minute, do you?</p>

#### [ Patrick Massot (Aug 08 2018 at 23:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131132974):
<p>Simon, beware that recent discussion about that happened in the add_comm_group tactic thread (my bad)</p>

#### [ Simon Hudon (Aug 08 2018 at 23:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131134087):
<p>That's where you guys are hiding!</p>


{% endraw %}
