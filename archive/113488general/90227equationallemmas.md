---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/90227equationallemmas.html
---

## Stream: [general](index.html)
### Topic: [equational lemmas](90227equationallemmas.html)

---


{% raw %}
#### [ Simon Hudon (Jul 05 2018 at 01:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129109127):
<p>when using <code>add_decl</code> to create a definition, is it possible to declare an accompanying equational lemma?</p>

#### [ Mario Carneiro (Jul 05 2018 at 05:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129116213):
<p>As far as I know, there is no way to define equational lemmas "just like" the ones generated by the equation compiler. Maybe <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> can confirm?</p>

#### [ Simon Hudon (Jul 05 2018 at 05:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129116311):
<p>By "just like", I assume specifically that you're saying that <code>simp</code> and <code>unfold</code> won't pick up on them</p>

#### [ Simon Hudon (Jul 05 2018 at 05:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129116417):
<p>Actually, I should say that's what I'm looking for.</p>

#### [ Mario Carneiro (Jul 05 2018 at 05:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129116428):
<p>Yes, there is a C (and maybe lean?) function <code>get_equation_lemmas</code> which returns these things, but I don't think users have access to change it</p>

#### [ Simon Hudon (Jul 05 2018 at 06:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129116708):
<p>Yeah I saw it. I was pretty disappointed that it was built in</p>

#### [ Sebastian Ullrich (Jul 05 2018 at 09:05)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129122206):
<p>Right, equation lemmas are currently stored in an environment extension, which only exposes read-only access via <a href="https://github.com/leanprover/lean/blob/a4aae537fe771ee92d746d4a2be1e73c543e48b9/library/init/meta/simp_tactic.lean#L69" target="_blank" title="https://github.com/leanprover/lean/blob/a4aae537fe771ee92d746d4a2be1e73c543e48b9/library/init/meta/simp_tactic.lean#L69">tactic.get_eqn_lemmas</a></p>

#### [ Simon Hudon (Jul 05 2018 at 09:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129122431):
<p>Blast! Foiled again <span class="emoji emoji-1f61d" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span></p>

#### [ Simon Hudon (Jul 05 2018 at 09:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129122505):
<p>By the way, why I got you here, beside fields with underscore, is there any information about structures and substructures? I'm looking at <code>group</code> and it does not seem to have any underscore fields even though it has plenty of ancestry</p>

#### [ Sebastian Ullrich (Jul 05 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129122615):
<p>It should still use <code>old_structure_cmd</code></p>

#### [ Simon Hudon (Jul 05 2018 at 09:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123072):
<p>I see. I'm a bit vague on how that works. Does it mean that parent structures are expanded fully and not a trace of the  fact that it's a parent is left?</p>

#### [ Sebastian Ullrich (Jul 05 2018 at 09:39)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123183):
<p>Right. Well, the only trace is the synthesized parent coercions.</p>

#### [ Mario Carneiro (Jul 05 2018 at 09:40)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123241):
<p>luckily, these are completely replicable by users</p>

#### [ Kevin Buzzard (Jul 05 2018 at 09:40)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123244):
<p>One of my kids is doing the exercises in Software Foundations in Lean this week, that was definitely a parent coercion</p>

#### [ Simon Hudon (Jul 05 2018 at 09:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123664):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Unfortunately, this time, it's not about replicating it. I'm building proofs that structures like groups are transportable. I can unfold projections like <code>group.mul</code> but most axioms are in terms of <code>has_mul.mul</code>.</p>

#### [ Simon Hudon (Jul 05 2018 at 09:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123678):
<p>My best idea right now is hard coding references to <code>has_foo.foo</code> for multiple <code>foo</code>s.</p>

#### [ Mario Carneiro (Jul 05 2018 at 09:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123683):
<p>I don't see the problem. Won't the parent instance be embedded in the <code>has_mul.mul</code> application?</p>

#### [ Simon Hudon (Jul 05 2018 at 09:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123852):
<p>Let's say that from <code>equiv a b</code> and <code>group a</code>, I'm building <code>group b</code>. With a list of all the fields of <code>group</code>, I'd call <code>dsimp [...]</code>. I'm not sure what to do if I find the <code>group b</code> instance in there.</p>

#### [ Simon Hudon (Jul 05 2018 at 09:59)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123871):
<p>Should I look for all projections applied to that group instance?</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123936):
<p>I'm still confused. Where would there be a <code>group b</code> instance?</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123947):
<p>In the type of a field?</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129123965):
<div class="codehilite"><pre><span></span>@[to_additive name.mk_string &quot;mk&quot; (name.mk_string &quot;add_group&quot; name.anonymous)]
constructor group.mk : Π {α : Type u} (mul : α → α → α)
(mul_assoc :
  ∀ (a b c : α),
    @eq α (@has_mul.mul α (@has_mul.mk α mul) (@has_mul.mul α (@has_mul.mk α mul) a b) c)
      (@has_mul.mul α (@has_mul.mk α mul) a (@has_mul.mul α (@has_mul.mk α mul) b c))) (one : α)
(one_mul : ∀ (a : α), @eq α (@has_mul.mul α (@semigroup.to_has_mul α (@semigroup.mk α mul mul_assoc)) 1 a) a)
(mul_one : ∀ (a : α), @eq α (@has_mul.mul α (@semigroup.to_has_mul α (@semigroup.mk α mul mul_assoc)) a 1) a)
(inv : α → α),
  (∀ (a : α),
     @eq α
       (@has_mul.mul α
          (@semigroup.to_has_mul α (@monoid.to_semigroup α (@monoid.mk α mul mul_assoc one one_mul mul_one)))
          (@has_inv.inv α (@has_inv.mk α inv) a)
          a)
       1) →
  group α
</pre></div>

#### [ Simon Hudon (Jul 05 2018 at 10:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124003):
<p>Here's part of the <code>transportable</code> class:</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">transportable</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">on_equiv</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">α</span> <span class="n">β</span><span class="o">),</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">f</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">β</span><span class="o">))</span>
</pre></div>

#### [ Simon Hudon (Jul 05 2018 at 10:03)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124036):
<p>To build <code>equiv (group a) (group b)</code> I first need the <code>to_fun</code> definition (which is the hairy part we're now talking about)</p>

#### [ Simon Hudon (Jul 05 2018 at 10:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124085):
<p>Ah! Yes, that's where the instance would be:</p>
<div class="codehilite"><pre><span></span>(@has_mul.mul α
          (@semigroup.to_has_mul α (@monoid.to_semigroup α (@monoid.mk α mul mul_assoc one one_mul mul_one)))
          (@has_inv.inv α (@has_inv.mk α inv) a)
</pre></div>

#### [ Simon Hudon (Jul 05 2018 at 10:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124089):
<p>So it does not appear directly as an argument to a projection</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124090):
<p>You can unfold all those if you want</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:05)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124101):
<p>it reduces to <code>mul</code> of course</p>

#### [ Simon Hudon (Jul 05 2018 at 10:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124165):
<p>I just remembered <code>unfold_projs</code> exists. Is this what you think I should use?</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124170):
<p>shouldn't <code>dsimp</code> work?</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124178):
<p>or is the problem that you don't know what to simplify</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124182):
<p>You can use <code>whnf</code> to give it a good kick</p>

#### [ Simon Hudon (Jul 05 2018 at 10:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124234):
<blockquote>
<p>Mario Carneiro: or is the problem that you don't know what to simplify</p>
</blockquote>
<p>Yes exactly. What I'm starting with is the list of all the fields of <code>group</code></p>

#### [ Simon Hudon (Jul 05 2018 at 10:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124288):
<p><code>whnf</code> still would be pretty involved. If I just apply it to the proposition, nothing will happen because it's an equality. Then I'd need to traverse the whole expression</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124357):
<p>Of course you have to traverse the expression. How else would you figure out what to transport?</p>

#### [ Simon Hudon (Jul 05 2018 at 10:14)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124417):
<p>cancellation rules on <code>equiv</code> are doing a lot already. I thought I could use more high level primitives. My tactic is outrageously slow already without hand crafting traversals</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124426):
<p>oh, I see, you are using heuristic simplification</p>

#### [ Simon Hudon (Jul 05 2018 at 10:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124497):
<p>Yes. Do you think it might be why it's all so slow?</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124518):
<p>hard to say without knowing exactly what you are doing, but yes, I expect that a general analysis would be both more reliable and faster (and also a lot of work to write)</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124589):
<p>If you aren't going for the full decision procedure, then it seems okay to just have an ad hoc list and let users add to it as necessary</p>

#### [ Simon Hudon (Jul 05 2018 at 10:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124708):
<p>That makes sense. I'll have to do optimization at some point anyway</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:23)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124725):
<p>Even having an approximate transportable implementation would be very helpful, I think</p>

#### [ Simon Hudon (Jul 05 2018 at 10:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124773):
<p>I'll try to wrap up a prototype quickly. The feedback will be useful to pick a direction. I think the performances will be very noticeable</p>

#### [ Mario Carneiro (Jul 05 2018 at 10:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124780):
<p>Did you ever look at Johannes's <code>transport</code> tactic, with its relator based approach?</p>

#### [ Simon Hudon (Jul 05 2018 at 10:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124837):
<p>Only a while ago and never managed to understand it. I'll have another look</p>

#### [ Simon Hudon (Jul 05 2018 at 10:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129124842):
<p>Btw, here's what I have, if you want to check it out:</p>
<p><a href="https://github.com/cipher1024/transport/blob/master/src/transport.lean#L114" target="_blank" title="https://github.com/cipher1024/transport/blob/master/src/transport.lean#L114">https://github.com/cipher1024/transport/blob/master/src/transport.lean#L114</a></p>

#### [ Johan Commelin (Jul 05 2018 at 14:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129134127):
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> do you have any clue how close this brings us to the parametricity results of Wadler that <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> has been talking about?</p>

#### [ Johan Commelin (Jul 05 2018 at 14:13)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129134206):
<p>It is not clear to me how our "naive transporatability" notion compares to Wadler's parametricity when it comes to ease of use. I also don't know how they compare when it comes to ease of implementation...</p>

#### [ Simon Hudon (Jul 05 2018 at 16:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129143345):
<p>Actually, I haven't followed that conversation too closely. I'll have to catch up</p>

#### [ Simon Hudon (Jul 05 2018 at 18:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/129149249):
<p>Can you point me to the beginning of that conversation?</p>

#### [ Kenny Lau (Sep 04 2018 at 20:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/133328882):
<p>How does Lean tell the difference between an automatically generated <code>.equations._eqn_1</code> and one that I prove manually?</p>

#### [ Simon Hudon (Sep 04 2018 at 20:49)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/133328929):
<p>I have gone down that road before. In Lean 3, there's no way of getting Lean to use your lemmas as definitional equations</p>

#### [ Kenny Lau (Sep 04 2018 at 21:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/133330070):
<p>this is so sad</p>

#### [ Simon Hudon (Sep 04 2018 at 21:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equational%20lemmas/near/133330102):
<p>I'm hopeful it'll get better in Lean 4</p>


{% endraw %}
