---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/33847sanitycheck.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html">sanity check</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="174342907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174342907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174342907">Patrick Massot (Aug 28 2019 at 08:30)</a>:</h4>
<p>I'm working a bit on the <a href="https://gist.github.com/fpvandoorn/04837ea7f20479bcac9a99539d2c17b3" target="_blank" title="https://gist.github.com/fpvandoorn/04837ea7f20479bcac9a99539d2c17b3">#sanity_check cleanup</a> of topology. <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> Is there a reason why the command is not imported by default? Each file needs to add an import and then remember to remove it. It would also help tremendously if the command could print the type of the unused argument instead of only the number. But it's already very nice! What is weird is that removing useless type classes can have unexpected consequences on elaboration later one. I already had to add a couple of <code>apply_instance</code>.</p>

<a name="174343061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174343061" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174343061">Patrick Massot (Aug 28 2019 at 08:34)</a>:</h4>
<p>Maybe we could have a hole command dumping the output of #sanity_check into the Lean file, that would save a copy-paste</p>

<a name="174343122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174343122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174343122">Patrick Massot (Aug 28 2019 at 08:35)</a>:</h4>
<p>Another potential improvement: when the command find an unused argument, check whether it's duplicated and report it.</p>

<a name="174367405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174367405" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174367405">Floris van Doorn (Aug 28 2019 at 14:26)</a>:</h4>
<p>Thanks for actually cleaning up the library!</p>

<a name="174367416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174367416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174367416">Floris van Doorn (Aug 28 2019 at 14:26)</a>:</h4>
<p>I indeed forgot to add an import to <code>tactic.basic</code>. I will do that. The other improvements also seem doable.</p>

<a name="174367540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174367540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174367540">Patrick Massot (Aug 28 2019 at 14:27)</a>:</h4>
<p>It would be very nice to enter a self-sustaining cycle of cleanup/sanity_check improvements</p>

<a name="174387055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174387055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174387055">Floris van Doorn (Aug 28 2019 at 18:03)</a>:</h4>
<p>One disadvantage with a hole command is that you cannot write a hole when a command is expected, but only where an expression is expected. So you have to write something like <code>run_cmd {!!}</code> or <code>example : {!!}</code>. And then after the hole command replaces itself, you still have a broken <code>run_cmd</code> or <code>example</code>...</p>

<a name="174403421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174403421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174403421">Floris van Doorn (Aug 28 2019 at 21:38)</a>:</h4>
<p>Added all feature requests (except the self-sustaining cycle of cleanup/sanity_check improvements) in <a href="https://github.com/leanprover-community/mathlib/issues/1369" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1369">#1369</a>.</p>

<a name="174405436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174405436" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174405436">Floris van Doorn (Aug 28 2019 at 22:07)</a>:</h4>
<p>The unused argument command will now return something like</p>
<div class="codehilite"><pre><span></span><span class="c1">-- tactic\core.lean</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">symmetry_hyp</span> <span class="c">/-</span><span class="cm"> argument 2: (md : opt_param transparency transparency.semireducible) -/</span>

<span class="c1">-- meta\rb_map.lean</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">native</span><span class="bp">.</span><span class="n">rb_map</span><span class="bp">.</span><span class="n">find_def</span> <span class="c">/-</span><span class="cm"> argument 4: [_inst_2 : decidable_rel has_lt.lt] -/</span>

<span class="c1">-- logic\basic.lean</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">imp_intro</span> <span class="c">/-</span><span class="cm"> argument 4: (h₂ : β) -/</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">not_iff</span> <span class="c">/-</span><span class="cm"> argument 3: [_inst_1 : decidable a] -/</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">ball_of_forall</span> <span class="c">/-</span><span class="cm"> argument 6: (_x : q x) -/</span>

<span class="c1">-- data\list\defs.lean</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">list</span><span class="bp">.</span><span class="n">func</span><span class="bp">.</span><span class="n">neg</span> <span class="c">/-</span><span class="cm"> argument 2: [_inst_1 : inhabited α] -/</span>

<span class="c1">-- category\basic.lean</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">map_seq</span> <span class="c">/-</span><span class="cm"> argument 6: [_inst_2 : is_lawful_applicative F] (duplicate) -/</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">seq_map_assoc</span> <span class="c">/-</span><span class="cm"> argument 6: [_inst_2 : is_lawful_applicative F] (duplicate) -/</span>
</pre></div>

<a name="174405553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174405553" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174405553">Floris van Doorn (Aug 28 2019 at 22:08)</a>:</h4>
<p>I also added a new check: whether a namespace occurs twice in the name:</p>
<div class="codehilite"><pre><span></span><span class="c1">-- tactic\core.lean</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_to_tactic_format</span> <span class="c">/-</span><span class="cm"> The namespace tactic is duplicated in the name -/</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">tactic</span><span class="bp">.</span><span class="n">use</span> <span class="c">/-</span><span class="cm"> The namespace tactic is duplicated in the name -/</span>
</pre></div>

<a name="174405699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174405699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174405699">Floris van Doorn (Aug 28 2019 at 22:10)</a>:</h4>
<p>Fun fact: for this improvement I had to <a href="https://github.com/leanprover-community/mathlib/pull/1369/files#diff-59de0008ca25270e4603707014bf0ba1R398" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/1369/files#diff-59de0008ca25270e4603707014bf0ba1R398">remove an unused argument</a> from the instance <code>list.decidable_chain'</code> <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>

<a name="174447205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174447205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174447205">Patrick Massot (Aug 29 2019 at 12:10)</a>:</h4>
<p>Amazing! I promise I'll the topology fix as soon as this gets merged.</p>

<a name="174733345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sanity%20check/near/174733345" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/33847sanitycheck.html#174733345">Johan Commelin (Sep 02 2019 at 17:38)</a>:</h4>
<p>I'm getting deterministic timeouts if I run <code>#sanity_check</code> at the bottom of <a href="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/adic_space.lean" target="_blank" title="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/adic_space.lean">https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/adic_space.lean</a></p>


{% endraw %}

{% include archive_update.html %}