---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/07338markdownmoduledocstrings.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html">markdown module docstrings</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="179874075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179874075" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179874075">Chris Hughes (Nov 04 2019 at 20:41)</a>:</h4>
<p>Noob question. </p>
<p>Since we're writing all these docstrings at the top of <code>.lean</code> files in mathlib in markdown, presumably there's an easy way to see the markdown? What does <code>/-! -/</code> do?</p>

<a name="179874450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179874450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179874450">Rob Lewis (Nov 04 2019 at 20:45)</a>:</h4>
<p>Nothing useful with Lean 3.4.2 -- I think there's something missing from the API that's either fixed or fixable in the community fork. They're docstrings associated with the file instead of a particular declaration, and metaprograms can in principle access them.</p>

<a name="179874510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179874510" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179874510">Rob Lewis (Nov 04 2019 at 20:46)</a>:</h4>
<p>IIRC in 3.4.2 you can only get the docstring for the current file.</p>

<a name="179874558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179874558" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179874558">Rob Lewis (Nov 04 2019 at 20:46)</a>:</h4>
<p>It's more of a future-proofing thing. At some point we'll want to generate HTML docs for the library, and having the comments already in markdown will be convenient then.</p>

<a name="179874689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179874689" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179874689">Rob Lewis (Nov 04 2019 at 20:48)</a>:</h4>
<p>It might actually be a useful VSCode plugin to format and display the module doc for the current file when you press a button.</p>

<a name="179909843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179909843" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179909843">matt rice (Nov 05 2019 at 08:10)</a>:</h4>
<p>You can see lean 3.4.2's tests <a href="https://github.com/leanprover/lean/blob/ceacfa7445953cbc8860ddabc55407430a9ca5c3/tests/lean/run/doc_string3.lean" target="_blank" title="https://github.com/leanprover/lean/blob/ceacfa7445953cbc8860ddabc55407430a9ca5c3/tests/lean/run/doc_string3.lean">doc_string3.lean</a> for the extent of the non-community edition support e.g. there are some tactics for printing out the doc_strings.</p>
<p>I haven't tested if lumpy-leandoc does the right thing for <code>/-! -/</code> yet... but it'd be very easy to add something which extracts the .md file to it in addition to the limited html/pdf stuff it currently does.</p>

<a name="179972494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179972494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179972494">matt rice (Nov 05 2019 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span>  I fixed up lumpy so it could build mathlib again, <a href="https://gist.github.com/ratmice/00072c2695d335dfade2db54f18ae333#file-mathlib-docs-zip" target="_blank" title="https://gist.github.com/ratmice/00072c2695d335dfade2db54f18ae333#file-mathlib-docs-zip">mathlib-docs.zip</a></p>
<p>Rob Lewis seems correct in that it's not useful with 3.4.2 in lumpy at least, the <code>/-! -/</code> comments never make it to the output, so <code>/-! -/</code> only shows up when the lean files were built with the community edition.</p>
<p>The way lumpy treats <code>/-! -/</code> is to include it verbatim, i.e. It doesn't prepend it with the name of the definition to which the doc_string is associated, because it's generally just associated with the section that corresponds to the file.<br>
Hopefully that helps.</p>

<a name="179973162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973162">Rob Lewis (Nov 05 2019 at 20:25)</a>:</h4>
<p>That's actually closer to real doc generation than I realized we were.</p>

<a name="179973228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973228" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973228">Rob Lewis (Nov 05 2019 at 20:26)</a>:</h4>
<p>It seems to be treating the sections of module docs as sections of the document, which is very confusing.</p>

<a name="179973242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973242" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973242">Rob Lewis (Nov 05 2019 at 20:26)</a>:</h4>
<p>But the core structure is there.</p>

<a name="179973394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973394">Rob Lewis (Nov 05 2019 at 20:28)</a>:</h4>
<blockquote>
<p>It seems to be treating the sections of module docs as sections of the document, which is very confusing.</p>
</blockquote>
<p>In the PDF, that is. The HTML looks better, except it doesn't print the def names? Which do appear in the PDF?</p>

<a name="179973423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973423" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973423">matt rice (Nov 05 2019 at 20:28)</a>:</h4>
<p>Yeah, it's because I was following the html -&gt; tex convention that e.g. &lt;h1&gt; corresponds to \chapter &lt;h2&gt; \section etc, and the docs aren't really built with that in mind</p>

<a name="179973712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973712">Rob Lewis (Nov 05 2019 at 20:29)</a>:</h4>
<p>Yeah, this was the forseeable problem with creating the doc standards before we could generate docs.</p>

<a name="179973891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179973891" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179973891">matt rice (Nov 05 2019 at 20:31)</a>:</h4>
<p>Yup, I haven't done a lot of work on the html generation (or in fact looked at it today), it should in theory be easy to add unless i have forgotten why it is missing, I will try and look at it again tomorrow and fix that if I can.</p>

<a name="179974669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179974669" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179974669">Rob Lewis (Nov 05 2019 at 20:37)</a>:</h4>
<p>Cool. What are the prospects for linking? Something like this: "if an identifier appears between backticks, and we've seen a declaration with that name, turn it into a link." I'm guessing that's way more work?</p>

<a name="179975772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179975772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179975772">matt rice (Nov 05 2019 at 20:48)</a>:</h4>
<p>Something like that, It'll need some thought, as it parses all lean files in parallel currently, so i'll probably have to do a pass over declarations build a table of declarations first before generating links (I'm guessing we want to link across files, which means we also need to mirror the import behavior I suppose)... <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span></p>

<a name="179976376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179976376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179976376">Rob Lewis (Nov 05 2019 at 20:54)</a>:</h4>
<p>With two passes I think you could ignore the import tree. Generate a table the first pass, and note which html file each declaration will live in. Then fill in the info in the second pass. Namespacing means this will be impossible to get exactly right though. There's no way doc strings will be consistent about referring to declarations with full namespaces, and there will be ambiguous cases.</p>

<a name="179976846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179976846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179976846">matt rice (Nov 05 2019 at 20:58)</a>:</h4>
<p>yeah, shall see if we can get away with that, anyhow i must get going.</p>

<a name="179977349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/179977349" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#179977349">Rob Lewis (Nov 05 2019 at 21:02)</a>:</h4>
<p>Thanks for looking into this! It would be great to generate HTML docs for the website and this isn't so far off.</p>

<a name="180013747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180013747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180013747">matt rice (Nov 06 2019 at 09:10)</a>:</h4>
<p>Well, i updated it (and the zip file) to add the names of declarations, and a horizontal rule separating the header.</p>
<p>I think i will look at making TeX rendering optional, because the output isn't ready for consumption and it makes integrating into CI difficult since it needs lots of font stuff compiled in a specific way... With that it'll hopefully be easier to integrate into the website...</p>

<a name="180015725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180015725" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180015725">Rob Lewis (Nov 06 2019 at 09:41)</a>:</h4>
<p>Nice! I just checked out a couple of the better documented files. It looks great. <a href="https://leanprover-community.github.io/doc_demo/manifold.html" target="_blank" title="https://leanprover-community.github.io/doc_demo/manifold.html">https://leanprover-community.github.io/doc_demo/manifold.html</a></p>

<a name="180015788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180015788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180015788">Rob Lewis (Nov 06 2019 at 09:42)</a>:</h4>
<p>What about printing the type of the declaration along with the name?</p>

<a name="180015988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180015988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180015988">Rob Lewis (Nov 06 2019 at 09:45)</a>:</h4>
<p>Right now it only prints declarations that have docstrings, right? Our doc guidelines don't require them for theorems, since in principle all you need to know about a theorem is its statement. Complicated/big/important theorems should have docstrings anyway, but we probably want more than just those in the doc output.</p>

<a name="180016062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016062" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016062">Rob Lewis (Nov 06 2019 at 09:46)</a>:</h4>
<p>Is it overkill to print everything in the html docs? It feels to me like it should describe a "public" API, and there are plenty of things in the library that don't need to show up there. But I'm not sure.</p>

<a name="180016089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016089" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016089">Johan Commelin (Nov 06 2019 at 09:47)</a>:</h4>
<p><span class="user-mention" data-user-id="143402">@matt rice</span> Wow, that looks really good</p>

<a name="180016121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016121" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016121">Rob Lewis (Nov 06 2019 at 09:47)</a>:</h4>
<p>The <code>&lt;div&gt;</code>s containing the declarations should have a class so we can style it better, but that's easy.</p>

<a name="180016221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016221" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016221">Rob Lewis (Nov 06 2019 at 09:48)</a>:</h4>
<p>Also we need index pages. Also easy, I hope :)</p>

<a name="180016492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016492" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016492">Rob Lewis (Nov 06 2019 at 09:53)</a>:</h4>
<p>Once this is up and running, it gives another argument for a mathlib release schedule. We could update the docs daily. But it would probably be clearer to have fixed versions.</p>

<a name="180016758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016758" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016758">matt rice (Nov 06 2019 at 09:57)</a>:</h4>
<p>I will look at printing the type declaration, it's been on my list of things to do, but I have been scared that it's just going to give me the thing that the type is definitionally equal to, since i'm pulling it out of the bytecode :D</p>
<p>I don't know anything about html really, i'll try and figure out the div's class, I assume i need to declare some empty style e.g. decl and then give it the class decl?</p>
<p>I also wish I could style the syntax highlighting rather than hard coded colors, but that is going to take some work.</p>

<a name="180016968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180016968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180016968">Rob Lewis (Nov 06 2019 at 10:00)</a>:</h4>
<p>For the div classes, the easy part is printing <code>&lt;div class="decl"&gt;</code> instead of just <code>&lt;div&gt;</code>. Then someone needs to add a css file that styles them properly, which we probably want to integrate with the rest of the website.</p>

<a name="180017067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017067" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017067">Rob Lewis (Nov 06 2019 at 10:01)</a>:</h4>
<p>I suspect you'll get a presentable type, but I don't know.</p>

<a name="180017119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017119">matt rice (Nov 06 2019 at 10:02)</a>:</h4>
<p>index should be easy it's already in a big table just need to enumerate the keys of.</p>

<a name="180017183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017183">Johan Commelin (Nov 06 2019 at 10:03)</a>:</h4>
<p>Can you use pygments to generate highlighted code?</p>

<a name="180017397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017397" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017397">matt rice (Nov 06 2019 at 10:06)</a>:</h4>
<p>it's currently using <a href="https://docs.rs/syntect/3.3.0/syntect/" target="_blank" title="https://docs.rs/syntect/3.3.0/syntect/">syntect</a> with a conversion of the vscode syntax highlighting, I haven't really compared to how vscode gets highlighted yet to see if that conversion is accurate though.</p>
<p>Using pygments would be a big change.  Part of the reason i chose syntect is so i can compile the whole thing to web assembly eventually and not shell out to stuff.</p>

<a name="180017547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017547" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017547">Johan Commelin (Nov 06 2019 at 10:09)</a>:</h4>
<p>Aha... <code>pandoc</code> uses pygments, and so does Zulip. I don't know syntect.</p>

<a name="180017786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017786" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017786">Rob Lewis (Nov 06 2019 at 10:13)</a>:</h4>
<p>For the syntax highlighting, we could at least move the style definition to a separate css file, so the colors are specified once instead of every time code is displayed.</p>

<a name="180017864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180017864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180017864">Rob Lewis (Nov 06 2019 at 10:14)</a>:</h4>
<p>The Zulip archive lets Zulip do the structuring (with pygments, I think?) and then copies the Zulip CSS to display it.</p>

<a name="180018014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018014">Rob Lewis (Nov 06 2019 at 10:17)</a>:</h4>
<p>I don't know how different the syntect structuring is, presumably it's not compatible. But we should be able to manually match the colors for analogous items.</p>

<a name="180018089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018089" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018089">matt rice (Nov 06 2019 at 10:18)</a>:</h4>
<p>Yeah, the problem is the syntax highlighter hard coding the colors, the current solution to this is to hard code the colors for each thing to a specific unique value and then sniff the colors and turn them into the appropriate CSS.  Ideally I would like to just get it to emit CSS directly.</p>

<a name="180018120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018120">Rob Lewis (Nov 06 2019 at 10:19)</a>:</h4>
<p>Oh, I see. That's kind of annoying.</p>

<a name="180018230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018230" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018230">matt rice (Nov 06 2019 at 10:20)</a>:</h4>
<p>Yeah, there should be a way to do it, but this was easy to add as a placeholder for now.</p>

<a name="180018365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018365">Rob Lewis (Nov 06 2019 at 10:22)</a>:</h4>
<p>It's maybe not ideal, but it looks fine as-is. I wouldn't worry about it too much.</p>

<a name="180018411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018411" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018411">Rob Lewis (Nov 06 2019 at 10:23)</a>:</h4>
<blockquote>
<p>Nice! I just checked out a couple of the better documented files. It looks great. <a href="https://leanprover-community.github.io/doc_demo/manifold.html" target="_blank" title="https://leanprover-community.github.io/doc_demo/manifold.html">https://leanprover-community.github.io/doc_demo/manifold.html</a></p>
</blockquote>
<p>Updated to apply the default stylesheet. Not bad, hmm?</p>

<a name="180018511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018511" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018511">matt rice (Nov 06 2019 at 10:24)</a>:</h4>
<p>The main thing that had me tearing my hair out with pygments was that each backend has different supported rendering options, like line numbers, and things So like html may support line-numbers and latex ignore them and what not.  Eventually i would like to be able to attach footnotes to lines-numbers and for that I need some fairly custom syntax highlighting anyways.</p>

<a name="180018670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018670" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018670">Rob Lewis (Nov 06 2019 at 10:27)</a>:</h4>
<p>Speaking of line numbers, does the Lean byte code let you access the line number of a declaration? Linking declarations to their statement on GitHub would be really nice.</p>

<a name="180018907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180018907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180018907">Johan Commelin (Nov 06 2019 at 10:31)</a>:</h4>
<blockquote>
<p>Right now it only prints declarations that have docstrings, right? Our doc guidelines don't require them for theorems, since in principle all you need to know about a theorem is its statement. Complicated/big/important theorems should have docstrings anyway, but we probably want more than just those in the doc output.</p>
</blockquote>
<p>I think that maybe we should only print things that do have a docstring. Otherwise it becomes close to replicating the source. These pages could be a good intermediate step that extracts the "juicy" bits.</p>

<a name="180019039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019039" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019039">Rob Lewis (Nov 06 2019 at 10:34)</a>:</h4>
<p>Then I think we need to raise the percentage of theorems that get documented. The Python docs wouldn't be very helpful if they only told you the juicy parts about manipulating strings.</p>

<a name="180019130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019130" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019130">Rob Lewis (Nov 06 2019 at 10:34)</a>:</h4>
<p>In principle the module docs at the top should point to the juicy bits.</p>

<a name="180019159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019159" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019159">Johan Commelin (Nov 06 2019 at 10:35)</a>:</h4>
<p>So what is the purpose of these documents over the github source (besides typesetting the markdown)?</p>

<a name="180019177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019177">Rob Lewis (Nov 06 2019 at 10:35)</a>:</h4>
<p>Omitting declaration bodies gets you pretty far from the source.</p>

<a name="180019249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019249" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019249">Rob Lewis (Nov 06 2019 at 10:36)</a>:</h4>
<p>Imagine if the Python docs showed you the implementation of every function.</p>

<a name="180019260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019260" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019260">matt rice (Nov 06 2019 at 10:36)</a>:</h4>
<p>Yeah, you can extract line numbers, olean-rs/types.rs PosInfo structure.  We should be able to make links revision-stable as well if we can pull the sha out of git.</p>

<a name="180019513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180019513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180019513">Rob Lewis (Nov 06 2019 at 10:40)</a>:</h4>
<p>But again, I'm not sure that <em>every</em> theorem deserves to show up in the HTML. Maybe we could use a <code>@[nodoc]</code> attribute to make it opt-out instead of opt-in. We should have access to attributes from the byte code, right?</p>

<a name="180020075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180020075" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180020075">matt rice (Nov 06 2019 at 10:49)</a>:</h4>
<p>I believe so looks like either Modification::UserAttribute or Modification::Attr. let me know what you guys decide, currently I just ignore undocumented things.</p>

<a name="180020186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180020186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180020186">matt rice (Nov 06 2019 at 10:50)</a>:</h4>
<p>Anyhow, going go try and implement some of the things discussed.</p>

<a name="180020253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180020253" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180020253">Rob Lewis (Nov 06 2019 at 10:51)</a>:</h4>
<p>Hmm, a tougher one, can you identify when declarations are builtin or user-defined? We have a tactic to do this. But that might not be contained in the byte code.</p>

<a name="180020290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180020290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180020290">Rob Lewis (Nov 06 2019 at 10:51)</a>:</h4>
<p>We don't want to include random recursors and aux definitions in the docs.</p>

<a name="180020408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180020408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180020408">matt rice (Nov 06 2019 at 10:52)</a>:</h4>
<p>I'm not sure, there has been plenty to do without getting too in depth with the bytecode so far :)</p>

<a name="180020458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180020458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180020458">Rob Lewis (Nov 06 2019 at 10:53)</a>:</h4>
<p>Hah, fair enough!</p>

<a name="180021238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180021238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180021238">Wojciech Nawrocki (Nov 06 2019 at 11:03)</a>:</h4>
<p>It seems that most (all?) Lean-generated definitions have a name starting with an underscore at some point in the namespace - <code>_main</code>, <code>_sunfold</code>, <code>_eqn_n</code>. In addition, Lean rejects identifiers starting with the underscore, since these are reserved for the system, so it might suffice to just look for those in the name.</p>

<a name="180021490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180021490" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180021490">Rob Lewis (Nov 06 2019 at 11:06)</a>:</h4>
<p>The things that come along with an inductive type don't. <code>rec_on</code>, <code>no_confusion</code>, etc.</p>

<a name="180021530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180021530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180021530">Rob Lewis (Nov 06 2019 at 11:07)</a>:</h4>
<p>Of course, it's easy enough to blacklist those.</p>

<a name="180021627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180021627" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180021627">Mario Carneiro (Nov 06 2019 at 11:08)</a>:</h4>
<p>There is a pretty comprehensive autogenerated definition check in the linter</p>

<a name="180021658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180021658" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180021658">Rob Lewis (Nov 06 2019 at 11:09)</a>:</h4>
<p>But if we're extracting things with olean-rs we can't run that check.</p>

<a name="180021684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180021684" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180021684">Rob Lewis (Nov 06 2019 at 11:09)</a>:</h4>
<p>Maybe the check could be reimplemented.</p>

<a name="180124204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180124204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180124204">Wojciech Nawrocki (Nov 07 2019 at 11:48)</a>:</h4>
<p>An issue with printing types is that olean files seem to contain them in raw form. Unless I'm missing something, pretty-printing would then require processing all notation and pretty much reimplementing the pretty-printer. As an alternative, we could query the Lean server for types of things from lumpy. This might be quite slow unfortunately.</p>

<a name="180176504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180176504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180176504">matt rice (Nov 07 2019 at 21:12)</a>:</h4>
<p>updated the docs again, to include index and the css stuff. <a href="https://gist.github.com/ratmice/00072c2695d335dfade2db54f18ae333#file-mathlib-docs-zip" target="_blank" title="https://gist.github.com/ratmice/00072c2695d335dfade2db54f18ae333#file-mathlib-docs-zip">mathlib-docs.zip</a>, I find the alphabetical order on directory/file mix bothersome, but it functions.</p>

<a name="180239967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180239967" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180239967">Rob Lewis (Nov 08 2019 at 15:30)</a>:</h4>
<p>Maybe there's a better approach to this. Instead of extracting info directly from the oleans, should we do a first pass with a Lean metaprogram? That way we can use the existing autogenerated check, pretty-print types, etc.</p>

<a name="180240144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180240144" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180240144">Rob Lewis (Nov 08 2019 at 15:31)</a>:</h4>
<p>We'd just fold over the environment and for each declaration export the name, type, file location, docstring, and any attributes we want to display. The export can be in whatever format is convenient for the formatter to parse.</p>

<a name="180240407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180240407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180240407">Rob Lewis (Nov 08 2019 at 15:34)</a>:</h4>
<p>One thing you can't get from this approach is info about file imports. I guess we'd want to print that at some point.</p>

<a name="180240447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180240447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180240447">Wojciech Nawrocki (Nov 08 2019 at 15:34)</a>:</h4>
<p>Yes, that is the approach I think we should take. Instead of a metaprogram though, I've hacked on Lean a bit to make it produce the list of declarations in each .lean file, as well as the top-level docstrings for it. Re. file imports, I'm not sure about tactic mode, but they should be obtainable from <code>module_info</code> in the c++.</p>

<a name="180240740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/markdown%20module%20docstrings/near/180240740" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/07338markdownmoduledocstrings.html#180240740">Rob Lewis (Nov 08 2019 at 15:38)</a>:</h4>
<p>Ah, cool. Does it produce the list at the time the file is compiled, or after the whole build is done? If we want to print attributes, it's important to generate this at the end. If a declaration gets tagged as a simp lemma in a later file than where it's declared, we need to catch that.</p>


{% endraw %}

{% include archive_update.html %}