---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/05624Girymonadforproductmeasures.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html">Giry monad for product measures</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="165288626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165288626" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165288626">Koundinya Vajjha (May 09 2019 at 21:01)</a>:</h4>
<p>I want to construct the <code>k</code>-fold product measure from a measure <code>m</code>. I looked through the old chats and <span class="user-mention" data-user-id="110294">@Johannes Hölzl</span>  had a slick way to do this using the Giry Monad. Does anyone else understand how to do this? </p>
<p>Does mathlib even have product measures?</p>

<a name="165288637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165288637" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165288637">Koundinya Vajjha (May 09 2019 at 21:01)</a>:</h4>
<p>If I understand correctly, I can't directly use <code>do</code> notation to construct this as <code>measure</code> isn't  a <code>monad</code> instance.  So this won't work:</p>
<div class="codehilite"><pre><span></span>prod M1 M2 := do { x &lt;- M1, y &lt;- M2, return (x, y) }
</pre></div>

<a name="165295344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295344">Johannes Hölzl (May 09 2019 at 23:01)</a>:</h4>
<p>You <strong>can't</strong> write <code>do</code>, but you can still use <code>bind</code> and <code>dirac</code> (otherwise called <code>pure</code> or <code>return</code>). The interesting part is to prove commutativity, i.e. Fubini's theorem</p>

<a name="165295406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295406">Johannes Hölzl (May 09 2019 at 23:02)</a>:</h4>
<p><code>prod m1 m2 := m1.bind (fun x, m2.bind (fun y, dirac (x, y)))</code></p>

<a name="165295416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295416">Koundinya Vajjha (May 09 2019 at 23:02)</a>:</h4>
<p>Oh you <em>can</em> use <code>do</code>?</p>

<a name="165295444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295444" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295444">Johannes Hölzl (May 09 2019 at 23:03)</a>:</h4>
<p>argh sorry, fixed my message</p>

<a name="165295528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295528" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295528">Koundinya Vajjha (May 09 2019 at 23:05)</a>:</h4>
<p>Oh I see. Thanks!</p>

<a name="165295538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295538">Koundinya Vajjha (May 09 2019 at 23:05)</a>:</h4>
<p>I'll try this once I'm at my machine again.</p>

<a name="165295693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165295693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165295693">Jason Rute (May 09 2019 at 23:08)</a>:</h4>
<p>While the Giry Monad is a slick idea, it won’t ever work in Lean.  Here is why.  For a measure to be a monad, one needs to make sense of the type <code>measure A</code> where <code>A</code> is a type.  But that is not how measures work, <code>m</code> is not a measure on a type <code>A</code>, it is a measure on a space <code>A</code>.  (Either a measurable space, or for some types of measure theory, a Polish space or a locally compact Hausdorff space.)  Moreover, even if we could restrict to a set of types, we still need to restrict to only certain functions in our <code>map</code> operator.  For if <code>m</code> is a measure on the reals, and implicitly we are using the canonical Borel measurable structure of the reals, we still can’t expect <code>map f m</code> to be meaningful for every function from the reals to the reals.  Consider the indicator function of a non-measurable set.  There is no push-forward measure to be had.  The Giry monad is only a monad on a restricted type system.  (Such as where types are Polish spaces and functions are continuous maps.)   (Alternately, if by “measure”, you mean a probability measure on the full power set sigma algebra, then yes it is a monad, but unless you only care about the discrete setting, this is not what you want...)</p>

<a name="165296874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165296874" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165296874">Johannes Hölzl (May 09 2019 at 23:30)</a>:</h4>
<p>Uh, that's a bold claim for something which is already in mathlib: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/measure_theory/giry_monad.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/src/measure_theory/giry_monad.lean">https://github.com/leanprover-community/mathlib/blob/master/src/measure_theory/giry_monad.lean</a></p>

<a name="165296912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165296912" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165296912">Jason Rute (May 09 2019 at 23:32)</a>:</h4>
<p>Yes, I think I spoke too quickly...</p>

<a name="165296951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165296951" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165296951">Johannes Hölzl (May 09 2019 at 23:32)</a>:</h4>
<p>The trick is to just set it to 0 (or some null measure etc) if the function is not measurable. Then each equation one proves over the Giry monad requires the necessary measurability assumptions.</p>

<a name="165296984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165296984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165296984">Johannes Hölzl (May 09 2019 at 23:33)</a>:</h4>
<p>Another way to do it would be to setup the category of measurable spaces, and show that there exists a <code>measure</code>-Endofunctor in this category, and prove that it is actually a monad</p>

<a name="165296990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165296990" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165296990">Johannes Hölzl (May 09 2019 at 23:33)</a>:</h4>
<p>But to apply it I guess the current approach is the easier one</p>

<a name="165298881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165298881" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165298881">Jason Rute (May 10 2019 at 00:16)</a>:</h4>
<p>It is a nice trick (and I should never start a comment with "won't ever").  But doesn't the "set it to 0" trick violate the monadic laws, namely associativity?  For example, if <code>m</code> is the Lebesgue measure, <code>f</code> in non measurable, and <code>g x := tt</code> is constant doesn't <code>do { y &lt;- do { x &lt;- m; f x }; g y}</code> give the 0 measure, but <code>do { x &lt;- m; do { y &lt;- f x; g y }}</code> give <code>dirac tt</code>.  I think my poorly expressed point is that there isn't a way to actually make <code>measure</code> a monad in Lean which obeys the monadic axioms, but maybe I am mistaken.</p>

<a name="165298986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165298986" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165298986">Jason Rute (May 10 2019 at 00:19)</a>:</h4>
<p>Either way, you clearly made the ideas useful (and I again apologize for my brash claims).</p>

<a name="165299081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165299081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165299081">Mario Carneiro (May 10 2019 at 00:21)</a>:</h4>
<p>There is of course <code>category_theory</code> for being able to talk about monads in other categories, but you are probably right that there is no lawful monad from the category of types and functions</p>

<a name="165300366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165300366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165300366">Scott Morrison (May 10 2019 at 00:53)</a>:</h4>
<p>With a PR for monoidal categories open, general monads will be available any day now. :-)</p>

<a name="165306703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165306703" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165306703">Johan Commelin (May 10 2019 at 03:39)</a>:</h4>
<p>We won't have the <code>do</code>-notation for those general monads... I'm not sure if that is a bug or a feature <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>

<a name="165307544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165307544" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165307544">Mario Carneiro (May 10 2019 at 04:03)</a>:</h4>
<p>do notation doesn't really make sense unless you at least have the structure of a CCC, because you need lambda terms</p>

<a name="165307683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165307683" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165307683">Johan Commelin (May 10 2019 at 04:06)</a>:</h4>
<p>Sure... but even if we have CCC, we still don't have <code>do</code></p>

<a name="165307687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165307687" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165307687">Johan Commelin (May 10 2019 at 04:06)</a>:</h4>
<p>The category in question (<code>Meas</code>) is a CCC, I think [but I didn't check carefully]</p>

<a name="165307857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165307857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165307857">Mario Carneiro (May 10 2019 at 04:10)</a>:</h4>
<p>and also fancy tactic/parser footwork</p>

<a name="165307873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165307873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165307873">Johan Commelin (May 10 2019 at 04:11)</a>:</h4>
<p>Exactly... that was what I was mostly concerned about</p>

<a name="165312211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165312211" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165312211">Johannes Hölzl (May 10 2019 at 06:08)</a>:</h4>
<p><span class="user-mention" data-user-id="115715">@Jason Rute</span> yes, this is the limitation: the monadic laws only hold conditionally. All functions / sets need to be measurable.</p>

<a name="165327042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165327042" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165327042">Jason Rute (May 10 2019 at 11:08)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> I don’t think <code>Meas</code> is CCC.  At least Prop 6 in this paper says it is not: <a href="https://arxiv.org/pdf/1701.02547.pdf" target="_blank" title="https://arxiv.org/pdf/1701.02547.pdf">https://arxiv.org/pdf/1701.02547.pdf</a></p>

<a name="165327073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165327073" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165327073">Johan Commelin (May 10 2019 at 11:09)</a>:</h4>
<p>Ok... too bad. I've never really done measure theory. So I better don't make bold claims</p>

<a name="165356178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Giry%20monad%20for%20product%20measures/near/165356178" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/05624Girymonadforproductmeasures.html#165356178">Joseph Tassarotti (May 10 2019 at 17:48)</a>:</h4>
<blockquote>
<p>do notation doesn't really make sense unless you at least have the structure of a CCC, because you need lambda terms</p>
</blockquote>
<p>Why do you say that? Isn't do notation really just sugar for bind's?</p>


{% endraw %}
