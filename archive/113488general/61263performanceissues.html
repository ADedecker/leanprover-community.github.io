---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/61263performanceissues.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html">performance issues</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="170783022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170783022" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170783022">Kenny Lau (Jul 13 2019 at 09:38)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="k">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">α</span><span class="o">)</span> <span class="c1">-- _inst_7</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="k">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">))</span> <span class="c1">-- mv_polynomial.comm_ring</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="k">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="bp">_</span><span class="n">root_</span><span class="bp">.</span><span class="n">algebra</span> <span class="n">α</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">))</span> <span class="c1">-- algebra.mv_polynomial α σ</span>
<span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">implicit</span> <span class="n">true</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="bp">@</span><span class="err">«</span><span class="n">K</span><span class="err">ä</span><span class="n">hler</span><span class="err">»</span><span class="bp">.</span><span class="n">add_comm_group</span> <span class="n">α</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="n">mv_polynomial</span><span class="bp">.</span><span class="n">comm_ring</span> <span class="o">(</span><span class="n">algebra</span><span class="bp">.</span><span class="n">mv_polynomial</span> <span class="n">α</span> <span class="n">σ</span><span class="o">))</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">@«Kähler».add_comm_group α (@mv_polynomial σ α (@comm_ring.to_comm_semiring α _inst_7)) _inst_7</span>
<span class="cm">  (@mv_polynomial.comm_ring α σ (λ (a b : σ), _inst_6 a b) (λ (a b : α), _inst_8 a b) _inst_7)</span>
<span class="cm">  (@algebra.mv_polynomial α _inst_7 (λ (a b : α), _inst_8 a b) σ (λ (a b : σ), _inst_6 a b)) :</span>
<span class="cm">  add_comm_group</span>
<span class="cm">    (@«Kähler» α (@mv_polynomial σ α (@comm_ring.to_comm_semiring α _inst_7)) _inst_7</span>
<span class="cm">       (@mv_polynomial.comm_ring α σ (λ (a b : σ), _inst_6 a b) (λ (a b : α), _inst_8 a b) _inst_7)</span>
<span class="cm">       (@algebra.mv_polynomial α _inst_7 (λ (a b : α), _inst_8 a b) σ (λ (a b : σ), _inst_6 a b)))</span>
<span class="cm">-/</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="err">«</span><span class="n">K</span><span class="err">ä</span><span class="n">hler</span><span class="err">»</span><span class="bp">.</span><span class="n">add_comm_group</span> <span class="n">α</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">))</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">@«Kähler».add_comm_group α (@mv_polynomial σ α (@comm_ring.to_comm_semiring α _inst_7)) _inst_7</span>
<span class="cm">  (@mv_polynomial.comm_ring α σ (λ (a b : σ), _inst_6 a b) (λ (a b : α), _inst_8 a b) _inst_7)</span>
<span class="cm">  (@algebra.mv_polynomial α _inst_7 (λ (a b : α), _inst_8 a b) σ (λ (a b : σ), _inst_6 a b)) :</span>
<span class="cm">  add_comm_group</span>
<span class="cm">    (@«Kähler» α (@mv_polynomial σ α (@comm_ring.to_comm_semiring α _inst_7)) _inst_7</span>
<span class="cm">       (@mv_polynomial.comm_ring α σ (λ (a b : σ), _inst_6 a b) (λ (a b : α), _inst_8 a b) _inst_7)</span>
<span class="cm">       (@algebra.mv_polynomial α _inst_7 (λ (a b : α), _inst_8 a b) σ (λ (a b : σ), _inst_6 a b)))</span>
<span class="cm">-/</span>
</pre></div>

<a name="170783024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170783024" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170783024">Kenny Lau (Jul 13 2019 at 09:38)</a>:</h4>
<p>given that the first four checks are quick, why is the last one slow?</p>

<a name="170784002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170784002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170784002">Kenny Lau (Jul 13 2019 at 10:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> this is making me unable to do anything related to A^n</p>

<a name="170785541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170785541" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170785541">Kevin Buzzard (Jul 13 2019 at 11:06)</a>:</h4>
<p><span class="user-mention" data-user-id="111080">@Floris van Doorn</span> is this anything to do with the timeouts I was having in Amsterdam?</p>

<a name="170785610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170785610" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170785610">Kevin Buzzard (Jul 13 2019 at 11:09)</a>:</h4>
<p>Making instances for structures is an art and it definitely helps if you know how lean is filling in instances. Unification can struggle when presented with two defeq but not syntactically equal instances because it's defeq detector might not try hard enough. This means that if you make a new object like one forms or kaehler or whatever you want to call them, you should make sure that the instances that type class inference knows about are such that it has very little chance of getting into such a mess</p>

<a name="170785653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170785653" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170785653">Kevin Buzzard (Jul 13 2019 at 11:10)</a>:</h4>
<p>Floris taught me this in Amsterdam but I don't know if it's your problem</p>

<a name="170786393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170786393" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170786393">Kevin Buzzard (Jul 13 2019 at 11:35)</a>:</h4>
<p>I had more instances than I needed and this was messing things up. Floris fixed it by changing the priority of some of the easier ones to something lower than the default</p>

<a name="170786547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170786547" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170786547">Kevin Buzzard (Jul 13 2019 at 11:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> if you look at the type class trace can you see explicitly which instance is being found? Is it syntactically equal to the one you use when it's quick? In other words, is it taking a long time to find syntactically the right instance, or a short time to find a defeq but not syntactically equal instance?</p>

<a name="170786560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance%20issues/near/170786560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/61263performanceissues.html#170786560">Kevin Buzzard (Jul 13 2019 at 11:41)</a>:</h4>
<p>If the latter then you can meddle with the instance priorities, or make some instances local instances, to change the behaviour</p>


{% endraw %}

{% include archive_update.html %}