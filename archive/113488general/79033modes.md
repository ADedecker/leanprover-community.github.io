---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/79033modes.html
---

## Stream: [general](https://leanprover-community.github.io/archive/113488general/index.html)
### Topic: [modes](https://leanprover-community.github.io/archive/113488general/79033modes.html)

---

<base href="https://leanprover.zulipchat.com">
{% raw %}
#### [ Kevin Buzzard (Mar 02 2018 at 16:59)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123188602):
<p>So what are these "modes"? Johannes talked about <code>smt</code> mode and <code>conv</code> mode. Do mathematician end users need to know about these modes yet? I have used a <code>conv</code> tactic -- is that related to <code>conv</code> mode? My understanding of these things is still very hazy. Is there any advice for making it better other than "look through the libraries and try to spot stuff"?</p>

#### [ Mario Carneiro (Mar 02 2018 at 17:16)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123189330):
<p>As you may have noticed, the <code>conv</code> tactic isn't really a self-contained tactic; it ends with a tactic block and you have to put other tactics in it. Inside that block, proof states look a little different and there are a different set of available tactics. That is a mode</p>

#### [ Kevin Buzzard (Mar 02 2018 at 18:33)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123192054):
<p>Can I hang out in <code>conv</code> mode like I hang out in what I call "tactic mode"? Is that the correct name for that mode? The place where I can access <code>tactic.interactive</code> stuff?</p>

#### [ Sebastian Ullrich (Mar 02 2018 at 18:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123192190):
<p>Yes, in mode $m you have access to tactics from namespace <code>$m.interactive</code></p>

#### [ Sebastian Ullrich (Mar 02 2018 at 18:37)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123192195):
<p>It doesn't make sense to enter conv mode without using <code>conv</code>, but you can e.g. enter smt mode using <code>begin [smt] ... end</code></p>

#### [ Moses Schönfinkel (Mar 02 2018 at 19:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193054):
<p>Are we getting any closer to getting something like <code>omega</code> in <code>[smt]</code>?</p>

#### [ Kevin Buzzard (Mar 02 2018 at 19:15)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193561):
<div class="codehilite"><pre><span></span>example : 2 + 2 = 4 := begin
  conv in (2 + 2 = 4) {
   -- wooah I&#39;m in conv mode
   -- there is no turnstile!
   -- goal is
   -- | 2 + 2 = 4
   -- what do I do now?
  }
end
</pre></div>

#### [ Kevin Buzzard (Mar 02 2018 at 19:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193630):
<p>Yay! I can't unfold +! I can't do anything!</p>

#### [ Kevin Buzzard (Mar 02 2018 at 19:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193847):
<p>Is it <code>init/meta/converter/interactive.lean</code> I'm supposed to be looking at? (converter not conv)</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:23)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193876):
<p>Yes.</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193933):
<p>The idea is that the pipe shows you the current term that you rewrite.</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:24)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193938):
<p>Try <code>to_lhs</code>, and you get to the left side of the equation.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193946):
<p>Almost each time I try <code>conv</code> it tells me it can't find the pattern</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193952):
<p>If you do <code>whnf</code>, you convert the current subterm to WHNF.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193955):
<p>even if the pattern is <code>_</code></p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:25)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123193963):
<p>I feel it's pretty buggy.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194009):
<p>Usually I wish I could use it to rewrite under a lambda</p>

#### [ Patrick Massot (Mar 02 2018 at 19:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194014):
<p>But it very rarely succeeds</p>

#### [ Kevin Buzzard (Mar 02 2018 at 19:26)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194016):
<p>Isn't that exactly what it's for?</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194098):
<p>Something like this?</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="mi">0</span><span class="bp">+</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">conv</span> <span class="o">{</span> <span class="n">to_lhs</span><span class="o">,</span> <span class="n">funext</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">nat</span><span class="bp">.</span><span class="n">zero_add</span> <span class="n">x</span> <span class="o">},</span>
<span class="kn">end</span>
</pre></div>

#### [ Kevin Buzzard (Mar 02 2018 at 19:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194107):
<div class="codehilite"><pre><span></span>example : 2 + 2 = 4 := begin
  conv in (2 + 2) {
    whnf,
  },
  conv in (4) {
    whnf,
  },
end
</pre></div>

#### [ Kevin Buzzard (Mar 02 2018 at 19:30)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194202):
<p>When I leave conv mode it closes a goal of the form <code>x=x</code>?</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194224):
<p>Yes, it tries reflexivity and triv.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194249):
<p>I didn't know you could enter conv mode without <code>in</code> pattern</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:32)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194306):
<p><code>in</code> just navigates to the specified subterm.  Otherwise you start at the top.</p>

#### [ Kevin Buzzard (Mar 02 2018 at 19:33)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194358):
<blockquote>
<p>I didn't know you could enter conv mode without <code>in</code> pattern</p>
</blockquote>
<p>You learn about these things in the "modes" topic.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:35)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194486):
<p>What are the navigating commands inside conv mode? I see you wrote <code>to_lhs</code></p>

#### [ Patrick Massot (Mar 02 2018 at 19:41)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123194781):
<p>That <code>converter/interactive.lean</code> could have a bit more docstrings...</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195234):
<p>There's also congr, which opens subgoals for all* arguments of the current term.<br>
*Well, whatever you can reach via congruence lemmas.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195289):
<p>I don't understand what that means</p>

#### [ Patrick Massot (Mar 02 2018 at 19:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195392):
<p>What is a "goal for an argument"?</p>

#### [ Gabriel Ebner (Mar 02 2018 at 19:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195447):
<p>Step through this example:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">5</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">conv</span> <span class="o">{</span>
    <span class="n">to_lhs</span><span class="o">,</span>
    <span class="n">congr</span><span class="o">,</span>
  <span class="o">},</span>
<span class="kn">end</span>
</pre></div>


<p>After to_lhs, you have one goal <code>| 2+2</code>.  If you then invoke <code>congr</code> you get two goals, <code>| 2</code> for the first argument of <code>+</code>, and <code>| 1</code> for the second argument.</p>

#### [ Patrick Massot (Mar 02 2018 at 19:59)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195620):
<p>Ok, maybe the word "goal" is misleading here</p>

#### [ Patrick Massot (Mar 02 2018 at 20:00)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195670):
<p>You mean branch the navigation to navigate to all arguments, right?</p>

#### [ Gabriel Ebner (Mar 02 2018 at 20:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195708):
<p>I guess you could say that.</p>

#### [ Gabriel Ebner (Mar 02 2018 at 20:01)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123195725):
<p>Under the hood each of the branches is represented as a goal in the tactic state (e.g. as 2 = ?m_1), that's where I got the notation from.</p>

#### [ Patrick Massot (Mar 02 2018 at 20:08)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123196026):
<p>After navigating to a subterm, what can you do besides rewrite and whnf?</p>

#### [ Patrick Massot (Mar 02 2018 at 20:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123196130):
<p>And if I arrive using congr at two goals but I want to act only on one, how can I leave some subterm unchanged?</p>

#### [ Mario Carneiro (Mar 02 2018 at 20:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123196832):
<p>It occurs to me that <code>norm_num</code> and <code>ring</code> should probably be available as <code>conv</code> tactics</p>

#### [ Mario Carneiro (Mar 02 2018 at 20:30)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123196906):
<p>Maybe "target" is a better term than "goal" in the <code>conv</code> monad</p>

#### [ Patrick Massot (Mar 02 2018 at 20:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123197688):
<p>Indeed target sounds less confusing to me</p>

#### [ Patrick Massot (Mar 02 2018 at 20:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123197758):
<p>And ring and norm_num would probably be useful here</p>

#### [ Kevin Buzzard (Mar 02 2018 at 21:04)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123198260):
<p>I was going to try to figure out smt now</p>

#### [ Kevin Buzzard (Mar 02 2018 at 21:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123198329):
<p>but I just got an email from Leo via github...</p>

#### [ Kevin Buzzard (Mar 02 2018 at 21:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123198332):
<p><a href="https://github.com/leanprover/lean/issues/1940#issuecomment-370014241" target="_blank" title="https://github.com/leanprover/lean/issues/1940#issuecomment-370014241">https://github.com/leanprover/lean/issues/1940#issuecomment-370014241</a></p>

#### [ Patrick Massot (Mar 02 2018 at 21:06)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123198351):
<p>Yeah the B⃫DFL says we shouldn't use that</p>

#### [ Patrick Massot (Mar 02 2018 at 21:07)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123198381):
<p>This is really mysterious to me. I thought Leo came from the SMT world and wanted to bridge the gap between automated stuff and proofs assistants</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123201195):
<p>I think Leo has drawn conclusions from his experience with Z3 and SMT in general.  He believes that users are often encoding straightforward problems in very roundabout ways just because they want to fit it into the language of SMT.  This is not the best way to solve these problems.  I remember two stories that he kept telling:</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123201393):
<p>1) Somebody was using Z3 to solve physics problems.  They took measurements using a camera and (I think) gave equations to Z3 that constrained the position of an object.  However they formulated them as a problem in real arithmetic, which is somewhat expensive to decide.  Inexact numeric methods would have been a better choice here.  (Ok, this story doesn't really say anything against SMT in Lean..)</p>

#### [ Scott Morrison (Mar 02 2018 at 22:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123201475):
<p>(and of course the problem with these stories is that failures get blamed on the back-end, not the user's choice of encoding, I guess)</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123201606):
<p>2) The dependently-typed language F* uses Z3 to discharge verification conditions.  They have a wonderful paper on how to write an evaluator using e-matching.  (see <a href="http://hatt2016.inria.fr/program/" target="_blank" title="http://hatt2016.inria.fr/program/">http://hatt2016.inria.fr/program/</a>)  Essentially, they output several megabytes of essentially first-order formulas just so that Z3 evaluates an expression like <code>simp</code> would.</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:42)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202134):
<p>This one is more my own impression: SMT solvers (and theorem provers in general) have quite a bit of heuristics built-in so that they can handle many problems.  However, just going by heuristics is often brittle.  For example, Z3 has its own tactics language to specify the global proof search strategy.  <a href="https://link.springer.com/chapter/10.1007/978-3-642-36675-8_2" target="_blank" title="https://link.springer.com/chapter/10.1007/978-3-642-36675-8_2">https://link.springer.com/chapter/10.1007/978-3-642-36675-8_2</a>  I think Leo wants to do something like this in Lean.  That is, the automated theorem should not do any case-splits, other non-deterministic, or potentially expensive reasoning by default.  Instead the user should explicitly specify the expensive steps using tactics.  This approach could be less brittle and more performant than heuristic strategies.</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:44)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202211):
<p>This was also pretty much his answer when I asked him, "why doesn't Lean have the SAT part of SMT?"  He seems to have a bit of bad experience with unreliable proofs in Z3.</p>

#### [ Patrick Massot (Mar 02 2018 at 22:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202248):
<p>What about all these answers like "smt will do that, so let's not try something else" when Coq people asked for omega or other automatic tactics?</p>

#### [ Moses Schönfinkel (Mar 02 2018 at 22:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202309):
<p>It will do that once it's in a state where users can specify the expensive steps, I guess :)?</p>

#### [ Moses Schönfinkel (Mar 02 2018 at 22:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202319):
<p>Either way, thank you very much for the insight <span class="user-mention" data-user-email="gebner@gebner.org" data-user-id="110043">@Gabriel Ebner</span> .</p>

#### [ Patrick Massot (Mar 02 2018 at 22:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202374):
<p>Yes, thanks for all your explanations today</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:49)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202390):
<p>I don't know what discussion happened about omega.  I think Leo wants to have omega in the long-term future, but it's not blocking anything right now and it's not scientifically interesting either.  At that point, omega will probably work in SMT mode (if it still exists).  BTW, you can lift any tactic to SMT, so you could use <code>ring</code> as omega--.</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:49)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202401):
<p><span class="user-mention" data-user-email="di.gama@gmail.com" data-user-id="110049">@Mario Carneiro</span> said he wanted to do omega in summer, but I'm not sure what came of that.</p>

#### [ Patrick Massot (Mar 02 2018 at 22:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202449):
<p>When I'll have more time I'll try to write everything I understood about conv (from today's explanations and earlier examples) so that won't be totally lost</p>

#### [ Patrick Massot (Mar 02 2018 at 22:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202482):
<p>I don't really know what omega is meant to do but it seem to help with computation. And computations are really the most inconvenient part of Lean I've seen</p>

#### [ Gabriel Ebner (Mar 02 2018 at 22:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202556):
<p>It decides linear integer arithmetic (Presburger arithmetic), but only in one of the versions of natural numbers and integers in the Coq standard library.  (They have quite a few versions...)</p>

#### [ Patrick Massot (Mar 02 2018 at 22:56)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202694):
<p>Ok, it seems less crucial than ring and field (or a version for vector space that would be really awesome)</p>

#### [ Moses Schönfinkel (Mar 02 2018 at 22:57)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202709):
<p>Not the case when you're certifying software! :)</p>

#### [ Patrick Massot (Mar 02 2018 at 23:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123202975):
<p>I see. But remember Lean is mathematics friendly (doesn't care too much about constructivism, has documentation mentioning theorem in the title and not referring to Haskell or ML at every page etc...)</p>

#### [ Andrew Ashworth (Mar 02 2018 at 23:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123203579):
<blockquote>
<p>I see. But remember Lean is mathematics friendly (doesn't care too much about constructivism, has documentation mentioning theorem in the title and not referring to Haskell or ML at every page etc...)</p>
</blockquote>
<p>I think you might be confusing Jeremy and his CMU group with Leo :) That Lean is useful for mathematicians is a happy side-effect of Lean being useful for certifying software.</p>

#### [ Sebastian Ullrich (Mar 03 2018 at 00:31)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123206234):
<p>I believe there is a bad bug in <code>conv</code> that makes it fail with "failed to match pattern" if the conv tactic block fails... I never fixed it because I don't really use it</p>

#### [ Patrick Massot (Mar 03 2018 at 08:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123220123):
<p>That explains everything I saw when trying <code>conv</code>! Should I open an issue then? Or it enough to <span class="emoji emoji-1f64f" title="pray">:pray:</span> here?</p>

#### [ Mario Carneiro (Mar 03 2018 at 08:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123220213):
<p>Best stick to prayer. Gabriel and Sebastian are the only ones in a position to fix this if they wish, and they read this chat so consider them informed. Leo isn't going to do anything about "misleading error messages", so reporting it is just counterproductive these days.</p>

#### [ Kevin Buzzard (Mar 03 2018 at 14:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123227720):
<blockquote>
<p>That explains everything I saw when trying <code>conv</code>! Should I open an issue then? Or it enough to <span class="emoji emoji-1f64f" title="pray">:pray:</span> here?</p>
</blockquote>
<p>I guess I have had the same experience with conv as Patrick -- it has failed for me in exactly the same way (but in contrast to Sebastian I, probably like Patrick, just assumed it was me that was at fault). It's nice to be aware of the bug but now I realise that one can use it in interactive mode I feel like I have a good workaround.</p>

#### [ Simon Hudon (Mar 03 2018 at 21:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123239014):
<p>Are error messages something that could be fixed with patches from the community? I mean maybe we could learn to fix it ourselves and just submit those changes.</p>

#### [ Kevin Buzzard (Mar 03 2018 at 22:11)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123239699):
<p>I just think he wants everyone to leave him alone.</p>

#### [ Kevin Buzzard (Mar 03 2018 at 22:12)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123239740):
<p>And my impression is that we're doing that quite well recently. I've certainly sat on a couple of minor things rather than reporting trivial bugs</p>

#### [ Patrick Massot (Mar 04 2018 at 10:02)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123256892):
<p>Of course I also assumed it was my fault, especially since I understood very little of what conv was meant to do. I agree that knowing existence of this bug should be enough to mostly avoid it. But it would still be much nicer if <span class="user-mention" data-user-email="sebasti@nullri.ch" data-user-id="110024">@Sebastian Ullrich</span> could fix it.</p>

#### [ Patrick Massot (Mar 04 2018 at 22:44)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123275496):
<blockquote>
<p>Yes, it tries reflexivity and triv.</p>
</blockquote>
<p>[in the above quote, "it" refers to Lean when closing a <code>conv</code> block]</p>

#### [ Patrick Massot (Mar 04 2018 at 22:44)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123275497):
<p>Not quite</p>

#### [ Patrick Massot (Mar 04 2018 at 22:45)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123275508):
<p>It tries to close the goal when it really becomes <code>x = x</code>,  not <code>x' = x</code> with <code>x'</code> defeq <code>x</code></p>

#### [ Patrick Massot (Mar 04 2018 at 22:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123275597):
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="n">conv</span> <span class="o">{</span> <span class="n">to_lhs</span><span class="o">,</span> <span class="n">whnf</span> <span class="o">},</span>
<span class="n">trivial</span>
<span class="kn">end</span>
</pre></div>


<p>wouldn't work without that <code>trivial</code> (or <code>refl</code>)</p>

#### [ Patrick Massot (Mar 04 2018 at 23:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123276612):
<blockquote>
<p>When I'll have more time I'll try to write everything I understood about conv (from today's explanations and earlier examples) so that won't be totally lost</p>
</blockquote>
<p>see <a href="https://github.com/PatrickMassot/mathlib/blob/docs-conv/docs/extras/conv.md" target="_blank" title="https://github.com/PatrickMassot/mathlib/blob/docs-conv/docs/extras/conv.md">https://github.com/PatrickMassot/mathlib/blob/docs-conv/docs/extras/conv.md</a></p>

#### [ Patrick Massot (Mar 04 2018 at 23:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123276616):
<p>I opened a WIP PR at <a href="https://github.com/leanprover/mathlib/pull/73" target="_blank" title="https://github.com/leanprover/mathlib/pull/73">https://github.com/leanprover/mathlib/pull/73</a> so that people can add comments in a Github review</p>

#### [ Patrick Massot (Mar 04 2018 at 23:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123276655):
<p>Of course I'd like <span class="user-mention" data-user-email="gebner@gebner.org" data-user-id="110043">@Gabriel Ebner</span> to check what I wrote. But I would also like to read comments from people who don't know much about this converter mode.</p>

#### [ Kevin Buzzard (Mar 05 2018 at 00:10)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123277695):
<p>That looks fine to me. Somehow conv looks much easier to use now I realise I can use it interactively.</p>

#### [ Patrick Massot (Mar 05 2018 at 09:17)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123291923):
<p>Exactly: once explained, this is easy. The trap is to conclude this doesn't need documentation</p>

#### [ Patrick Massot (Mar 05 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123291970):
<p>To be fair, the documentation is the change log was already very efficient. Without the pattern matching bug (now promoted "well known documented bug") it may have been enough to figure it out without Gabriel's help.</p>

#### [ Patrick Massot (Mar 05 2018 at 10:43)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294559):
<p>Quick poll: <span class="user-mention" data-user-email="sebasti@nullri.ch" data-user-id="110024">@Sebastian Ullrich</span> what do you think the abbreviation <code>conv</code>stands for?</p>

#### [ Sebastian Ullrich (Mar 05 2018 at 10:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294697):
<p>convolution, obviously</p>

#### [ Patrick Massot (Mar 05 2018 at 10:47)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294708):
<p><span class="emoji emoji-1f604" title="smile">:smile:</span> Please answer seriously (unless you already saw the discussion about it on Github)</p>

#### [ Kevin Buzzard (Mar 05 2018 at 10:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294754):
<p>Patrick is trying to figure out if it's conversion or converter</p>

#### [ Kevin Buzzard (Mar 05 2018 at 10:48)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294756):
<p>for the docs</p>

#### [ Patrick Massot (Mar 05 2018 at 10:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294823):
<p>Convolution always make great jokes. When I was a third student, my algebra teacher asked the audience "do you know a commutative ring without unit?". After some silence, someone answered: "integrable functions on R with usual addition and the convolution product". The algebra teacher turned slightly green and, after a few seconds, recovered and  told us: "what about even integers?".</p>

#### [ Kevin Buzzard (Mar 05 2018 at 10:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294829):
<p>even integers are a pathological example</p>

#### [ Kevin Buzzard (Mar 05 2018 at 10:50)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294833):
<p>the first one comes up in the real world</p>

#### [ Kevin Buzzard (Mar 05 2018 at 10:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294843):
<p>it works for the p-adics  too</p>

#### [ Patrick Massot (Mar 05 2018 at 10:52)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294893):
<p>I think he only wanted to emphasize why ideals are not subrings (knowing that we agreed rings have a unit)</p>

#### [ Sebastian Ullrich (Mar 05 2018 at 10:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294901):
<p>I did see the Github thread already, unfortunately. I have no strong feelings in either direction.</p>

#### [ Patrick Massot (Mar 05 2018 at 10:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294907):
<p>And the teacher was <a href="http://www.mathematik.uni-stuttgart.de/~geckmf/" target="_blank" title="http://www.mathematik.uni-stuttgart.de/~geckmf/">http://www.mathematik.uni-stuttgart.de/~geckmf/</a> I don't think he sees convolution products in the real world</p>

#### [ Moses Schönfinkel (Mar 05 2018 at 10:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123294912):
<p>You've missed an <em>excellent</em> bikeshedding opportunity.</p>

#### [ Kevin Buzzard (Mar 05 2018 at 10:56)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123295026):
<p>Given the choice between some tedious assertion violation or the chance to weigh in on what <code>conv</code> actually means, I'm surprised he didn't take the bait!</p>

#### [ Patrick Massot (Mar 05 2018 at 10:58)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123295093):
<p>He is a wise guy. He saw <a href="https://github.com/leanprover/lean/blob/d6d44a19947e2575b3fceed6d61167d258c661fb/library/init/meta/converter/conv.lean#L4" target="_blank" title="https://github.com/leanprover/lean/blob/d6d44a19947e2575b3fceed6d61167d258c661fb/library/init/meta/converter/conv.lean#L4">God</a> already decided.</p>

#### [ Patrick Massot (Mar 05 2018 at 20:13)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123314188):
<p>What should I do with this converter vs conversion? Follow Leo or tradition?</p>

#### [ Mario Carneiro (Mar 05 2018 at 20:51)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315696):
<p>My guess is this is a non-native speakerism</p>

#### [ Patrick Massot (Mar 05 2018 at 20:53)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315807):
<p>I can understand that</p>

#### [ Patrick Massot (Mar 05 2018 at 20:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315845):
<p>It does not tell what to do</p>

#### [ Kevin Buzzard (Mar 05 2018 at 20:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315858):
<p>Go with tradition</p>

#### [ Kevin Buzzard (Mar 05 2018 at 20:54)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315863):
<p>but put a warning that Leo can change things at any time and then the docs will be broken</p>

#### [ Patrick Massot (Mar 05 2018 at 20:55)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315896):
<p>Writing conversion instead of converter would not break any code in the documentation</p>

#### [ Patrick Massot (Mar 05 2018 at 20:56)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123315912):
<p>The full name is used only in the name (which does not need to be explicitly imported since it's in init) and docstrings</p>

#### [ Patrick Massot (Mar 05 2018 at 21:27)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123317131):
<p>Hum, the name is also used in the infamous error message: "find converter  failed, pattern was not found"</p>

#### [ Patrick Massot (Mar 05 2018 at 21:28)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123317173):
<p>Now I have a sentence containing both versions (I did not dare correcting the error message)</p>

#### [ Sebastian Ullrich (Mar 06 2018 at 11:19)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123344153):
<p>Whelp, now I remember why I didn't fix the error message. <code>conv</code> uses <code>tactic.ext_simplify_core</code>, which doesn't really allow propagating errors.</p>

#### [ Patrick Massot (Mar 06 2018 at 11:22)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123344257):
<p>So it would be really complicated to fix?</p>

#### [ Sebastian Ullrich (Mar 06 2018 at 11:29)](https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/modes/near/123344448):
<p>It's not trivial at least</p>


{% endraw %}
