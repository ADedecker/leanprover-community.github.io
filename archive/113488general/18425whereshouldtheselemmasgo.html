---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/18425whereshouldtheselemmasgo.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html">where should these lemmas go</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="171960930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171960930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171960930">Kevin Kappelmann (Jul 29 2019 at 16:27)</a>:</h4>
<p>Can someone please advise me where the following lemmas should live in mathlib and if the naming/tagging is correct (proofs omitted):</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">rat</span><span class="bp">.</span><span class="n">div_num_denom_eq_div_nat_int</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">rat</span><span class="bp">.</span><span class="n">mk</span> <span class="n">n</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">num</span> <span class="bp">/</span> <span class="o">(</span><span class="n">rat</span><span class="bp">.</span><span class="n">mk</span> <span class="n">n</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">denom</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">/</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">rat</span><span class="bp">.</span><span class="n">floor_eq_num_div_denom</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="err">⌊</span><span class="n">rat</span><span class="bp">.</span><span class="n">mk</span> <span class="n">n</span> <span class="n">d</span><span class="err">⌋</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">/</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">lemma</span> <span class="n">mod_eq_sub_mul_floor_rat</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="err">%</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">d</span> <span class="bp">*</span> <span class="err">⌊</span><span class="n">rat</span><span class="bp">.</span><span class="n">mk</span> <span class="n">n</span> <span class="n">d</span><span class="err">⌋</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">lemma</span> <span class="n">coprime_sub_mul_floor</span> <span class="o">{</span><span class="n">n</span> <span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">n_coprime_d</span> <span class="o">:</span> <span class="n">n</span><span class="bp">.</span><span class="n">coprime</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">-</span> <span class="n">d</span> <span class="bp">*</span> <span class="err">⌊</span><span class="n">rat</span><span class="bp">.</span><span class="n">mk</span> <span class="n">n</span> <span class="n">d</span><span class="err">⌋</span><span class="o">)</span><span class="bp">.</span><span class="n">nat_abs</span><span class="bp">.</span><span class="n">coprime</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span>
</pre></div>


<p>Thank you :)</p>

<a name="171965537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171965537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171965537">Kevin Buzzard (Jul 29 2019 at 17:23)</a>:</h4>
<p>So let me say first that I have had very little experience of PR'ing to mathlib and you will want to get some more experienced voices before doing anything. But here's my two cents:</p>
<p>I would instinctively say "put stuff like this in <code>data.rat.basic</code>" but that file is already over 1000 lines long. Maybe it's time to split it into more than one file? We have the directory data/rat now. </p>
<p>Actually, looking at it a bit closer, maybe it should be reformulated a bit. My instinct is that one should prove <code>⌊ q ⌋ = q.num / q.denom</code> (which seems like a cleaner statement, there are no n's and d's involved, and <code>library_search</code> doesn't seem to find this) and then the first lemma follows from this and the second lemma, which makes me wonder whether the first lemma is needed at all. I'm wondering whether it's best to include just the second lemma and this <code>⌊ q ⌋ = q.num / q.denom</code> statement because they are both quite succinct, and I could imagine that they could both go in data.rat.basic or data.rat.basic2 if it gets split.</p>
<p>The third lemma is an easy consequence of the second lemma and <code>int.mod_add_div</code> I guess, so my instinct is that the natural results are there and the user can put them together if they want the 3rd result. Similarly the 4th result is not really a result about rationals, if you use the second statement then it becomes an assertion about integers which could go in data.int.gcd or something, if it's not already there.</p>
<p>PS while writing this answer I discovered that <code>data.int.basic</code> imports <code>algebra.field</code>. Not what I would have guessed.</p>

<a name="171965846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171965846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171965846">Kevin Buzzard (Jul 29 2019 at 17:27)</a>:</h4>
<p>Hmm, I see that I suggested that some lemmas involving floors could go in data.rat.basic but that's no good because the floor stuff is defined in algebra/archimedean.lean which imports data.rat.basic. So the floor rational stuff would have go to in there I guess.</p>

<a name="171979719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171979719" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171979719">Kevin Kappelmann (Jul 29 2019 at 20:16)</a>:</h4>
<p>Alright, thanks for the pointers. I'll pick my best guess from the mentioned folders then and be prepared for some PR discussion :p </p>
<p><code>rat.floor</code> is actually defined as <code>q.num / q.denom</code>, so that's pretty simple:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">{</span><span class="n">q</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">}</span> <span class="o">:</span> <span class="err">⌊</span><span class="n">q</span><span class="err">⌋</span> <span class="bp">=</span> <span class="n">q</span><span class="bp">.</span><span class="n">num</span> <span class="bp">/</span> <span class="n">q</span><span class="bp">.</span><span class="n">denom</span> <span class="o">:=</span> <span class="k">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">q</span><span class="o">,</span> <span class="n">refl</span> <span class="o">}</span>
</pre></div>


<p>however, it does not hold that <code>(rat.mk n d).num = n</code> (and similar for <code>.denom</code>) since <code>rat.mk</code> has to create a coprime pair <code>(num : int , denom : nat)</code>. But it still holds that <code>(rat.mk n d).num / (rat.mk n d).denom = n / d</code>, which is my first lemma.</p>

<a name="171990931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171990931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171990931">Mario Carneiro (Jul 29 2019 at 22:56)</a>:</h4>
<p>You can still simplify the first lemma using Kevin's lemma, to <code>⌊rat.mk n d⌋ = n / d</code></p>

<a name="171991016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171991016" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171991016">Mario Carneiro (Jul 29 2019 at 22:58)</a>:</h4>
<p>which makes it the same as the second lemma, hence why Kevin says it's not necessary</p>

<a name="171991040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/171991040" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#171991040">Mario Carneiro (Jul 29 2019 at 22:59)</a>:</h4>
<p>You should swap the order to <code>q.num / q.denom = ⌊q⌋</code> if you want these to be simp lemmas though</p>

<a name="172017375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172017375" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172017375">Kevin Kappelmann (Jul 30 2019 at 08:41)</a>:</h4>
<blockquote>
<p>You should swap the order to <code>q.num / q.denom = ⌊q⌋</code> if you want these to be simp lemmas though</p>
</blockquote>
<p>Should <code>⌊rat.mk n d⌋ = n / d</code> or <code>n / d = ⌊rat.mk n d⌋</code> or neither be a simp lemma? I would have picked the first one since it seems easier for me to deal with the division rather than <code>rat.mk</code> combined with <code>floor</code></p>

<a name="172018665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172018665" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172018665">Mario Carneiro (Jul 30 2019 at 09:01)</a>:</h4>
<p>I agree. Notice that if <code>⌊rat.mk n d⌋ = n / d</code> and <code>q.num / q.denom = ⌊q⌋</code> are both simp lemmas, then <code>(rat.mk n d).num / (rat.mk n d).denom = n / d</code> is proven by simp</p>

<a name="172028769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172028769" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172028769">Kevin Kappelmann (Jul 30 2019 at 11:36)</a>:</h4>
<blockquote>
<p>I would instinctively say "put stuff like this in <code>data.rat.basic</code>" but that file is already over 1000 lines long. Maybe it's time to split it into more than one file? We have the directory data/rat now. </p>
</blockquote>
<p>I think it is time. I made a <a href="https://github.com/leanprover-community/mathlib/pull/1284" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/1284">PR to split it</a>.</p>

<a name="172029199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029199" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029199">Johan Commelin (Jul 30 2019 at 11:43)</a>:</h4>
<p>You can use <code>default.lean</code> to export a "default" set of files. (Which can then be imported using <code>import data.rat</code>.)</p>

<a name="172029259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029259">Johan Commelin (Jul 30 2019 at 11:44)</a>:</h4>
<p>I guess a next (and tedious) step, is to minimize the <code>import data.rat.*</code> in the rest of the library. But <code>olean-rs</code> might be able to help with that.</p>

<a name="172029322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029322">Kevin Kappelmann (Jul 30 2019 at 11:45)</a>:</h4>
<p>Yeah, I was a bit afraid of changing <code>basic.lean</code> to <code>default.lean</code> since every <code>rat.basic</code> import then needs to be changed. Should I create <code>default.lean</code> that just imports <code>basic.lean</code> for now?</p>

<a name="172029401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029401">Chris Hughes (Jul 30 2019 at 11:46)</a>:</h4>
<p>I would at least import <code>basic</code> and <code>order</code>.</p>

<a name="172029654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029654" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029654">Johan Commelin (Jul 30 2019 at 11:50)</a>:</h4>
<p><span class="user-mention" data-user-id="198376">@Kevin Kappelmann</span> I find it hard to say, atm. I think you said there was some sort of (almost) import loop? What was it exactly?</p>

<a name="172029668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029668">Johan Commelin (Jul 30 2019 at 11:51)</a>:</h4>
<p>Because that might help in determining how to structure things.</p>

<a name="172029962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172029962" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172029962">Kevin Kappelmann (Jul 30 2019 at 11:55)</a>:</h4>
<p>Imports where OK; just Kevin B. noticed:</p>
<blockquote>
<p>PS while writing this answer I discovered that data.int.basic imports algebra.field. Not what I would have guessed.</p>
<p>Hmm, I see that I suggested that some lemmas involving floors could go in data.rat.basic but that's no good because the floor stuff is defined in algebra/archimedean.lean which imports data.rat.basic. So the floor rational stuff would have go to in there I guess.</p>
</blockquote>
<p>My idea was:<br>
- <code>data.rat.field</code> defines the field structure<br>
- <code>data.rat.order</code> defines the order and related functions<br>
- <code>data.rat.cast</code> defines the casts<br>
- <code>data.rat.floor_ceil</code> defines floor and ceil functions<br>
- <code>data.rat.basic</code> imports the previous four.</p>
<p>If we want to have <code>data.rat.default</code>, my proposal is to just import <code>data.rat.basic</code> from <code>data.rat.default</code> for now and in a different PR update the <code>data.rat.basic</code> and <code>data.rat.*</code> imports.</p>

<a name="172030195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172030195" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172030195">Chris Hughes (Jul 30 2019 at 11:58)</a>:</h4>
<p>If you don't want to break anything, isn't it best to import all of them from default at the moment, and change imports from <code>data.rat.basic</code> to <code>data.rat.default</code> and then minimise the imports in a separate PR.</p>

<a name="172030423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172030423" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172030423">Kevin Kappelmann (Jul 30 2019 at 12:01)</a>:</h4>
<p>OK, doing some quick search, I think fixing the imports shouldn't be difficult. Gimme a few mins.</p>

<a name="172030536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172030536" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172030536">Johan Commelin (Jul 30 2019 at 12:02)</a>:</h4>
<p>Does this help removing <code>algebra.field</code> as import from <code>data.int.basic</code>?</p>

<a name="172031077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172031077" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172031077">Kevin Kappelmann (Jul 30 2019 at 12:08)</a>:</h4>
<p>Nope, that's unrelated to this PR</p>

<a name="172031677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172031677" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172031677">Johan Commelin (Jul 30 2019 at 12:17)</a>:</h4>
<p>Ok, I see.</p>

<a name="172031806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172031806" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172031806">Kevin Kappelmann (Jul 30 2019 at 12:18)</a>:</h4>
<p>I changed <code>basic</code> to <code>default</code> and <code>floor_ceil</code> to <code>floor</code> now in the new version.</p>

<a name="172033010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172033010" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172033010">Johan Commelin (Jul 30 2019 at 12:35)</a>:</h4>
<p><span class="user-mention" data-user-id="198376">@Kevin Kappelmann</span> We're still in the process of figuring out what exactly we want to document. We just had a change in policy. My apologies for confusing questions/remarks on your PR. It's a bit of a playground/testing ground.</p>

<a name="172034795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172034795" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172034795">Mario Carneiro (Jul 30 2019 at 12:57)</a>:</h4>
<p>I don't see why we need to remove the <code>algebra.field</code> import. That's basically the definition of <code>field</code> as a structure (or would be if it wasn't in core already)</p>

<a name="172034894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20should%20these%20lemmas%20go/near/172034894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18425whereshouldtheselemmasgo.html#172034894">Mario Carneiro (Jul 30 2019 at 12:58)</a>:</h4>
<p>and obviously <code>rat</code> is a field and that's pretty integral to the definition. We aren't so bootstrapped that we need to separate the type rat from the field rat</p>


{% endraw %}

{% include archive_update.html %}