---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113489newmembers/99675spheres.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html">spheres</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="188451346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188451346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188451346">Greg Langmead (Feb 18 2020 at 13:46)</a>:</h4>
<p>Currently I am trying to supply the proof that the inverse of stereographic projection lands in the sphere, but because it's a summation I don't know what sort of tools to use. The new <code>hint</code> tactic lists a few tactics that make progress but it's not really actionable since I can't assemble them into a proof so far. Am I looking for a combination of standard tactics like <code>field_simp</code>/<code>norm_num</code>/<code>ring</code> or is something additional needed due to the sum?</p>
<p>And as a meta-question, what techniques am I missing that would enable me to understand at least a sketch of what I need to do next? My only methods are to try a few tactics I know and see if they magically work. I don't know how to incrementally build something.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>
<span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">hint</span>

<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fin_upgrade</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">val</span> <span class="o">:=</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="n">is_lt</span> <span class="o">:=</span> <span class="n">lt</span>
<span class="o">}</span>

<span class="c1">-- Unit sphere of dimension n, inside euclidean space of dimension n + 1</span>
<span class="n">def</span> <span class="n">unit_sphere</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">x</span> <span class="o">:</span> <span class="n">euclidean_space</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">//</span> <span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">i</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">}</span>

<span class="n">def</span> <span class="n">stereographic_projection_inv_north</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">euclidean_space</span> <span class="n">n</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">unit_sphere</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span><span class="n">x</span><span class="o">,</span> <span class="bp">⟨λ</span><span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)),</span> <span class="o">(</span><span class="k">if</span> <span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span>
    <span class="k">then</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="o">(</span><span class="n">fin_upgrade</span> <span class="n">n</span> <span class="n">i</span> <span class="n">lt</span><span class="o">))</span> <span class="bp">/</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span>
    <span class="k">else</span> <span class="o">(((</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span><span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))),</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- hint recommends: ring, norm_num, simp at *, dsimp at *</span>
<span class="kn">end</span>
<span class="bp">⟩</span>
</pre></div>

<a name="188451764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188451764" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188451764">Kevin Buzzard (Feb 18 2020 at 13:52)</a>:</h4>
<p>I would not take what <code>hint</code> recommends too seriously. It's supposed to be used for "simple" problems, and if you think this is simple then you're miscalibrated.</p>

<a name="188451979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188451979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188451979">Kevin Buzzard (Feb 18 2020 at 13:55)</a>:</h4>
<p>Looking at what you have, it seems to me that the first step is to break up the sum from 0 to n as a sum from 0 to n-1, plus the n'th term. This will enable you to get rid of the "if". Then you want to take the division outside the sum.</p>

<a name="188452194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188452194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188452194">Kevin Buzzard (Feb 18 2020 at 13:58)</a>:</h4>
<p>Then the question should become a question in ring theory, and you'll still have some work to do. But step 1 should be getting rid of the <code>if</code> and step 2 getting rid of the denominators.</p>

<a name="188453713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188453713" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188453713">Kevin Buzzard (Feb 18 2020 at 14:17)</a>:</h4>
<div class="codehilite"><pre><span></span>finset.sum_range_succ :
  ∀ (f : ℕ → ?M_1) (n : ℕ), finset.sum (finset.range (nat.succ n)) f = f n + finset.sum (finset.range n) f

finset.sum_mul : finset.sum ?M_3 ?M_4 * ?M_5 = finset.sum ?M_3 (λ (x : ?M_1), ?M_4 x * ?M_5)

div_eq_mul_inv : ?M_3 / ?M_4 = ?M_3 * ?M_4⁻¹
</pre></div>

<a name="188454967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188454967" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188454967">Kevin Buzzard (Feb 18 2020 at 14:32)</a>:</h4>
<p>This is kind of annoying because you don't have <code>f : ℕ → ?M_1</code>, you have <code>f : fin n → ℝ</code></p>

<a name="188459235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188459235" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188459235">Greg Langmead (Feb 18 2020 at 15:19)</a>:</h4>
<p>I'm not clear how I can get rid of the <code>if</code>. The codomain of this function is <code>unit_sphere n</code> which is in R^(n+1), so I need a lambda on <code>fin (n + 1)</code> which has two cases with different formulas. Here's the formula from R^2 to R^3:<br>
<a href="/user_uploads/3121/OY8rMuTQNNyT0Pq5NJjDxLaN/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a> <br>
Once I have the function I need to prove its values have norm 1. Does Lean know that I should sum the square of all the cases of the <code>if</code>? Could I express the function in the first place as being divided by its own norm? Ooh maybe I should break this up into the composition of two functions: a nonzero function followed by dividing that function by its own norm.</p>
<div class="message_inline_image"><a href="/user_uploads/3121/OY8rMuTQNNyT0Pq5NJjDxLaN/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/3121/OY8rMuTQNNyT0Pq5NJjDxLaN/pasted_image.png"></a></div>

<a name="188464352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188464352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188464352">Kevin Buzzard (Feb 18 2020 at 16:14)</a>:</h4>
<p>Right. So your job is to prove that the sum of the squares of those entries is 1. My proposal is to write the sum as (the sum of the first <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> things) plus (the last thing), then take out the factor <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msubsup><mi>X</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">1+\sum_{i=0}^{n-1}X_i^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.253718em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>, then you're reduced to proving <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msubsup><mi>X</mi><mi>i</mi><mn>2</mn></msubsup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><mn>2</mn><msub><mi>X</mi><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>X</mi><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(-1+\sum_{i=0}^{n-1}X_i^2)^2+\sum_{i=0}^{n-1}(2X_i)^2=(1+\sum_{i=0}^{n-1}(X_i)^2)^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.253718em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.253718em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.253718em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>, which you can do using <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">(a+b)^2=a^2+b^2+2ab</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span></span></span></span>.</p>

<a name="188476322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188476322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188476322">Kevin Buzzard (Feb 18 2020 at 18:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>

<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fin_upgrade</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">val</span> <span class="o">:=</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="n">is_lt</span> <span class="o">:=</span> <span class="n">lt</span>
<span class="o">}</span>

<span class="kn">theorem</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_univ_fin_eq_sum_range</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="n">finset</span><span class="bp">.</span><span class="n">univ</span> <span class="n">f</span> <span class="bp">=</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">set</span> <span class="n">F</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">with</span> <span class="n">hF</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">F</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">ext</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">hF</span><span class="o">,</span>
    <span class="k">show</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">dite</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">),</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">),</span> <span class="mi">0</span><span class="o">),</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="n">i</span><span class="bp">.</span><span class="n">is_lt</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">i</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span><span class="n">finset</span><span class="bp">.</span><span class="n">sum_image</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">congr&#39;</span><span class="o">,</span>
    <span class="c1">-- ⊢ finset.image (λ (x : fin n), x.val) finset.univ = finset.range n</span>
    <span class="n">ext</span> <span class="n">j</span><span class="o">,</span> <span class="c1">-- sigh</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">mem_range</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_image</span><span class="o">],</span>
    <span class="n">split</span><span class="o">,</span>
      <span class="n">rintro</span> <span class="bp">⟨⟨</span><span class="n">j</span><span class="o">,</span><span class="n">hj</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">hj</span><span class="o">,</span>
    <span class="n">intro</span> <span class="n">hj</span><span class="o">,</span>
    <span class="n">use</span> <span class="bp">⟨</span><span class="n">j</span><span class="o">,</span> <span class="n">hj</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span> <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_univ</span><span class="o">,</span> <span class="n">refl</span>
  <span class="o">},</span>
  <span class="n">intros</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_div</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="n">s</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">/</span> <span class="n">d</span><span class="o">)</span> <span class="bp">=</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="n">s</span> <span class="n">f</span> <span class="bp">/</span> <span class="n">d</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">by_cases</span> <span class="n">hd</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hd</span><span class="o">,</span> <span class="n">div_zero</span><span class="o">],</span>
    <span class="n">convert</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_const_zero</span><span class="o">,</span>
    <span class="n">ext</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">div_zero</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">div_eq_mul_inv</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_mul</span><span class="o">],</span>
  <span class="n">congr&#39;</span><span class="o">,</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">unit_sphere</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">x</span> <span class="o">:</span> <span class="n">euclidean_space</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">//</span> <span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">i</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">}</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="n">def</span> <span class="n">stereographic_projection_inv_north</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">euclidean_space</span> <span class="n">n</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">unit_sphere</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span><span class="n">x</span><span class="o">,</span> <span class="bp">⟨λ</span><span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)),</span> <span class="o">(</span><span class="k">if</span> <span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span>
    <span class="k">then</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="o">(</span><span class="n">fin_upgrade</span> <span class="n">n</span> <span class="n">i</span> <span class="n">lt</span><span class="o">))</span> <span class="bp">/</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span>
    <span class="k">else</span> <span class="o">(((</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span><span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))),</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">sum_univ_fin_eq_sum_range</span><span class="o">,</span> <span class="n">sum_range_succ</span><span class="o">,</span> <span class="n">dif_pos</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">lt_succ_self</span> <span class="n">n</span><span class="o">),</span> <span class="n">dif_neg</span> <span class="o">(</span><span class="n">lt_irrefl</span> <span class="n">n</span><span class="o">)],</span>
  <span class="n">suffices</span> <span class="o">:</span> <span class="o">((</span><span class="n">sum</span> <span class="n">univ</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span> <span class="n">j</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">sum</span> <span class="n">univ</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span> <span class="n">j</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">+</span>
    <span class="o">(</span><span class="n">sum</span> <span class="o">(</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span>  <span class="k">else</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">sum</span> <span class="n">univ</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span> <span class="n">j</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span>
    <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">convert</span> <span class="n">this</span> <span class="kn">using</span> <span class="mi">2</span><span class="o">,</span> <span class="n">clear</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">rw</span> <span class="err">←</span><span class="n">sum_div</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_range</span> <span class="n">at</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="o">(</span><span class="n">lt_trans</span> <span class="n">hi</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">lt_succ_self</span> <span class="n">n</span><span class="o">)),</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">pow_div</span><span class="o">,</span>
    <span class="n">congr&#39;</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="n">pow_div</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span><span class="n">add_div</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">div_eq_one_iff_eq</span><span class="o">,</span>
  <span class="n">swap</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span> <span class="c1">-- (sum univ (λ (j : fin n), x j ^ 2) + 1) ^ 2 ≠ 0</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="n">pow_two</span><span class="o">,</span> <span class="n">pow_two</span><span class="o">,</span> <span class="n">add_mul_self_eq</span><span class="o">,</span> <span class="n">add_mul_self_eq</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">neg_mul_neg</span><span class="o">,</span> <span class="n">mul_neg_one</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="n">repeat</span> <span class="o">{</span><span class="n">rw</span> <span class="err">←</span><span class="n">add_assoc</span><span class="o">},</span>
  <span class="n">congr&#39;</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_left_comm</span><span class="o">],</span>
  <span class="n">apply</span> <span class="n">congr_arg</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">add_neg_eq_of_eq_add</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_sum</span><span class="o">,</span> <span class="err">←</span><span class="n">sum_add_distrib</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">sum_univ_fin_eq_sum_range</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_range</span> <span class="n">at</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">dif_pos</span> <span class="n">hi</span><span class="o">,</span> <span class="n">dif_pos</span> <span class="n">hi</span><span class="o">],</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kn">end</span>
<span class="bp">⟩</span>
</pre></div>


<p>One sorry left: I need that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><msup><mi>X</mi><mn>2</mn></msup><mo>+</mo><msup><mi>Y</mi><mn>2</mn></msup><mo>≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">1+X^2+Y^2\not=0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> otherwise the result is false. Hang on...</p>

<a name="188477080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188477080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188477080">Patrick Massot (Feb 18 2020 at 18:24)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">x</span><span class="err">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">y</span><span class="err">^</span><span class="mi">2</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">pow_two_nonneg</span> <span class="n">x</span><span class="o">,</span> <span class="n">pow_two_nonneg</span> <span class="n">y</span><span class="o">]</span>
</pre></div>

<a name="188477108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188477108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188477108">Kevin Buzzard (Feb 18 2020 at 18:25)</a>:</h4>
<p>yeah but it's a sum over <code>fin n</code> really. I've done it, I'm just editing.</p>

<a name="188477140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188477140" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188477140">Patrick Massot (Feb 18 2020 at 18:25)</a>:</h4>
<p>I had read only the line after the code block...</p>

<a name="188477222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188477222" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188477222">Kevin Buzzard (Feb 18 2020 at 18:26)</a>:</h4>
<p>Aren't you proud of <code>sum_div</code>? I didn't need d non-zero :-) However I needed it later on anyway :-(</p>

<a name="188477361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188477361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188477361">Kevin Buzzard (Feb 18 2020 at 18:27)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>

<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fin_upgrade</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">val</span> <span class="o">:=</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="n">is_lt</span> <span class="o">:=</span> <span class="n">lt</span>
<span class="o">}</span>

<span class="kn">theorem</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image_val_univ_eq_range</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span> <span class="n">finset</span><span class="bp">.</span><span class="n">univ</span> <span class="bp">=</span> <span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">j</span><span class="o">,</span> <span class="c1">-- sigh</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">mem_range</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_image</span><span class="o">],</span>
  <span class="n">split</span><span class="o">,</span>
    <span class="n">rintro</span> <span class="bp">⟨⟨</span><span class="n">j</span><span class="o">,</span><span class="n">hj</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">hj</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">hj</span><span class="o">,</span>
  <span class="n">use</span> <span class="bp">⟨</span><span class="n">j</span><span class="o">,</span> <span class="n">hj</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span> <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_univ</span><span class="o">,</span> <span class="n">refl</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_univ_fin_eq_sum_range</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="n">finset</span><span class="bp">.</span><span class="n">univ</span> <span class="n">f</span> <span class="bp">=</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">set</span> <span class="n">F</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">with</span> <span class="n">hF</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">F</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">ext</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">hF</span><span class="o">,</span>
    <span class="k">show</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">dite</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">),</span> <span class="n">f</span> <span class="bp">⟨</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">),</span> <span class="mi">0</span><span class="o">),</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="n">i</span><span class="bp">.</span><span class="n">is_lt</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">i</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span><span class="n">finset</span><span class="bp">.</span><span class="n">sum_image</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">congr&#39;</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image_val_univ_eq_range</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">intros</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">fin</span><span class="bp">.</span><span class="n">eq_of_veq</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_div</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="n">s</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">/</span> <span class="n">d</span><span class="o">)</span> <span class="bp">=</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="n">s</span> <span class="n">f</span> <span class="bp">/</span> <span class="n">d</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">by_cases</span> <span class="n">hd</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hd</span><span class="o">,</span> <span class="n">div_zero</span><span class="o">],</span>
    <span class="n">convert</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_const_zero</span><span class="o">,</span>
    <span class="n">ext</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">div_zero</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">div_eq_mul_inv</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_mul</span><span class="o">],</span>
  <span class="n">congr&#39;</span><span class="o">,</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">unit_sphere</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">x</span> <span class="o">:</span> <span class="n">euclidean_space</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">//</span> <span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">i</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">}</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="n">def</span> <span class="n">stereographic_projection_inv_north</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">euclidean_space</span> <span class="n">n</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">unit_sphere</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span><span class="n">x</span><span class="o">,</span> <span class="bp">⟨λ</span><span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)),</span> <span class="o">(</span><span class="k">if</span> <span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span>
    <span class="k">then</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="o">(</span><span class="n">fin_upgrade</span> <span class="n">n</span> <span class="n">i</span> <span class="n">lt</span><span class="o">))</span> <span class="bp">/</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span>
    <span class="k">else</span> <span class="o">(((</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span><span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="n">j</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))),</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">sum_univ_fin_eq_sum_range</span><span class="o">,</span> <span class="n">sum_range_succ</span><span class="o">,</span> <span class="n">dif_pos</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">lt_succ_self</span> <span class="n">n</span><span class="o">),</span> <span class="n">dif_neg</span> <span class="o">(</span><span class="n">lt_irrefl</span> <span class="n">n</span><span class="o">)],</span>
  <span class="n">suffices</span> <span class="o">:</span> <span class="o">((</span><span class="n">sum</span> <span class="n">univ</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span> <span class="n">j</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">sum</span> <span class="n">univ</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span> <span class="n">j</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">+</span>
    <span class="o">(</span><span class="n">sum</span> <span class="o">(</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span>  <span class="k">else</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">sum</span> <span class="n">univ</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">),</span> <span class="n">x</span> <span class="n">j</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span><span class="o">)</span>
    <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">convert</span> <span class="n">this</span> <span class="kn">using</span> <span class="mi">2</span><span class="o">,</span> <span class="n">clear</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">rw</span> <span class="err">←</span><span class="n">sum_div</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_range</span> <span class="n">at</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="o">(</span><span class="n">lt_trans</span> <span class="n">hi</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">lt_succ_self</span> <span class="n">n</span><span class="o">)),</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">dif_pos</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">pow_div</span><span class="o">,</span>
    <span class="n">congr&#39;</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="n">pow_div</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span><span class="n">add_div</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">div_eq_one_iff_eq</span><span class="o">,</span>
  <span class="n">swap</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">ne_of_gt</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">pow_pos</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">lt_of_lt_of_le</span> <span class="n">zero_lt_one</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">le_add_of_nonneg_left&#39;</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">sum_nonneg</span><span class="o">,</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">pow_two</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">mul_self_nonneg</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="n">pow_two</span><span class="o">,</span> <span class="n">pow_two</span><span class="o">,</span> <span class="n">add_mul_self_eq</span><span class="o">,</span> <span class="n">add_mul_self_eq</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">neg_mul_neg</span><span class="o">,</span> <span class="n">mul_neg_one</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="n">repeat</span> <span class="o">{</span><span class="n">rw</span> <span class="err">←</span><span class="n">add_assoc</span><span class="o">},</span>
  <span class="n">congr&#39;</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_left_comm</span><span class="o">],</span>
  <span class="n">apply</span> <span class="n">congr_arg</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">add_neg_eq_of_eq_add</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_sum</span><span class="o">,</span> <span class="err">←</span><span class="n">sum_add_distrib</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">sum_univ_fin_eq_sum_range</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_range</span> <span class="n">at</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">dif_pos</span> <span class="n">hi</span><span class="o">,</span> <span class="n">dif_pos</span> <span class="n">hi</span><span class="o">],</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kn">end</span>
<span class="bp">⟩</span>
</pre></div>


<p>It looks to me like there are a couple of holes in the finset library, which made life a bit harder.</p>

<a name="188477600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188477600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188477600">Kevin Buzzard (Feb 18 2020 at 18:30)</a>:</h4>
<p>My Lean is rather amateurish at times, but I understand the system well enough to be able to muddle through. It would not surprise me at all if someone who knows how to code could halve the size of this code. There used to be something called the <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> ratio, where the game was that you wrote some code, and then Mario rewrote it, and your ratio was the number of lines of your code divided by the number of lines of his code. We mathematicians used to work on trying to get the ratio down below 5.</p>

<a name="188479134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188479134" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188479134">Patrick Massot (Feb 18 2020 at 18:46)</a>:</h4>
<p>I haven't read the proof carefully, but clearly this is the opportunity to get some new sum lemmas. Maybe also use <code>indicator</code>?</p>

<a name="188486798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188486798" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188486798">Sebastien Gouezel (Feb 18 2020 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/spheres/near/188477361" title="#narrow/stream/113489-new-members/topic/spheres/near/188477361">said</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">fin_upgrade</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">lt</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">val</span> <span class="o">:=</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="n">is_lt</span> <span class="o">:=</span> <span class="n">lt</span>
<span class="o">}</span>
</pre></div>


</blockquote>
<p>This is called <code>fin.cast_lt</code>, I think.</p>

<a name="188497593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188497593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188497593">Greg Langmead (Feb 18 2020 at 22:23)</a>:</h4>
<p>Wow this is fantastic, huge thanks Kevin! I'll digest this post haste. <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> that fin_upgrade was mine, I didn't find <code>fin.cast_lt</code>. That's my ongoing problem. I neither know what steps Lean wants from me, nor how to find them when I happen to understand.</p>

<a name="188498448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188498448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188498448">Kevin Buzzard (Feb 18 2020 at 22:35)</a>:</h4>
<p>The rule is this: if it looks basic, it's there already. It might be heavily disguised (e.g. earlier today I was asking how to take a finite union of finite sets and it turns out that the answer has something to do with monads) but it will be there. The trick is working out what the right question is. If it's there, it might well have a fabulous API (e.g. checking that making each set bigger makes the union bigger might be just some crazy one line incomprehensible monad or filter proof, but it might also have a sensible name). </p>
<p>After a while you just realise exactly what the computer is asking you to do, and you become a precision user of the tools which are available to you. I just learnt by doing a wide range of mathematics at all levels and running into myriads of different problems and having them all solved for me by others here.</p>

<a name="188498618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188498618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188498618">Kevin Buzzard (Feb 18 2020 at 22:38)</a>:</h4>
<p>That code I posted earlier took me a couple of hours to write, but I never really got stuck. It would be great if a CS person could review it because then you might also be able to witness how the experts can write it in half the space and in a way which sometimes can be far far harder to understand.</p>

<a name="188498635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188498635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188498635">Kevin Buzzard (Feb 18 2020 at 22:38)</a>:</h4>
<p>All my proofs are in tactic mode and you can just step through them.</p>

<a name="188498791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/spheres/near/188498791" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/99675spheres.html#188498791">Kevin Buzzard (Feb 18 2020 at 22:40)</a>:</h4>
<p>You can even step through the rewrites term by term, by clicking near the commas.</p>


{% endraw %}

{% include archive_update.html %}