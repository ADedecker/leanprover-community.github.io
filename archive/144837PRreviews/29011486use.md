---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/144837PRreviews/29011486use.html
---

## Stream: [PR reviews](index.html)
### Topic: [#486 use](29011486use.html)

---


{% raw %}
#### [ Rob Lewis (Nov 26 2018 at 15:23)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148369750):
<p>Okay, I had a few moments to think about this. Here's a short solution using <code>fconstructor</code> that will handle multi-argument constructors and nested single-arg constructors together, like <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> wanted. I'm not quite sure about the failure conditions though. This will fail if you give it too many arguments, which I think is correct. It will succeed if you give it too few arguments, potentially leaving you in the middle of a partially applied multi-arg constructor. Reasonable?</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">use</span> <span class="o">:</span> <span class="n">list</span> <span class="n">pexpr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">skip</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">h</span><span class="bp">::</span><span class="n">t</span><span class="o">)</span> <span class="o">:=</span> <span class="o">((</span><span class="n">focus1</span> <span class="o">(</span><span class="n">refine</span> <span class="n">h</span> <span class="bp">&gt;&gt;</span> <span class="n">done</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span> <span class="o">(</span><span class="n">fconstructor</span> <span class="bp">&gt;&gt;</span> <span class="n">focus1</span> <span class="o">(</span><span class="n">refine</span> <span class="n">h</span> <span class="bp">&gt;&gt;</span> <span class="n">done</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span>
    <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;failed to instantiate goal with {h}&quot;</span><span class="o">)</span> <span class="bp">&gt;&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">use</span> <span class="n">t</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">use&#39;</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">interactive</span><span class="bp">.</span><span class="n">parse</span> <span class="n">interactive</span><span class="bp">.</span><span class="n">types</span><span class="bp">.</span><span class="n">pexpr_list_or_texpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">tactic</span><span class="bp">.</span><span class="n">use</span> <span class="n">l</span> <span class="bp">&gt;&gt;</span> <span class="n">try</span> <span class="n">reflexivity</span>

<span class="kn">inductive</span> <span class="n">foo</span>
<span class="bp">|</span> <span class="n">mk</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">bool</span> <span class="bp">×</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">foo</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">use&#39;</span> <span class="o">[</span><span class="mi">100</span><span class="o">,</span> <span class="n">tt</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">use&#39;</span> <span class="o">[</span><span class="mi">100</span><span class="o">,</span> <span class="n">tt</span><span class="o">,</span> <span class="n">tt</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">failed to instantiate goal with tt</span>
<span class="cm">state:</span>
<span class="cm">2 goals</span>
<span class="cm">⊢ ℕ</span>

<span class="cm">⊢ ℕ</span>
<span class="cm">-/</span>
</pre></div>

#### [ Mario Carneiro (Nov 26 2018 at 15:24)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148369834):
<p>I like this behavior</p>

#### [ Rob Lewis (Nov 26 2018 at 15:25)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148369891):
<p>Hmm, the interactive wrapper should probably start with a <code>focus1</code>, otherwise it will try to touch later goals if you give it too many arguments.</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:27)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370027):
<p>why does it end with <code>try reflexivity</code>?</p>

#### [ Patrick Massot (Nov 26 2018 at 15:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370039):
<p>Trying reflexivity is always good</p>

#### [ Rob Lewis (Nov 26 2018 at 15:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370097):
<p>Because Patrick requested it in the original discussion and it doesn't really hurt.</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370104):
<p>if it's just exploratory it should be <code>reflexivity reducible</code></p>

#### [ Mario Carneiro (Nov 26 2018 at 15:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370112):
<p>like in <code>rw</code></p>

#### [ Patrick Massot (Nov 26 2018 at 15:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370123):
<p>What does this mean?</p>

#### [ Rob Lewis (Nov 26 2018 at 15:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370129):
<p>Yeah, good point.</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:29)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370146):
<p>that it won't try super hard when it's not appropriate</p>

#### [ Patrick Massot (Nov 26 2018 at 15:29)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370185):
<p>Ok, let's see how proofs will break then</p>

#### [ Patrick Massot (Nov 26 2018 at 15:29)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370189):
<p>(hopefully none)</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:30)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370241):
<p>worst case you have to <code>use x; refl</code></p>

#### [ Patrick Massot (Nov 26 2018 at 15:30)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370276):
<p>this is what I hoped to avoid, but it may be too costly</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:31)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370307):
<p>plus <code>eq</code> is itself a single arg constructor, so can't you add more things to the <code>use</code> to trigger it?</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:32)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370346):
<p>it's not clear to me that we always follow a <code>use</code> by a <code>refl</code> though</p>

#### [ Rob Lewis (Nov 26 2018 at 15:32)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370348):
<p>The only example from the old discussion that breaks is this one, and it works if you add <code>rfl</code> to the use.</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">=</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">use&#39;</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="n">rfl</span><span class="o">]</span>
</pre></div>

#### [ Mario Carneiro (Nov 26 2018 at 15:32)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370408):
<p>it seems like only somewhat contrived examples... like that one... have this characteristic</p>

#### [ Patrick Massot (Nov 26 2018 at 15:33)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370447):
<p>I'd be happy to try without the strong reflexivity try</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:33)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370463):
<p>usually it's like <code>\ex a b c, x = f a b c /\ properties of a, b,c</code></p>

#### [ Mario Carneiro (Nov 26 2018 at 15:35)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370658):
<p>I guess if the equality is the last thing it could still work, provided you don't want the properties as subgoals</p>

#### [ Rob Lewis (Nov 26 2018 at 15:36)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148370743):
<p>I don't think trying <code>reflexivity reducible</code> at the end hurts, and (maybe only very) occasionally it leads to some nice short proofs. But I'm not committed to keeping it.</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:40)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371039):
<p>I think it's fine to keep, I just doubt it will help</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:42)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371145):
<p>is there a low attempting version of <code>trivial</code>? I think finishing with some zero arg constructors, including <code>eq.refl</code> and <code>trivial</code>, could be very helpful in this context</p>

#### [ Johan Commelin (Nov 26 2018 at 15:43)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371172):
<p>I think mathematicians find ending a proof with <code>refl</code> ugly. It would be nice if we could just write <code>.</code> instead of <code>rfl</code>/<code>refl</code>, that would be nice. But of course I'm whining about icing on the cake right now.</p>

#### [ Johan Commelin (Nov 26 2018 at 15:43)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371193):
<p>And maybe <code>end</code> should always attempt to close all remaining goals by <code>refl</code> or some similar cheap automation.</p>

#### [ Johan Commelin (Nov 26 2018 at 15:43)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371205):
<p>Then you can just stop proving after giving the essential ideas.</p>

#### [ Rob Lewis (Nov 26 2018 at 15:44)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371247):
<p>Maybe we should define <code>triv'</code> that uses <code>exact reducible</code> instead of just <code>exact</code>?</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:44)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371279):
<p>does <code>exact</code> have a reducibility setting?</p>

#### [ Rob Lewis (Nov 26 2018 at 15:45)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371295):
<p>Yeah.</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:45)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371332):
<p>that makes sense</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:45)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371347):
<p>does <code>triv</code> exist? It should be an alias for <code>trivial</code></p>

#### [ Mario Carneiro (Nov 26 2018 at 15:46)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371402):
<p>if not we can nab it for ourselves</p>

#### [ Rob Lewis (Nov 26 2018 at 15:46)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371403):
<p><code>tactic.triv</code> is in core.</p>

#### [ Rob Lewis (Nov 26 2018 at 15:46)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371417):
<p><code>meta def triv : tactic unit := mk_const `trivial &gt;&gt;= exact</code></p>

#### [ Mario Carneiro (Nov 26 2018 at 15:46)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371424):
<p>no interactive though?</p>

#### [ Rob Lewis (Nov 26 2018 at 15:47)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371450):
<p>Oh, no.</p>

#### [ Mario Carneiro (Nov 26 2018 at 15:47)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371455):
<p>boom</p>

#### [ Rob Lewis (Nov 26 2018 at 15:49)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371578):
<p>Okay, so should we make <code>tactic.interactive.triv</code> a version of <code>tactic.interactive.trivial</code> that takes a reducibility parameter? Or make it explicitly the low cost one?</p>

#### [ Rob Lewis (Nov 26 2018 at 15:49)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371587):
<p>That kind of makes sense, shorter name = don't try as hard.</p>

#### [ Johan Commelin (Nov 26 2018 at 15:51)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371710):
<p>/me wonders what <code>trivia</code> will do <span class="emoji emoji-1f914" title="thinking">:thinking:</span></p>

#### [ Rob Lewis (Nov 26 2018 at 15:53)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148371816):
<p>BTW, a better version of <code>tactic.use</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">use</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">pexpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">focus1</span> <span class="err">$</span> <span class="n">l</span><span class="bp">.</span><span class="n">mmap&#39;</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">h</span><span class="o">,</span>
  <span class="o">(</span><span class="n">focus1</span> <span class="o">(</span><span class="n">refine</span> <span class="n">h</span> <span class="bp">&gt;&gt;</span> <span class="n">done</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span> <span class="o">(</span><span class="n">fconstructor</span> <span class="bp">&gt;&gt;</span> <span class="n">focus1</span> <span class="o">(</span><span class="n">refine</span> <span class="n">h</span> <span class="bp">&gt;&gt;</span> <span class="n">done</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span>
    <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;failed to instantiate goal with {h}&quot;</span>
</pre></div>

#### [ Scott Morrison (Nov 26 2018 at 19:47)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148388302):
<blockquote>
<p>And maybe <code>end</code> should always attempt to close all remaining goals by <code>refl</code> or some similar cheap automation.</p>
</blockquote>
<p>You meant <code>obviously</code> there, didn't you?  :-)</p>

#### [ Johan Commelin (Nov 26 2018 at 20:08)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148389884):
<p>Well, <code>obviously</code> obviously isn't always cheap.</p>

#### [ Rob Lewis (Nov 27 2018 at 09:59)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23486%20use/near/148625379):
<p>I got distracted yesterday afternoon and just came back to this. The logic of that last version wasn't quite right when things were nested. This is better. <a href="https://github.com/leanprover/mathlib/pull/497" target="_blank" title="https://github.com/leanprover/mathlib/pull/497">https://github.com/leanprover/mathlib/pull/497</a></p>


{% endraw %}
