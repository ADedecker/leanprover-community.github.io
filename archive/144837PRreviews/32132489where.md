---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/144837PRreviews/32132489where.html
---

## Stream: [PR reviews](https://leanprover-community.github.io/archive/144837PRreviews/index.html)
### Topic: [#489 where](https://leanprover-community.github.io/archive/144837PRreviews/32132489where.html)

---

<base href="https://leanprover.zulipchat.com">
{% raw %}
#### [ Johan Commelin (Nov 24 2018 at 06:15)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148263248):
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> I tried your stuff out. It is really helpful. But I had some further questions, which I posted as feedback to the PR.</p>

#### [ Keeley Hoek (Nov 24 2018 at 06:19)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148263358):
<p>Yep, silly mistake on my part<br>
I'll fix it right up</p>

#### [ Keeley Hoek (Nov 24 2018 at 06:19)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148263361):
<p>And sure, I'll do the namespace thing<br>
Do you want a few newlines and an <code>end</code>, too?</p>

#### [ Johan Commelin (Nov 24 2018 at 06:36)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148263858):
<p>Yeah, I think that would be nice. But it isn't crucial. I can imagine people would think that it clutters the info message. And autocompletion will make typing the <code>end</code> very easy.</p>

#### [ Keeley Hoek (Nov 24 2018 at 09:33)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148268618):
<p>A new-and-improved version is sitting atop <code>where-cmd</code>!</p>

#### [ Keeley Hoek (Nov 24 2018 at 09:35)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148268677):
<p>(please let me know if you find anything else wrong with it, Johan)</p>

#### [ Johan Commelin (Nov 24 2018 at 09:38)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148268771):
<p>The only thing that is wrong is that you seem to have changed the branch name</p>

#### [ Johan Commelin (Nov 24 2018 at 09:41)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148268836):
<p>Hurray, I now get</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">nat</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="bp">‚Ñï</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">‚Ñï</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">‚Ñ§</span><span class="o">)</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="bp">‚Ñï</span><span class="o">}</span>



<span class="kn">end</span> <span class="n">nat</span>
</pre></div>


<p>I notice two things:</p>
<ul>
<li>I get all the variables! Not only those that have been used. That is good!</li>
<li>The order seems a bit random. The original variables line was <code>variables {m n k : ‚Ñï} (x : ‚Ñ§)</code>.</li>
</ul>

#### [ Keeley Hoek (Nov 24 2018 at 09:51)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148269099):
<p>Woo! That first point is by luck---in some other file which is includes and has the same namespace, the same variable name appears as that which is not used in the file you are in (so its not 100% reliable)</p>

#### [ Keeley Hoek (Nov 24 2018 at 09:51)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148269100):
<p>The second point is hard, since there is no way to know the real order they are in.</p>

#### [ Keeley Hoek (Nov 24 2018 at 09:51)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148269101):
<p>One thing I could do is group by type? How about I do that</p>

#### [ Keeley Hoek (Nov 24 2018 at 12:05)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148273173):
<p>Ok, it's working now</p>

#### [ Keeley Hoek (Nov 24 2018 at 12:06)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148273231):
<p>It collects together variable of the same binders and type, and sorts by binders, implicit first (hopefully this is closest to the most likely intended order)</p>

#### [ Keeley Hoek (Nov 24 2018 at 12:07)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148273248):
<p>So e.g. above you should get</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">nat</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="bp">‚Ñï</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">‚Ñ§</span><span class="o">)</span>



<span class="kn">end</span> <span class="n">nat</span>
</pre></div>

#### [ Johan Commelin (Nov 27 2018 at 14:09)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636438):
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> Is it within reach to also figure out universes?<br>
I now get something like this:</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">}</span> <span class="o">{</span><span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">}</span> <span class="o">[</span><span class="err">ùíû</span> <span class="o">:</span> <span class="n">category</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="err">ùí¶</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">J</span><span class="o">]</span>
<span class="n">include</span> <span class="n">C</span> <span class="err">ùíû</span> <span class="n">K</span> <span class="err">ùí¶</span>



<span class="kn">end</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span>
</pre></div>

#### [ Johan Commelin (Nov 27 2018 at 14:10)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636489):
<p>That's already very helpful, and I have no idea how hard it would be to replace those <code>?</code>s with <code>u</code>s and <code>v</code>s...</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:11)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636533):
<p>One time when this came up for me was a variable has type <code>Type*</code>, and I don't know what the asterisk syntax means!</p>
<p>But I didn't realize it didn't work for any universes whatever. Would you be able to point me directly to the file you obtained that in?</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:12)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636590):
<p>I'll see if it's possible (the answer is almost certainly, but I'll have to have a look/hope its easy)</p>

#### [ Johan Commelin (Nov 27 2018 at 14:12)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636603):
<p>This was on line 702 in some version of <code>limits.lean</code>.</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:13)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636616):
<p>In mainline?</p>

#### [ Johan Commelin (Nov 27 2018 at 14:13)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636634):
<p><a href="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/limits/limits.lean#L702" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/limits/limits.lean#L702">https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/limits/limits.lean#L702</a></p>

#### [ Johan Commelin (Nov 27 2018 at 14:13)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636636):
<p>No, it's an older version</p>

#### [ Johan Commelin (Nov 27 2018 at 14:14)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636646):
<p>Not the current one that Scott and Reid are trying to get merged.</p>

#### [ Johan Commelin (Nov 27 2018 at 14:14)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636688):
<p>But it shouldn't be far off.</p>

#### [ Mario Carneiro (Nov 27 2018 at 14:14)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636702):
<p>how does this PR work btw?</p>

#### [ Mario Carneiro (Nov 27 2018 at 14:14)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636718):
<p>it's really cool but I was under the impression it's not accessible information</p>

#### [ Patrick Massot (Nov 27 2018 at 14:15)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636732):
<p>It looks like a life changing command</p>

#### [ Mario Carneiro (Nov 27 2018 at 14:15)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636745):
<p>is there a tactic version? This is also useful under the hood I think</p>

#### [ Johan Commelin (Nov 27 2018 at 14:16)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636834):
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> Aah, another request. Can you figure out which namespaces are open?</p>

#### [ Johan Commelin (Nov 27 2018 at 14:16)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636839):
<p>And include a line <code>open foo bar</code> in the output?</p>

#### [ Johan Commelin (Nov 27 2018 at 14:16)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636846):
<p>Maybe this is impossible, but it would be marvellous</p>

#### [ Patrick Massot (Nov 27 2018 at 14:17)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636872):
<p>Keeley, since you are into these kind of things, how much work would it be for you to write a script that goes through mathlib an report every definition of lemma whose parameters contains two instances for the same type class? This happens sometimes when one instance comes from a variable and the other one is explicitly in the declaration</p>

#### [ Rob Lewis (Nov 27 2018 at 14:19)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148636994):
<p>I second Mario's question! I don't understand what this is doing, but it's super nice.</p>

#### [ Johan Commelin (Nov 27 2018 at 14:20)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637095):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110596">@Rob Lewis</span> What do you mean with a "tactic version"? This is in <code>tactic.where</code>. Does that answer the question?</p>

#### [ Johan Commelin (Nov 27 2018 at 14:20)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637107):
<p>Or do you want an interactive tactic <code>where</code> that can be called in a <code>begin ... end</code>-block?</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:21)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637165):
<p>Mario you're going to be disappointed in me :D (but the only way I know, sorry)<br>
Unfortunately you need access to the parser monad<br>
But, you can cheat and get this using a parser argument to an interactive tactic</p>
<p>But how it works:<br>
Ok so for namespaces <code>tactic.open_namespaces</code> (I think) gives you the namespace as the first entry last time I read the source<br>
But it doesn't work when no namespace is open, so we just do something general: we emit a fake definition which is equal to unit <code>()</code> using <code>with_input command_like</code>, which respects namespaces (unlike <code>add_decl</code> and friends). We then resolve the name and see what happened to the prefix.</p>
<p>For includes: we look at the fake definition we generated and inspect its type---the includes will be all in there.</p>
<p>For variables: this one is a bit desperate, but it's the best we can do; we examine all definitions in the current namespace (there are usually on the order of hundreds, so this is very fast) and read all of the variable names they use in their pi binders. We then emit definitions <code>private def user__.xxxx.xxxx.user__ := let {n} := {n} in ()</code> for every such name <code>n</code> we found. If this is a syntax error then we detect it and discard the name. Otherwise, it must be a valid variable, and we report it.</p>
<p>We then sort the variables/includes by type and then coalesce those with the same binder, and then report the result</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:22)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637168):
<p>Yep Johan that's really easy, and built-in to lean<br>
I think it might have some extras, though, I should check what the command actually returns</p>

#### [ Rob Lewis (Nov 27 2018 at 14:22)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637205):
<p>The only output it gives right now is via trace, it can be nice to have this returned in a format where you can use it in other tactics. So something that produces this same information but with type <code>tactic (list name)</code> or whatever.</p>

#### [ Johan Commelin (Nov 27 2018 at 14:22)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637237):
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Your crawler can call <code>#print</code> for every statement in mathlib, right? Because then we could do the rest with some regexes.</p>

#### [ Patrick Massot (Nov 27 2018 at 14:24)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637341):
<p>I think using Lean metaprogramming is always better than regex. In theory I should be able to do it, but I'm not lazy and busy</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:24)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637373):
<p>Rob since everything except namespaces (and namespaces to work properly) need to access <code>lean.parser</code>, I exposed this functionality as best I could to the parser monad at the bottom of <code>where.lean</code>. The idea is after your tactic's arguments you put a <code>(ns : parse get_namespaces)</code> for example, and <code>ns</code> will evaluate to a <code>name</code> which is the current namespace. That way you still get access into the parser</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:24)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637378):
<p>I can definitely do that Patrick</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:26)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637484):
<p>Oh, actually there is this one funny thing: I don't think you can programmically get lean to import all of the files in mathlib without externally setting that up first. So if you actually wanted a command which finds all of those double-ups it would take a bit of programming work (I would have to write a file, then spawn a new lean process which imports every defn in mathlib and computes the answer, and then reports it back)</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:29)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637650):
<p>By the way after fixing Puzzle <a href="https://github.com/leanprover/mathlib/issues/3" target="_blank" title="https://github.com/leanprover/mathlib/issues/3">#3</a> I finally found a way to get tactic block caching to work by just doing an import<br>
Almost all of <code>lean-category-theory</code> is serialisable now<br>
A bit of yuck work with expanding string macros (which are atomic from the lean perspective) is needed, and then it needs to be made as fast as possible</p>

#### [ Johannes H√∂lzl (Nov 27 2018 at 14:34)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148637867):
<p>I have a not-even-1/2 finished import parser for Lean in Rust: <a href="https://github.com/johoelzl/lean-import-parser" target="_blank" title="https://github.com/johoelzl/lean-import-parser">https://github.com/johoelzl/lean-import-parser</a> it's more of a Rust experiment. But it can parse Lean files and produce a list of all non-prelude Lean files. But I guess also Patrick's visualization tool does something like this?</p>

#### [ Patrick Massot (Nov 27 2018 at 14:36)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638015):
<p>What you mean? Listing lean files can be done from bash, right?</p>

#### [ Johannes H√∂lzl (Nov 27 2018 at 14:40)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638258):
<p>Oh right, I thought it was about finding out the import structure...</p>

#### [ Patrick Massot (Nov 27 2018 at 14:42)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638329):
<p>Ok, that makes sense.</p>

#### [ Patrick Massot (Nov 27 2018 at 14:42)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638341):
<p>In principle my thing can find the import structure, but I never wrote that bit. It should be easy</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:46)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638532):
<p>Does anyone know why this snippet</p>
<div class="codehilite"><pre><span></span><span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">trace_opens</span> <span class="o">(</span><span class="n">ns</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">opens</span> <span class="err">‚Üê</span> <span class="n">open_namespaces</span><span class="o">,</span>
   <span class="k">let</span> <span class="n">l</span> <span class="o">:=</span> <span class="k">match</span> <span class="n">ns</span> <span class="k">with</span>
   <span class="bp">|</span> <span class="n">name</span><span class="bp">.</span><span class="n">anonymous</span> <span class="o">:=</span> <span class="n">opens</span>
   <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">opens</span><span class="bp">.</span><span class="n">tail</span>
   <span class="kn">end</span><span class="o">,</span>
   <span class="k">let</span> <span class="n">str</span> <span class="o">:=</span> <span class="s2">&quot; &quot;</span><span class="bp">.</span><span class="n">intercalate</span> <span class="err">$</span> <span class="n">l</span><span class="bp">.</span><span class="n">map</span> <span class="n">to_string</span><span class="o">,</span>
   <span class="k">if</span> <span class="n">l</span><span class="bp">.</span><span class="n">length</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">skip</span>
   <span class="k">else</span> <span class="n">trace</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;opens {str}&quot;</span>
</pre></div>


<p>fails to compile, not being able to synthesise a typeclass for <code>‚ä¢ decidable (list.length l = 0)</code> !?!?!</p>

#### [ Patrick Massot (Nov 27 2018 at 14:47)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638555):
<p>What if you replace that test with testing for the empty list?</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:47)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638571):
<p>It works fine! strangest thing</p>

#### [ Patrick Massot (Nov 27 2018 at 14:48)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638637):
<p>It would be nice to have an answer to your question, but at least you can go on</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:50)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638748):
<p>Yeah following the convention of the other functions I split that one it half, and it just worked too<br>
very weird</p>

#### [ Patrick Massot (Nov 27 2018 at 14:52)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148638842):
<p>It's actually pretty common that, depending on the intricacies of the elaboration process, Lean sometimes tries to solve type class instances too soon and then forgets to <code>apply_instance</code> when it would be needed</p>

#### [ Keeley Hoek (Nov 27 2018 at 14:59)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639156):
<p>ok</p>

#### [ Mario Carneiro (Nov 27 2018 at 15:00)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639220):
<p>I think it has to do with the way <code>match</code> creates a new definition</p>

#### [ Mario Carneiro (Nov 27 2018 at 15:01)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639325):
<p>if you replace the definition of <code>l</code> with something that doesn't use <code>match</code> it works</p>

#### [ Johannes H√∂lzl (Nov 27 2018 at 15:02)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639399):
<p>That's the trace:</p>
<div class="codehilite"><pre><span></span>[class_instances] (0) ?x_0 : decidable (@list.length name l = 0) := nat.decidable_eq ?x_116 ?x_117
[type_context.is_def_eq_detail] [1]: decidable (@list.length name l = 0) =?= decidable (?x_116 = ?x_117)
[type_context.is_def_eq_detail] [2]: @list.length name l = 0 =?= ?x_116 = ?x_117
[type_context.is_def_eq_detail] process_assignment ?x_116 := @list.length name l
[type_context.is_def_eq_detail] failed to assign ?x_116 to
@list.length name l
value contains local declaration l which is not in the scope of the metavariable
[type_context.is_def_eq_detail] on failure: @list.length name l = 0 =?= ?x_116 = ?x_117
[type_context.is_def_eq_detail] on failure: decidable (@list.length name l = 0) =?= decidable (?x_116 = ?x_117)
[type_context.is_def_eq] decidable (@list.length name l = 0) =?= decidable (?x_116 = ?x_117) ... failed  (approximate mode)
failed is_def_eq
</pre></div>

#### [ Johannes H√∂lzl (Nov 27 2018 at 15:02)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639419):
<p><code>value contains local declaration l which is not in the scope of the metavariable</code> is it</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:10)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639849):
<p>Actually <span class="user-mention" data-user-id="112680">@Johan Commelin</span>, I don't know if lean stores universe variable names anywhere in the type of functions which use them. I can even think of a way to figure out which is which is we know the possible pool of names, but not for arbitrary names.<br>
I guess it could check for <code>u</code>, <code>v</code>, <code>w</code>, <code>u\1</code>, <code>u\2</code>, <code>u\3</code>, etc and then give up if it's not found. It will take a bit of programming work though, and it's quite late for me!</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:11)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639866):
<p>Probably that would still be pretty handy though, even if the actual search is a bit lame</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:11)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639872):
<p>Don't want to have to scroll around to figure out the universe labels</p>

#### [ Johan Commelin (Nov 27 2018 at 15:12)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148639932):
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> What you've done so far is already incredible! I don't want to push you... Thanks a lot!</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:14)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148640071):
<p>Great! By the way, I did the <code>open</code> thing and I've just pushed it (I pushed a slightly worse version which can have duplicates and doesn't delete namespaces if they aren't necessary a few minutes ago)</p>

#### [ Johannes H√∂lzl (Nov 27 2018 at 15:18)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148640243):
<p>I guess you can access the universe names:</p>
<div class="codehilite"><pre><span></span><span class="kn">open</span> <span class="n">tactic</span>

<span class="n">run_cmd</span> <span class="n">do</span>
  <span class="n">s</span> <span class="err">‚Üê</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">set</span><span class="o">,</span>
  <span class="n">trace</span> <span class="n">s</span><span class="bp">.</span><span class="n">univ_params</span>
</pre></div>


<p>outputs <code>[u]</code></p>

#### [ Johannes H√∂lzl (Nov 27 2018 at 15:18)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148640293):
<div class="codehilite"><pre><span></span><span class="kn">universe</span> <span class="n">test_univ</span>

<span class="n">def</span> <span class="n">test</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">test_univ</span> <span class="o">:=</span> <span class="n">punit</span>

<span class="n">run_cmd</span> <span class="n">do</span>
  <span class="n">s</span> <span class="err">‚Üê</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">test</span><span class="o">,</span>
  <span class="n">trace</span> <span class="n">s</span><span class="bp">.</span><span class="n">univ_params</span>
</pre></div>


<p>also works</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:23)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148640603):
<p>Sweet! Cheers Johannes</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:35)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148641334):
<p>using that call I can even do one better with <code>.type</code> outright</p>

#### [ Keeley Hoek (Nov 27 2018 at 15:35)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148641341):
<p>(pushed)</p>

#### [ Johan Commelin (Nov 30 2018 at 14:27)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148860885):
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> What's the status with this one. Did you still want to add things? (universe variables?) Or is it good to go?</p>

#### [ Keeley Hoek (Nov 30 2018 at 15:40)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/148865034):
<p>Oh no I pushed the universe variable fix thanks to Johannes they day I wrote that last comment^<br>
So all the features are in there now<br>
It does the instance thing too</p>

#### [ Johan Commelin (Dec 20 2018 at 09:50)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152242446):
<p>This is now merged! <span class="emoji emoji-1f389" title="tada">:tada:</span></p>

#### [ Mario Carneiro (Dec 20 2018 at 10:03)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152242972):
<p>By the way, one thing that the olean viewer could theoretically support is complete and correct answers to this question. Unfortunately since it's looking at oleans it is one step behind lean; you have to save your file and <code>--make</code> it before you can get the right answer</p>

#### [ Kevin Buzzard (Dec 20 2018 at 14:48)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152257114):
<p>Can this be a button on VS code?</p>

#### [ Kevin Buzzard (Dec 20 2018 at 14:49)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152257134):
<p>An option when you right click or something</p>

#### [ Keeley Hoek (Dec 22 2018 at 01:34)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152368037):
<p>This isn't meant to be at dig at Mario's call in the GitHub pull request, but it was decided not to be included in tactic.interactive by default and so unless the vscode extension is actually changed (an amount of work unknown to me) I can't make this happen.</p>
<p>And if it were instead to be imported by default I couldn't offer right-click support either, but I could add a hole command? Maybe we could all have a make-hole keyboard shortcut?</p>

#### [ Johan Commelin (Dec 22 2018 at 05:27)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152374778):
<p>Ooh, I thought that in the end Mario was fine with including it in <code>tactic.interactive</code>...</p>

#### [ Mario Carneiro (Dec 22 2018 at 05:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152374819):
<p>right, sorry I wasn't clear about that</p>

#### [ Mario Carneiro (Dec 22 2018 at 05:28)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152374822):
<p>I forgot that it hadn't been put back before the merge</p>

#### [ Johan Commelin (Dec 22 2018 at 05:35)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/152374979):
<p>No worries... PRs are cheap (-;</p>

#### [ Johan Commelin (Jan 17 2019 at 11:16)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/155323910):
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> This seems to be a little bug in <code>#where</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">open</span> <span class="n">category_theory</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">D</span> <span class="err">‚•§</span> <span class="n">C</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">C</span> <span class="err">‚•§</span> <span class="n">D</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÇ</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">}</span> <span class="o">[</span><span class="err">ùíü</span> <span class="o">:</span> <span class="n">category</span> <span class="n">D</span><span class="o">]</span> <span class="o">[</span><span class="err">ùíû</span> <span class="o">:</span> <span class="n">category</span> <span class="n">C</span><span class="o">]</span>
<span class="n">include</span> <span class="n">C</span> <span class="err">ùíû</span> <span class="n">D</span> <span class="err">ùíü</span>
</pre></div>


<p>The order of the variables isn't really right. I can't introduce <code>G</code> before I have those categories.</p>
<p>It's not very important, because I can still get the information I need. But if it is withing Lean 3's capabilities to sort these variables correctly, that would be awesome!</p>

#### [ Patrick Massot (Jan 17 2019 at 11:21)](https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23489%20where/near/155324185):
<p>It would also be a good opportunity to move it back to the default tactic file</p>


{% endraw %}
