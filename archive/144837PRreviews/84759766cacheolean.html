---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/144837PRreviews/84759766cacheolean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/144837PRreviews/index.html">PR reviews</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html">#766 cache-olean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="161835113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161835113" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161835113">Scott Morrison (Mar 27 2019 at 07:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>, what is the reasoning for not storing the cache in <code>cache-olean --build</code> when the build fails? Surely many people often spend a long time working on a branch that is failing, before everything comes good.</p>

<a name="161836179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161836179" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161836179">Kevin Buzzard (Mar 27 2019 at 07:46)</a>:</h4>
<p>Why is it Simon's job to store stuff that the community in general is not interested in?</p>

<a name="161836200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161836200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161836200">Mario Carneiro (Mar 27 2019 at 07:47)</a>:</h4>
<p>I think <code>cache-olean</code> stores stuff locally</p>

<a name="161851231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161851231" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161851231">Simon Hudon (Mar 27 2019 at 11:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I think you're right. We could change that. I'm wondering if we could also store the cache when the user interrupts the build (e.g. with <code>ctrl+C</code>) but I'm not sure if there's a way to do that.</p>

<a name="161851396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161851396" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161851396">Johan Commelin (Mar 27 2019 at 11:50)</a>:</h4>
<p>We would you need that second feature?</p>

<a name="161851404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161851404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161851404">Johan Commelin (Mar 27 2019 at 11:50)</a>:</h4>
<p>Lean will pick up from where you stopped, right?</p>

<a name="161852041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161852041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161852041">Simon Hudon (Mar 27 2019 at 12:00)</a>:</h4>
<p>That's right</p>

<a name="161892737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161892737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161892737">Scott Morrison (Mar 27 2019 at 19:28)</a>:</h4>
<p>at least on OS X this happens already; the first ctrl-C stops the build, but python continues.</p>

<a name="161899616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161899616" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161899616">Scott Morrison (Mar 27 2019 at 20:54)</a>:</h4>
<p>Okay, we now store the cache even when the build fails (or is cancelled by ctrl-c).</p>

<a name="161899623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161899623" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161899623">Scott Morrison (Mar 27 2019 at 20:54)</a>:</h4>
<p>I'm pretty happy with this now. I need to write some docs.</p>

<a name="161899667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161899667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161899667">Scott Morrison (Mar 27 2019 at 20:55)</a>:</h4>
<p>I would also like --fetch to work more often. :-) If travis has seen that commit, there could be a cached copy of the oleans!</p>

<a name="161899732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161899732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161899732">Scott Morrison (Mar 27 2019 at 20:56)</a>:</h4>
<p>I might also try writing <code>--list</code>, which shows the status of the cache for each local branch. But I won't hold up the PR to do that.</p>

<a name="161900277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161900277" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161900277">Patrick Massot (Mar 27 2019 at 21:03)</a>:</h4>
<p>Of course we would like cached olean for everything that Travis once compiled. It would help PR reviewing a lot (at least for me). For instance I compiled the convexity PR (but haven't found time to carefully look at it). But there are storage issues. GitHub won't let us store infinitely many releases</p>

<a name="161901566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161901566" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161901566">Scott Morrison (Mar 27 2019 at 21:21)</a>:</h4>
<p>If storage is the only requirement, I have a server that we could use. I'm not concerned about storage or bandwidth, and I'd be happy to allow uploads in some moderately controlled fashion.</p>

<a name="161901575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161901575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161901575">Scott Morrison (Mar 27 2019 at 21:21)</a>:</h4>
<p>For cached oleans, high reliability is not necessary.</p>

<a name="161905664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161905664" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161905664">Simon Hudon (Mar 27 2019 at 22:23)</a>:</h4>
<p>That would be nice. We can get Travis to upload the cache then and decide to delete caches older than 1 or 2 months</p>

<a name="161925977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161925977" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161925977">Scott Morrison (Mar 28 2019 at 05:48)</a>:</h4>
<p>maybe the right approach is to not directly upload to my server, which sounds hard to manage, security wise</p>

<a name="161926005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161926005" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161926005">Scott Morrison (Mar 28 2019 at 05:50)</a>:</h4>
<p>Instead perhaps we could have travis post everything it builds somewhere (along with the olean artifacts from master?) but deleting them after a few days. I can then have my machine poll that supply of caches, and copy them to a publicly accessible location, where it can store them for much longer.</p>

<a name="161926060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161926060" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161926060">Scott Morrison (Mar 28 2019 at 05:50)</a>:</h4>
<p>I can certainly set up the "scrape the following webpage for artifacts, post them online" step, if someone else, presumably <span class="user-mention" data-user-id="110026">@Simon Hudon</span> could handle the travis part.</p>

<a name="161926279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161926279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161926279">Scott Morrison (Mar 28 2019 at 05:57)</a>:</h4>
<p>Another issue we need to fix with this PR eventually: hitting Ctrl-C can break the cache, and result in ... crap all over your repository :-) I'm not a python ninja, but <a href="https://stackoverflow.com/questions/842557/how-to-prevent-a-block-of-code-from-being-interrupted-by-keyboardinterrupt-in-py" target="_blank" title="https://stackoverflow.com/questions/842557/how-to-prevent-a-block-of-code-from-being-interrupted-by-keyboardinterrupt-in-py">https://stackoverflow.com/questions/842557/how-to-prevent-a-block-of-code-from-being-interrupted-by-keyboardinterrupt-in-py</a> seems to have some solutions.</p>

<a name="161937168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23766%20cache-olean/near/161937168" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/84759766cacheolean.html#161937168">Scott Morrison (Mar 28 2019 at 09:53)</a>:</h4>
<p>cf <a href="https://github.com/leanprover-community/mathlib/issues/857" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/857">#857</a> and <a href="https://github.com/leanprover-community/mathlib/issues/858" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/858">#858</a> for some improvements</p>


{% endraw %}
