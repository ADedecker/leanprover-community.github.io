---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/144837PRreviews/47033711Calculus.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/144837PRreviews/index.html">PR reviews</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html">#711 Calculus</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="157983538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157983538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157983538">Johan Commelin (Feb 10 2019 at 17:30)</a>:</h4>
<p><span class="user-mention" data-user-id="130500">@Abhimanyu Pallavi Sudhir</span> It's cool to see that people are working on Calculus!<br>
Experience has shown that it works best if you make lots of small PRs (&lt;200 lines). So I think you have more than enough for two or three meaningful PRs. Big mega-project PRs tend to rot away in the PR list.</p>

<a name="157983822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157983822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157983822">Patrick Massot (Feb 10 2019 at 17:38)</a>:</h4>
<p>Thank you for working on this. I'm not opposed to doing dimension one first. We will need specific statements for this case anyway, for teaching purposes, and because they have special notations. It would be a nice exercise to check that all proofs can be replaced by one-liners once we'll get the higher dimensional case. But I agree you should split this PR. You should also have a look at what <span class="user-mention" data-user-id="110865">@Jeremy Avigad</span>  did in order to handle punctured neighborhoods.</p>

<a name="157983841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157983841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157983841">Patrick Massot (Feb 10 2019 at 17:39)</a>:</h4>
<p>I also think we should make more use of <a href="https://github.com/ImperialCollegeLondon/M1P1-lean/blob/master/src/limits.lean#L93-L94" target="_blank" title="https://github.com/ImperialCollegeLondon/M1P1-lean/blob/master/src/limits.lean#L93-L94">https://github.com/ImperialCollegeLondon/M1P1-lean/blob/master/src/limits.lean#L93-L94</a> in order to avoid splitting epsilons</p>

<a name="157986344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157986344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157986344">Abhimanyu Pallavi Sudhir (Feb 10 2019 at 18:55)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="130500">@Abhimanyu Pallavi Sudhir</span> It's cool to see that people are working on Calculus!<br>
Experience has shown that it works best if you make lots of small PRs (&lt;200 lines). So I think you have more than enough for two or three meaningful PRs. Big mega-project PRs tend to rot away in the PR list.</p>
</blockquote>
<p>What should I have in my first calculus PR? Just the definitions of the derivative, or definitions with a few basic theorems? I'm not completely sure of how small PRs can be, especially when it comes to defining a whole new library.</p>

<a name="157986415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157986415" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157986415">Abhimanyu Pallavi Sudhir (Feb 10 2019 at 18:57)</a>:</h4>
<blockquote>
<p>I also think we should make more use of <a href="https://github.com/ImperialCollegeLondon/M1P1-lean/blob/master/src/limits.lean#L93-L94" target="_blank" title="https://github.com/ImperialCollegeLondon/M1P1-lean/blob/master/src/limits.lean#L93-L94">https://github.com/ImperialCollegeLondon/M1P1-lean/blob/master/src/limits.lean#L93-L94</a> in order to avoid splitting epsilons</p>
</blockquote>
<p>Yes -- "wlog epsilon &lt; A" is another one (or even just epsilon &lt; 1 will be useful wherever powers are involved). And some of my <code>abs</code> splitting, which I did based on intuition, can be done easily (and in a way that generalises) with the triangle inequality.</p>

<a name="157986617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157986617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157986617">Abhimanyu Pallavi Sudhir (Feb 10 2019 at 19:02)</a>:</h4>
<blockquote>
<p>...a look at what <span class="user-mention silent" data-user-id="110865">@Jeremy Avigad</span>  did in order to handle punctured neighborhoods.</p>
</blockquote>
<p>Do you have a link? Is this in mathlib?</p>

<a name="157988591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157988591" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157988591">Patrick Massot (Feb 10 2019 at 19:54)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/cfd2b75e7a80462001fd1c2b835196b28dcd25c1/src/topology/basic.lean#L1750" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/cfd2b75e7a80462001fd1c2b835196b28dcd25c1/src/topology/basic.lean#L1750">https://github.com/leanprover-community/mathlib/blob/cfd2b75e7a80462001fd1c2b835196b28dcd25c1/src/topology/basic.lean#L1750</a></p>

<a name="157990080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157990080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157990080">Jeremy Avigad (Feb 10 2019 at 20:36)</a>:</h4>
<p><span class="user-mention" data-user-id="130500">@Abhimanyu Pallavi Sudhir</span> , this is very nice! Coincidentally, I have just started formalizing the Frechet derivative. I put my current work in progress here:</p>
<p><a href="https://github.com/leanprover-community/mathlib/blob/multivariate/src/analysis/deriv.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/multivariate/src/analysis/deriv.lean">https://github.com/leanprover-community/mathlib/blob/multivariate/src/analysis/deriv.lean</a></p>
<p>The basic notion is <code>has_fderiv_at_within f f' x s</code>, which says that <code>f</code> has Frechet derivative <code>f'</code> at point <code>x</code>, where everything is relativized to the set <code>s</code>.</p>
<p>The approach is more general than yours, in two ways:<br>
- The Frechet derivative works on functions between arbitrary normed spaces.<br>
- Everything is relativized to a set <code>s</code>.</p>
<p>But I have not gotten nearly as far as you. (I am planning to do the chain rule next.) Can we somehow merge the two approaches?</p>
<p>In my experience, relativizing to a set is important. Sooner or later we will need the relativized versions. It is not too hard to do everything that way from the start, and, if we don't, there is no good way to fix it later without redoing everything.</p>
<p>Once we have the <code>at_within</code> notions, we can define</p>
<p><code>has_fderiv_at f f' x := has_fderiv_at_within f f' x univ</code><br>
<code>has_fderiv f f'</code> := forall x, has_fderiv_at f (f' x) x`</p>
<p>and so on. Note that we have similar notions for continuity, <code>continuous_at_within</code>, <code>continuous_at</code>, and <code>continuous</code>. </p>
<p>We can also define the univariate version,</p>
<p><code>has_deriv_at_within f y x s := has_fderiv_at_within f (λ x', y * x') x s</code>  </p>
<p>Regarding punctured neighborhoods, we can get this e.g. using <code>nhds_within x (λ x', x' ≠ x)</code>. But are you sure you need them? Note that, by convention, <code>x / 0 = 0</code>.</p>
<p>I suggest shortening <code>derivative</code> to <code>deriv</code>. That will save us a lot of typing. Also, the theorem names should approximate the statements as closely as possible, e.g. <code>has_deriv_at_within id 1 x s</code> should be named <code>has_deriv_id</code>. I took the liberty of dropping the <code>at_within</code> from the name. You can then apply <code>has_deriv_id</code> to a goal of the form <code>has_deriv_at id 1 x</code>.</p>
<p>I really like the fact that you have started computing concrete derivatives. That is really useful.</p>

<a name="157990318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157990318" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157990318">Jeremy Avigad (Feb 10 2019 at 20:43)</a>:</h4>
<p>Oh, also, in response to your PR: I think we should skip Riemann integration, and use the Lebesgue integral instead. Some people here at CMU might be willing to do the fundamental theorem of calculus, formalizing bounded variation and so on.</p>

<a name="157991154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157991154" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157991154">Kevin Buzzard (Feb 10 2019 at 21:06)</a>:</h4>
<p>Yes it's hard to imagine the Riemann integral having any use; the Lebesgue integral is I guess defined every time the Riemann integral is, and they agree on functions which are Riemann integrable. The only problem will be that nobody will be able to example sheet questions of the form "Show that the function which is 1 on rationals and 0 on irrationals is not Riemann integrable, but it is Lebesgue integrable" :-)</p>

<a name="157991287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157991287" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157991287">Patrick Massot (Feb 10 2019 at 21:10)</a>:</h4>
<p>You can still define Riemann integrable without defining the Riemann integral, but I guess this is cheating</p>

<a name="157991366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157991366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157991366">Patrick Massot (Feb 10 2019 at 21:12)</a>:</h4>
<blockquote>
<p>The Frechet derivative. We use <code>fderiv</code> for the Frechet derivative, and <code>deriv</code> for the univariate one.</p>
</blockquote>
<p>This really feels wrong to me. I never ever use the word Fréchet (although I know how to write it...). It's the derivative.</p>

<a name="157991502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157991502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157991502">Patrick Massot (Feb 10 2019 at 21:16)</a>:</h4>
<p>But thanks anyway! I can't wait to see the chain rule</p>

<a name="157992321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157992321" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157992321">Kevin Buzzard (Feb 10 2019 at 21:39)</a>:</h4>
<blockquote>
<p>This really feels wrong to me. I never ever use the word Fréchet (although I know how to write it...). It's the derivative.</p>
</blockquote>
<p>Ha ha we don't have that button :-)</p>

<a name="157992375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23711%20Calculus/near/157992375" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/47033711Calculus.html#157992375">Kevin Buzzard (Feb 10 2019 at 21:41)</a>:</h4>
<p>é = ctrl-shift u 00e9</p>


{% endraw %}
