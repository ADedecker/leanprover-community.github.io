---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/116395maths/45170t2space.html
---

## Stream: [maths](index.html)
### Topic: [t2_space](45170t2space.html)

---


{% raw %}
#### [ Reid Barton (Nov 10 2018 at 23:56)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451283):
<p>This is producing a "maximum class-instance resolution depth has been reached" error: it used to work.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">topology</span><span class="bp">.</span><span class="n">continuity</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">real</span>
<span class="n">noncomputable</span> <span class="n">theory</span>
<span class="n">def</span> <span class="n">interval</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">:=</span> <span class="n">subtype</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">|</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">r</span> <span class="bp">∧</span> <span class="n">r</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">}</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">interval</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">unfold</span> <span class="n">interval</span><span class="bp">;</span> <span class="n">apply_instance</span>
<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">t2_space</span> <span class="n">interval</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">dunfold</span> <span class="n">interval</span><span class="bp">;</span> <span class="n">apply_instance</span>
</pre></div>

#### [ Kevin Buzzard (Nov 10 2018 at 23:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451366):
<p>Is this perhaps to do with reals now being irreducible?</p>

#### [ Reid Barton (Nov 11 2018 at 00:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451443):
<p>hmm, it worked with a depth of 38...</p>

#### [ Reid Barton (Nov 11 2018 at 00:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451461):
<p>but it takes many seconds</p>

#### [ Reid Barton (Nov 11 2018 at 00:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451467):
<p>There have been a number of changes to topological spaces and metric spaces which could be responsible too.</p>

#### [ Reid Barton (Nov 11 2018 at 00:03)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451552):
<p>It needs exactly 37</p>

#### [ Reid Barton (Nov 11 2018 at 00:11)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451941):
<p>Bisecting... <span class="emoji emoji-1f93a" title="fencing">:fencing:</span></p>

#### [ Reid Barton (Nov 11 2018 at 00:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147452710):
<p>Apparently it stopped working in "add emetric spaces", though I don't know why yet</p>

#### [ Reid Barton (Nov 11 2018 at 02:20)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147456963):
<p>I still don't have a very clear picture here, but this is what I've learned:</p>
<ul>
<li>The above code was pretty close to the default limit (32) before emetric spaces; it needed a depth of 29.</li>
<li>emetric spaces do add some extra instances. You can now go (when solving, i.e., backwards) either from <code>uniform_space</code> to <code>emetric_space</code> to <code>metric_space</code> or from <code>uniform_space</code> directly to <code>metric_space</code>.</li>
<li>I don't understand what the parameter <code>instance_max_depth</code> actually controls. It isn't the nesting level as shown in parentheses, which never goes above 10 in the successful trace with emetric spaces. Maybe it has something to do with the number of unassigned metavariables?</li>
<li>Perhaps more concerning than hitting the depth limit is how long it takes to find the instance with the limit increased. The successful log is about 600MB. The instance search seems to have no memory, so alternative paths to the same point, like from <code>uniform_space</code> to <code>metric_space</code>, even if not causing a diamond problem, are still dangerous for performance: the work done to find an instance can grow exponentially in the number of such branches.</li>
</ul>

#### [ Reid Barton (Nov 11 2018 at 02:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147457303):
<p>Is <code>instance metric_space.to_uniform_space'</code> still needed?</p>

#### [ Reid Barton (Nov 11 2018 at 02:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147457936):
<p>For this example, using <code>apply subtype.t2_space</code> is a workaround</p>


{% endraw %}
